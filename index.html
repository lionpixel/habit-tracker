<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Habit Game Pro - Controle de H√°bitos Gamificado</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #10b981;
            --secondary-dark: #059669;
            --danger: #ef4444;
            --warning: #f59e0b;
            --dark: #0f172a;
            --darker: #020617;
            --card-bg: #1e293b;
            --light: #f8fafc;
            --gray: #94a3b8;
            --border-radius: 16px;
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }

        body {
            background: linear-gradient(135deg, var(--darker), #1e1b4b);
            color: var(--light);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(30, 41, 59, 0.7);
            border-radius: var(--border-radius);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        h1 {
            font-size: 2.8rem;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .subtitle {
            color: var(--gray);
            font-size: 1.1rem;
            max-width: 600px;
            margin: 0 auto;
        }

        .stats-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 20px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            transition: var(--transition);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        .stat-card i {
            font-size: 2rem;
            margin-bottom: 10px;
            color: var(--primary);
        }

        .stat-value {
            font-size: 2.2rem;
            font-weight: 800;
            margin: 10px 0;
        }

        .stat-label {
            color: var(--gray);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .card-title {
            font-size: 1.4rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .habits-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .habit-item {
            background: rgba(30, 41, 59, 0.7);
            border-radius: 12px;
            padding: 18px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: var(--transition);
            border-left: 4px solid var(--primary);
        }

        .habit-item:hover {
            background: rgba(30, 41, 59, 0.9);
            transform: translateX(5px);
        }

        .habit-info {
            flex-grow: 1;
        }

        .habit-name {
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 5px;
        }

        .habit-goal {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .habit-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .habit-progress {
            width: 120px;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .btn {
            padding: 8px 16px;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-success {
            background: var(--secondary);
            color: white;
        }

        .btn-success:hover {
            background: var(--secondary-dark);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-outline {
            background: transparent;
            color: var(--gray);
            border: 1px solid var(--gray);
        }

        .btn-outline:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .btn-sm {
            padding: 5px 10px;
            font-size: 0.8rem;
        }

        .btn-icon {
            padding: 8px 12px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .insight-card {
            background: rgba(30, 41, 59, 0.7);
            border-radius: 12px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .insight-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-bottom: 15px;
        }

        .insight-value {
            font-size: 1.8rem;
            font-weight: 700;
            margin: 10px 0;
        }

        .insight-text {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 30px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            animation: modalFade 0.3s ease;
        }

        @keyframes modalFade {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }

        input, select {
            width: 100%;
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            font-size: 1rem;
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--primary);
        }

        .form-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 30px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 10px;
        }

        .tab {
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
        }

        .tab.active {
            background: var(--primary);
        }

        .tab:hover:not(.active) {
            background: rgba(255, 255, 255, 0.1);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-top: 20px;
        }

        .level-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.9rem;
            margin-left: 10px;
        }

        .level-1 { background: #7c3aed; color: white; }
        .level-2 { background: #06b6d4; color: white; }
        .level-3 { background: #10b981; color: white; }
        .level-4 { background: #f59e0b; color: white; }
        .level-5 { background: #ef4444; color: white; }

        .comparison {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .comparison-item {
            text-align: center;
        }

        .comparison-value {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .comparison-label {
            font-size: 0.8rem;
            color: var(--gray);
        }

        .positive { color: var(--secondary); }
        .negative { color: var(--danger); }
        .neutral { color: var(--gray); }

        footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--gray);
            font-size: 0.9rem;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--gray);
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-gamepad"></i> Habit Game Pro</h1>
            <p class="subtitle">Transforme sua rotina em um jogo. Acompanhe, melhore e gamifique seus h√°bitos di√°rios.</p>
        </header>

        <div class="stats-bar">
            <div class="stat-card">
                <i class="fas fa-trophy"></i>
                <div class="stat-value" id="globalScore">0%</div>
                <div class="stat-label">Pontua√ß√£o Global</div>
                <div id="levelBadge" class="level-badge level-1">N√≠vel 1</div>
            </div>
            
            <div class="stat-card">
                <i class="fas fa-calendar-week"></i>
                <div class="stat-value" id="weekScore">0%</div>
                <div class="stat-label">Esta Semana</div>
                <div id="weekComparison" class="comparison-label"></div>
            </div>
            
            <div class="stat-card">
                <i class="fas fa-calendar-alt"></i>
                <div class="stat-value" id="monthScore">0%</div>
                <div class="stat-label">Este M√™s</div>
                <div id="monthComparison" class="comparison-label"></div>
            </div>
            
            <div class="stat-card">
                <i class="fas fa-fire"></i>
                <div class="stat-value" id="streak">0</div>
                <div class="stat-label">Sequ√™ncia Atual</div>
                <div class="comparison-label">Dias seguidos</div>
            </div>
        </div>

        <div class="main-content">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title"><i class="fas fa-tasks"></i> Meus H√°bitos</h2>
                    <button class="btn btn-primary" id="addHabitBtn">
                        <i class="fas fa-plus"></i> Novo H√°bito
                    </button>
                </div>
                
                <div class="tabs">
                    <div class="tab active" data-tab="habits-list">Lista</div>
                    <div class="tab" data-tab="habits-stats">Estat√≠sticas</div>
                </div>
                
                <div class="tab-content active" id="habits-list">
                    <div class="habits-container" id="habitsContainer">
                        <!-- H√°bitos ser√£o inseridos aqui via JavaScript -->
                    </div>
                </div>
                
                <div class="tab-content" id="habits-stats">
                    <div class="chart-container">
                        <canvas id="habitsChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title"><i class="fas fa-chart-line"></i> Desempenho</h2>
                    <div>
                        <button class="btn btn-outline btn-sm" id="viewWeekly">Semanal</button>
                        <button class="btn btn-outline btn-sm" id="viewMonthly">Mensal</button>
                    </div>
                </div>
                
                <div class="chart-container">
                    <canvas id="performanceChart"></canvas>
                </div>
                
                <div class="comparison">
                    <div class="comparison-item">
                        <div class="comparison-value" id="comparisonWeek">0%</div>
                        <div class="comparison-label">vs. Semana Passada</div>
                    </div>
                    <div class="comparison-item">
                        <div class="comparison-value" id="comparisonMonth">0%</div>
                        <div class="comparison-label">vs. M√™s Passado</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h2 class="card-title"><i class="fas fa-lightbulb"></i> Insights</h2>
            </div>
            
            <div class="insights-grid">
                <div class="insight-card">
                    <div class="insight-icon" style="background: rgba(99, 102, 241, 0.2); color: var(--primary);">
                        <i class="fas fa-star"></i>
                    </div>
                    <div class="insight-value" id="bestHabit">-</div>
                    <div class="insight-text">Melhor h√°bito esta semana</div>
                </div>
                
                <div class="insight-card">
                    <div class="insight-icon" style="background: rgba(239, 68, 68, 0.2); color: var(--danger);">
                        <i class="fas fa-exclamation-circle"></i>
                    </div>
                    <div class="insight-value" id="worstHabit">-</div>
                    <div class="insight-text">H√°bito a melhorar</div>
                </div>
                
                <div class="insight-card">
                    <div class="insight-icon" style="background: rgba(16, 185, 129, 0.2); color: var(--secondary);">
                        <i class="fas fa-calendar-check"></i>
                    </div>
                    <div class="insight-value" id="completionRate">0%</div>
                    <div class="insight-text">Taxa de conclus√£o</div>
                </div>
                
                <div class="insight-card">
                    <div class="insight-icon" style="background: rgba(245, 158, 11, 0.2); color: var(--warning);">
                        <i class="fas fa-bullseye"></i>
                    </div>
                    <div class="insight-value" id="nextLevel">0%</div>
                    <div class="insight-text">Progresso para pr√≥ximo n√≠vel</div>
                </div>
            </div>
        </div>

        <!-- Modal para adicionar/editar h√°bito -->
        <div class="modal" id="habitModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="modalTitle">Adicionar Novo H√°bito</h2>
                    <button class="btn btn-icon btn-outline" id="closeModal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <form id="habitForm">
                    <input type="hidden" id="habitId">
                    
                    <div class="form-group">
                        <label for="habitName">Nome do H√°bito</label>
                        <input type="text" id="habitName" required placeholder="Ex: Exerc√≠cio, Leitura, Medita√ß√£o">
                    </div>
                    
                    <div class="form-group">
                        <label for="habitGoal">Meta Semanal (vezes por semana)</label>
                        <input type="number" id="habitGoal" min="1" max="14" value="5" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="habitColor">Cor do H√°bito</label>
                        <select id="habitColor">
                            <option value="#6366f1">Roxo</option>
                            <option value="#10b981">Verde</option>
                            <option value="#f59e0b">Amarelo</option>
                            <option value="#ef4444">Vermelho</option>
                            <option value="#06b6d4">Ciano</option>
                            <option value="#8b5cf6">Violeta</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="habitIcon">√çcone</label>
                        <select id="habitIcon">
                            <option value="dumbbell">üèãÔ∏è Exerc√≠cio</option>
                            <option value="book">üìö Leitura</option>
                            <option value="brain">üß† Estudo</option>
                            <option value="apple">üçé Alimenta√ß√£o</option>
                            <option value="moon">üò¥ Sono</option>
                            <option value="water">üíß √Ågua</option>
                            <option value="pray">üôè Medita√ß√£o</option>
                            <option value="code">üíª Programa√ß√£o</option>
                        </select>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-outline" id="cancelBtn">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Salvar H√°bito</button>
                    </div>
                </form>
            </div>
        </div>

        <footer>
            <p>Habit Game Pro &copy; 2023 | Transforme seus h√°bitos em um jogo viciante!</p>
            <p>Dados armazenados localmente no seu navegador</p>
        </footer>
    </div>

    <script>
        // Configura√ß√µes iniciais
        const DEFAULT_HABITS = [
            { id: 1, name: "Treino", goal: 5, color: "#10b981", icon: "dumbbell", counts: {} },
            { id: 2, name: "Ingl√™s", goal: 5, color: "#6366f1", icon: "brain", counts: {} },
            { id: 3, name: "Leitura", goal: 5, color: "#f59e0b", icon: "book", counts: {} },
            { id: 4, name: "Devocional", goal: 7, color: "#8b5cf6", icon: "pray", counts: {} }
        ];

        const LEVELS = [
            { minScore: 0, name: "Iniciante", badgeClass: "level-1" },
            { minScore: 20, name: "Aprendiz", badgeClass: "level-2" },
            { minScore: 40, name: "Intermedi√°rio", badgeClass: "level-3" },
            { minScore: 60, name: "Avan√ßado", badgeClass: "level-4" },
            { minScore: 80, name: "Mestre", badgeClass: "level-5" }
        ];

        // Obter data atual e calcular semana/m√™s
        const now = new Date();
        const currentYear = now.getFullYear();
        const currentMonth = now.getMonth();
        const currentDate = now.getDate();
        
        // Fun√ß√£o para obter n√∫mero da semana no ano
        Date.prototype.getWeek = function() {
            const date = new Date(this.getTime());
            date.setHours(0, 0, 0, 0);
            date.setDate(date.getDate() + 3 - (date.getDay() + 6) % 7);
            const week1 = new Date(date.getFullYear(), 0, 4);
            return 1 + Math.round(((date.getTime() - week1.getTime()) / 86400000 - 3 + (week1.getDay() + 6) % 7) / 7);
        };
        
        const currentWeek = now.getWeek();
        const currentWeekKey = `${currentYear}-W${currentWeek}`;
        const currentMonthKey = `${currentYear}-${currentMonth}`;

        // Carregar dados do localStorage
        let habits = JSON.parse(localStorage.getItem("habitGamePro")) || DEFAULT_HABITS;
        let appData = JSON.parse(localStorage.getItem("habitGameProData")) || {
            history: {},
            streak: 0,
            lastUpdate: now.toISOString().split('T')[0]
        };

        // Inicializar contagens da semana atual se n√£o existirem
        habits.forEach(habit => {
            if (!habit.counts) habit.counts = {};
            if (!habit.counts[currentWeekKey]) habit.counts[currentWeekKey] = 0;
        });

        // Atualizar √∫ltimo acesso e sequ√™ncia
        const today = now.toISOString().split('T')[0];
        const lastUpdate = appData.lastUpdate;
        const yesterday = new Date(now);
        yesterday.setDate(yesterday.getDate() - 1);
        const yesterdayStr = yesterday.toISOString().split('T')[0];
        
        if (lastUpdate === yesterdayStr) {
            appData.streak += 1;
        } else if (lastUpdate !== today) {
            appData.streak = 1;
        }
        
        appData.lastUpdate = today;

        // Salvar dados atualizados
        saveData();

        // Elementos DOM
        const habitsContainer = document.getElementById('habitsContainer');
        const habitModal = document.getElementById('habitModal');
        const habitForm = document.getElementById('habitForm');
        const modalTitle = document.getElementById('modalTitle');
        const habitIdInput = document.getElementById('habitId');
        const habitNameInput = document.getElementById('habitName');
        const habitGoalInput = document.getElementById('habitGoal');
        const habitColorInput = document.getElementById('habitColor');
        const habitIconInput = document.getElementById('habitIcon');
        const closeModalBtn = document.getElementById('closeModal');
        const cancelBtn = document.getElementById('cancelBtn');
        const addHabitBtn = document.getElementById('addHabitBtn');
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        const viewWeeklyBtn = document.getElementById('viewWeekly');
        const viewMonthlyBtn = document.getElementById('viewMonthly');

        // Gr√°ficos
        let habitsChart = null;
        let performanceChart = null;

        // Inicializar a aplica√ß√£o
        function initApp() {
            renderHabits();
            updateStats();
            renderCharts();
            setupEventListeners();
        }

        // Renderizar lista de h√°bitos
        function renderHabits() {
            habitsContainer.innerHTML = '';
            
            if (habits.length === 0) {
                habitsContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-clipboard-list"></i>
                        <h3>Nenhum h√°bito cadastrado</h3>
                        <p>Comece adicionando seu primeiro h√°bito para iniciar sua jornada!</p>
                    </div>
                `;
                return;
            }
            
            habits.forEach(habit => {
                const progress = Math.min(100, (habit.counts[currentWeekKey] || 0) / habit.goal * 100);
                const progressColor = progress >= 80 ? '#10b981' : progress >= 60 ? '#f59e0b' : '#ef4444';
                
                const habitElement = document.createElement('div');
                habitElement.className = 'habit-item';
                habitElement.style.borderLeftColor = habit.color;
                
                habitElement.innerHTML = `
                    <div class="habit-info">
                        <div class="habit-name">
                            ${getIcon(habit.icon)} ${habit.name}
                        </div>
                        <div class="habit-goal">
                            ${habit.counts[currentWeekKey] || 0} de ${habit.goal} vezes esta semana
                        </div>
                        <div class="habit-progress">
                            <div class="progress-fill" style="width: ${progress}%; background: ${progressColor};"></div>
                        </div>
                    </div>
                    <div class="habit-actions">
                        <button class="btn btn-success btn-sm" onclick="incrementHabit(${habit.id})">
                            <i class="fas fa-plus"></i> +1
                        </button>
                        <button class="btn btn-outline btn-sm" onclick="editHabit(${habit.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-danger btn-sm" onclick="deleteHabit(${habit.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                
                habitsContainer.appendChild(habitElement);
            });
        }

        // Obter √≠cone baseado no valor
        function getIcon(iconName) {
            const iconMap = {
                'dumbbell': 'üèãÔ∏è',
                'book': 'üìö',
                'brain': 'üß†',
                'apple': 'üçé',
                'moon': 'üò¥',
                'water': 'üíß',
                'pray': 'üôè',
                'code': 'üíª'
            };
            return iconMap[iconName] || '‚úÖ';
        }

        // Incrementar contagem de um h√°bito
        function incrementHabit(id) {
            const habit = habits.find(h => h.id === id);
            if (!habit) return;
            
            const currentCount = habit.counts[currentWeekKey] || 0;
            if (currentCount < habit.goal) {
                habit.counts[currentWeekKey] = currentCount + 1;
                saveData();
                renderHabits();
                updateStats();
                renderCharts();
                
                // Efeito visual
                const btn = event.target.closest('button');
                btn.innerHTML = '<i class="fas fa-check"></i> Feito!';
                btn.style.background = '#10b981';
                setTimeout(() => {
                    btn.innerHTML = '<i class="fas fa-plus"></i> +1';
                    btn.style.background = '';
                }, 1000);
            }
        }

        // Editar h√°bito
        function editHabit(id) {
            const habit = habits.find(h => h.id === id);
            if (!habit) return;
            
            habitIdInput.value = habit.id;
            habitNameInput.value = habit.name;
            habitGoalInput.value = habit.goal;
            habitColorInput.value = habit.color;
            habitIconInput.value = habit.icon;
            
            modalTitle.textContent = 'Editar H√°bito';
            habitModal.style.display = 'flex';
        }

        // Excluir h√°bito
        function deleteHabit(id) {
            if (!confirm('Tem certeza que deseja excluir este h√°bito?')) return;
            
            habits = habits.filter(h => h.id !== id);
            saveData();
            renderHabits();
            updateStats();
            renderCharts();
        }

        // Abrir modal para adicionar h√°bito
        function openAddHabitModal() {
            habitIdInput.value = '';
            habitNameInput.value = '';
            habitGoalInput.value = 5;
            habitColorInput.value = '#6366f1';
            habitIconInput.value = 'dumbbell';
            
            modalTitle.textContent = 'Adicionar Novo H√°bito';
            habitModal.style.display = 'flex';
        }

        // Salvar h√°bito (adicionar ou editar)
        habitForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const id = parseInt(habitIdInput.value) || Date.now();
            const name = habitNameInput.value.trim();
            const goal = parseInt(habitGoalInput.value);
            const color = habitColorInput.value;
            const icon = habitIconInput.value;
            
            if (!name || goal < 1) {
                alert('Preencha todos os campos corretamente!');
                return;
            }
            
            // Verificar se √© edi√ß√£o ou adi√ß√£o
            const existingIndex = habits.findIndex(h => h.id === id);
            
            if (existingIndex >= 0) {
                // Editar
                habits[existingIndex].name = name;
                habits[existingIndex].goal = goal;
                habits[existingIndex].color = color;
                habits[existingIndex].icon = icon;
            } else {
                // Adicionar novo
                const newHabit = {
                    id,
                    name,
                    goal,
                    color,
                    icon,
                    counts: { [currentWeekKey]: 0 }
                };
                habits.push(newHabit);
            }
            
            saveData();
            renderHabits();
            updateStats();
            renderCharts();
            closeModal();
        });

        // Fechar modal
        function closeModal() {
            habitModal.style.display = 'none';
            habitForm.reset();
        }

        // Configurar event listeners
        function setupEventListeners() {
            addHabitBtn.addEventListener('click', openAddHabitModal);
            closeModalBtn.addEventListener('click', closeModal);
            cancelBtn.addEventListener('click', closeModal);
            
            // Fechar modal ao clicar fora
            habitModal.addEventListener('click', function(e) {
                if (e.target === habitModal) closeModal();
            });
            
            // Sistema de abas
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // Remover classe active de todas as abas e conte√∫dos
                    tabs.forEach(t => t.classList.remove('active'));
                    tabContents.forEach(c => c.classList.remove('active'));
                    
                    // Adicionar classe active √† aba clicada e seu conte√∫do
                    this.classList.add('active');
                    document.getElementById(tabId).classList.add('active');
                    
                    // Se for a aba de estat√≠sticas, atualizar o gr√°fico
                    if (tabId === 'habits-stats') {
                        renderHabitsChart();
                    }
                });
            });
            
            // Bot√µes de visualiza√ß√£o (semanal/mensal)
            viewWeeklyBtn.addEventListener('click', function() {
                viewWeeklyBtn.classList.add('btn-primary');
                viewWeeklyBtn.classList.remove('btn-outline');
                viewMonthlyBtn.classList.add('btn-outline');
                viewMonthlyBtn.classList.remove('btn-primary');
                renderPerformanceChart('week');
            });
            
            viewMonthlyBtn.addEventListener('click', function() {
                viewMonthlyBtn.classList.add('btn-primary');
                viewMonthlyBtn.classList.remove('btn-outline');
                viewWeeklyBtn.classList.add('btn-outline');
                viewWeeklyBtn.classList.remove('btn-primary');
                renderPerformanceChart('month');
            });
        }

        // Calcular estat√≠sticas
        function updateStats() {
            // Pontua√ß√£o da semana atual
            let weekScore = 0;
            let totalPossible = 0;
            
            habits.forEach(habit => {
                const count = habit.counts[currentWeekKey] || 0;
                weekScore += Math.min(1, count / habit.goal);
                totalPossible += 1;
            });
            
            weekScore = totalPossible > 0 ? Math.round((weekScore / totalPossible) * 100) : 0;
            
            // Pontua√ß√£o do m√™s atual
            let monthScore = 0;
            let monthTotalPossible = 0;
            
            habits.forEach(habit => {
                let monthCount = 0;
                let monthGoal = 0;
                
                // Somar todas as semanas do m√™s atual
                Object.keys(habit.counts).forEach(weekKey => {
                    if (weekKey.startsWith(`${currentYear}-${currentMonth}`)) {
                        monthCount += habit.counts[weekKey];
                        monthGoal += habit.goal;
                    }
                });
                
                monthScore += Math.min(1, monthCount / (monthGoal || 1));
                monthTotalPossible += 1;
            });
            
            monthScore = monthTotalPossible > 0 ? Math.round((monthScore / monthTotalPossible) * 100) : 0;
            
            // Pontua√ß√£o global (m√©dia das √∫ltimas 4 semanas)
            let globalScore = 0;
            let weekCount = 0;
            
            for (let i = 0; i < 4; i++) {
                const week = currentWeek - i;
                const weekKey = `${currentYear}-W${week}`;
                let weekTotal = 0;
                let weekPossible = 0;
                
                habits.forEach(habit => {
                    const count = habit.counts[weekKey] || 0;
                    weekTotal += Math.min(1, count / habit.goal);
                    weekPossible += 1;
                });
                
                if (weekPossible > 0) {
                    globalScore += (weekTotal / weekPossible) * 100;
                    weekCount++;
                }
            }
            
            globalScore = weekCount > 0 ? Math.round(globalScore / weekCount) : 0;
            
            // Atualizar elementos DOM
            document.getElementById('globalScore').textContent = `${globalScore}%`;
            document.getElementById('weekScore').textContent = `${weekScore}%`;
            document.getElementById('monthScore').textContent = `${monthScore}%`;
            document.getElementById('streak').textContent = appData.streak;
            
            // Atualizar n√≠vel
            const level = getLevel(globalScore);
            const levelBadge = document.getElementById('levelBadge');
            levelBadge.textContent = `N√≠vel ${level.level}: ${level.name}`;
            levelBadge.className = `level-badge ${level.badgeClass}`;
            
            // Calcular compara√ß√µes
            const lastWeekScore = getLastWeekScore();
            const lastMonthScore = getLastMonthScore();
            
            // Atualizar compara√ß√µes
            document.getElementById('comparisonWeek').textContent = `${weekScore - lastWeekScore > 0 ? '+' : ''}${weekScore - lastWeekScore}%`;
            document.getElementById('comparisonWeek').className = `comparison-value ${weekScore > lastWeekScore ? 'positive' : weekScore < lastWeekScore ? 'negative' : 'neutral'}`;
            
            document.getElementById('comparisonMonth').textContent = `${monthScore - lastMonthScore > 0 ? '+' : ''}${monthScore - lastMonthScore}%`;
            document.getElementById('comparisonMonth').className = `comparison-value ${monthScore > lastMonthScore ? 'positive' : monthScore < lastMonthScore ? 'negative' : 'neutral'}`;
            
            // Atualizar insights
            updateInsights();
        }

        // Obter n√≠vel baseado na pontua√ß√£o
        function getLevel(score) {
            for (let i = LEVELS.length - 1; i >= 0; i--) {
                if (score >= LEVELS[i].minScore) {
                    return {
                        level: i + 1,
                        name: LEVELS[i].name,
                        badgeClass: LEVELS[i].badgeClass
                    };
                }
            }
            return { level: 1, name: "Iniciante", badgeClass: "level-1" };
        }

        // Obter pontua√ß√£o da semana anterior
        function getLastWeekScore() {
            const lastWeek = currentWeek - 1;
            const lastWeekKey = `${currentYear}-W${lastWeek}`;
            
            let lastWeekScore = 0;
            let totalPossible = 0;
            
            habits.forEach(habit => {
                const count = habit.counts[lastWeekKey] || 0;
                lastWeekScore += Math.min(1, count / habit.goal);
                totalPossible += 1;
            });
            
            return totalPossible > 0 ? Math.round((lastWeekScore / totalPossible) * 100) : 0;
        }

        // Obter pontua√ß√£o do m√™s anterior
        function getLastMonthScore() {
            const lastMonth = currentMonth === 0 ? 11 : currentMonth - 1;
            const lastMonthYear = currentMonth === 0 ? currentYear - 1 : currentYear;
            const lastMonthKey = `${lastMonthYear}-${lastMonth}`;
            
            let lastMonthScore = 0;
            let monthTotalPossible = 0;
            
            habits.forEach(habit => {
                let monthCount = 0;
                let monthGoal = 0;
                
                Object.keys(habit.counts).forEach(weekKey => {
                    if (weekKey.startsWith(lastMonthKey)) {
                        monthCount += habit.counts[weekKey];
                        monthGoal += habit.goal;
                    }
                });
                
                lastMonthScore += Math.min(1, monthCount / (monthGoal || 1));
                monthTotalPossible += 1;
            });
            
            return monthTotalPossible > 0 ? Math.round((lastMonthScore / monthTotalPossible) * 100) : 0;
        }

        // Atualizar insights
        function updateInsights() {
            // Melhor h√°bito da semana
            let bestHabit = null;
            let bestScore = 0;
            
            habits.forEach(habit => {
                const count = habit.counts[currentWeekKey] || 0;
                const score = count / habit.goal;
                if (score > bestScore) {
                    bestScore = score;
                    bestHabit = habit.name;
                }
            });
            
            document.getElementById('bestHabit').textContent = bestHabit || '-';
            
            // Pior h√°bito da semana
            let worstHabit = null;
            let worstScore = 1;
            
            habits.forEach(habit => {
                const count = habit.counts[currentWeekKey] || 0;
                const score = count / habit.goal;
                if (score < worstScore) {
                    worstScore = score;
                    worstHabit = habit.name;
                }
            });
            
            document.getElementById('worstHabit').textContent = worstHabit || '-';
            
            // Taxa de conclus√£o geral
            let totalCompleted = 0;
            let totalPossible = 0;
            
            habits.forEach(habit => {
                const count = habit.counts[currentWeekKey] || 0;
                totalCompleted += Math.min(count, habit.goal);
                totalPossible += habit.goal;
            });
            
            const completionRate = totalPossible > 0 ? Math.round((totalCompleted / totalPossible) * 100) : 0;
            document.getElementById('completionRate').textContent = `${completionRate}%`;
            
            // Progresso para pr√≥ximo n√≠vel
            const globalScore = parseInt(document.getElementById('globalScore').textContent);
            const level = getLevel(globalScore);
            const nextLevel = level.level < LEVELS.length ? LEVELS[level.level].minScore : 100;
            const progress = Math.min(100, Math.round((globalScore - LEVELS[level.level-1].minScore) / (nextLevel - LEVELS[level.level-1].minScore) * 100));
            document.getElementById('nextLevel').textContent = `${progress}%`;
        }

        // Renderizar gr√°ficos
        function renderCharts() {
            renderHabitsChart();
            renderPerformanceChart('week');
        }

        // Gr√°fico de h√°bitos
        function renderHabitsChart() {
            const ctx = document.getElementById('habitsChart').getContext('2d');
            
            if (habitsChart) {
                habitsChart.destroy();
            }
            
            const habitNames = habits.map(h => h.name);
            const habitProgress = habits.map(h => {
                const count = h.counts[currentWeekKey] || 0;
                return Math.min(100, (count / h.goal) * 100);
            });
            const habitColors = habits.map(h => h.color);
            
            habitsChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: habitNames,
                    datasets: [{
                        label: 'Progresso (%)',
                        data: habitProgress,
                        backgroundColor: habitColors,
                        borderColor: habitColors.map(c => c.replace('0.8', '1')),
                        borderWidth: 1,
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#94a3b8'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#94a3b8'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const habit = habits[context.dataIndex];
                                    const count = habit.counts[currentWeekKey] || 0;
                                    return `${habit.name}: ${count}/${habit.goal} (${context.raw}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // Gr√°fico de desempenho
        function renderPerformanceChart(type) {
            const ctx = document.getElementById('performanceChart').getContext('2d');
            
            if (performanceChart) {
                performanceChart.destroy();
            }
            
            let labels = [];
            let data = [];
            
            if (type === 'week') {
                // √öltimas 8 semanas
                for (let i = 7; i >= 0; i--) {
                    const week = currentWeek - i;
                    const weekKey = `${currentYear}-W${week}`;
                    
                    let weekScore = 0;
                    let totalPossible = 0;
                    
                    habits.forEach(habit => {
                        const count = habit.counts[weekKey] || 0;
                        weekScore += Math.min(1, count / habit.goal);
                        totalPossible += 1;
                    });
                    
                    labels.push(`Sem ${week}`);
                    data.push(totalPossible > 0 ? Math.round((weekScore / totalPossible) * 100) : 0);
                }
            } else {
                // √öltimos 6 meses
                for (let i = 5; i >= 0; i--) {
                    const month = currentMonth - i;
                    let year = currentYear;
                    let monthIdx = month;
                    
                    if (month < 0) {
                        monthIdx = 12 + month;
                        year--;
                    }
                    
                    const monthKey = `${year}-${monthIdx}`;
                    
                    let monthScore = 0;
                    let monthTotalPossible = 0;
                    
                    habits.forEach(habit => {
                        let monthCount = 0;
                        let monthGoal = 0;
                        
                        Object.keys(habit.counts).forEach(weekKey => {
                            if (weekKey.startsWith(monthKey)) {
                                monthCount += habit.counts[weekKey];
                                monthGoal += habit.goal;
                            }
                        });
                        
                        monthScore += Math.min(1, monthCount / (monthGoal || 1));
                        monthTotalPossible += 1;
                    });
                    
                    const monthNames = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];
                    labels.push(`${monthNames[monthIdx]}/${year.toString().slice(2)}`);
                    data.push(monthTotalPossible > 0 ? Math.round((monthScore / monthTotalPossible) * 100) : 0);
                }
            }
            
            performanceChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Desempenho',
                        data: data,
                        borderColor: '#6366f1',
                        backgroundColor: 'rgba(99, 102, 241, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.3,
                        pointBackgroundColor: '#6366f1',
                        pointRadius: 5,
                        pointHoverRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#94a3b8'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#94a3b8'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        // Salvar dados no localStorage
        function saveData() {
            localStorage.setItem("habitGamePro", JSON.stringify(habits));
            localStorage.setItem("habitGameProData", JSON.stringify(appData));
        }

        // Inicializar aplica√ß√£o quando a p√°gina carregar
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>