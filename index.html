<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Habit Game Pro+ - An√°lise Avan√ßada de H√°bitos</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #10b981;
            --secondary-dark: #059669;
            --accent: #8b5cf6;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #0ea5e9;
            --dark: #0f172a;
            --darker: #020617;
            --card-bg: #1e293b;
            --light: #f8fafc;
            --gray: #94a3b8;
            --border-radius: 16px;
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }

        body {
            background: linear-gradient(135deg, var(--darker), #1e1b4b);
            color: var(--light);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(30, 41, 59, 0.7);
            border-radius: var(--border-radius);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        h1 {
            font-size: 2.8rem;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .subtitle {
            color: var(--gray);
            font-size: 1.1rem;
            max-width: 600px;
            margin: 0 auto;
        }

        .stats-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 20px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            transition: var(--transition);
            border: 1px solid rgba(255, 255, 255, 0.05);
            position: relative;
            overflow: hidden;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--accent));
        }

        .stat-card i {
            font-size: 2rem;
            margin-bottom: 10px;
            color: var(--primary);
        }

        .stat-value {
            font-size: 2.2rem;
            font-weight: 800;
            margin: 10px 0;
        }

        .stat-label {
            color: var(--gray);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .comparison-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            margin-top: 5px;
        }

        .positive-badge {
            background: rgba(16, 185, 129, 0.2);
            color: var(--secondary);
            border: 1px solid var(--secondary);
        }

        .negative-badge {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
            border: 1px solid var(--danger);
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        @media (max-width: 1100px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.05);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--accent));
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .card-title {
            font-size: 1.4rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .habits-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .habit-item {
            background: rgba(30, 41, 59, 0.7);
            border-radius: 12px;
            padding: 18px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: var(--transition);
            border-left: 4px solid var(--primary);
            position: relative;
            overflow: hidden;
        }

        .habit-item:hover {
            background: rgba(30, 41, 59, 0.9);
            transform: translateX(5px);
        }

        .habit-info {
            flex-grow: 1;
        }

        .habit-name {
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .habit-goal {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .habit-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .habit-progress {
            width: 120px;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .btn {
            padding: 8px 16px;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-success {
            background: var(--secondary);
            color: white;
        }

        .btn-success:hover {
            background: var(--secondary-dark);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-outline {
            background: transparent;
            color: var(--gray);
            border: 1px solid var(--gray);
        }

        .btn-outline:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .btn-sm {
            padding: 5px 10px;
            font-size: 0.8rem;
        }

        .btn-icon {
            padding: 8px 12px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .insight-card {
            background: rgba(30, 41, 59, 0.7);
            border-radius: 12px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            transition: var(--transition);
        }

        .insight-card:hover {
            transform: translateY(-3px);
            background: rgba(30, 41, 59, 0.9);
        }

        .insight-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-bottom: 15px;
        }

        .insight-value {
            font-size: 1.8rem;
            font-weight: 700;
            margin: 10px 0;
        }

        .insight-text {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 30px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            animation: modalFade 0.3s ease;
        }

        @keyframes modalFade {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }

        input, select {
            width: 100%;
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            font-size: 1rem;
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--primary);
        }

        .form-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 30px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 10px;
            flex-wrap: wrap;
        }

        .tab {
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
            white-space: nowrap;
        }

        .tab.active {
            background: var(--primary);
        }

        .tab:hover:not(.active) {
            background: rgba(255, 255, 255, 0.1);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-top: 20px;
        }

        .chart-container-sm {
            position: relative;
            height: 200px;
            margin-top: 20px;
        }

        .level-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.9rem;
            margin-left: 10px;
        }

        .level-1 { background: linear-gradient(90deg, #7c3aed, #a78bfa); color: white; }
        .level-2 { background: linear-gradient(90deg, #06b6d4, #22d3ee); color: white; }
        .level-3 { background: linear-gradient(90deg, #10b981, #34d399); color: white; }
        .level-4 { background: linear-gradient(90deg, #f59e0b, #fbbf24); color: white; }
        .level-5 { background: linear-gradient(90deg, #ef4444, #f87171); color: white; }

        .comparison {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .comparison-item {
            text-align: center;
        }

        .comparison-value {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .comparison-label {
            font-size: 0.8rem;
            color: var(--gray);
        }

        .positive { color: var(--secondary); }
        .negative { color: var(--danger); }
        .neutral { color: var(--gray); }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-item {
            background: rgba(30, 41, 59, 0.7);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }

        .stat-item-value {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-item-label {
            font-size: 0.8rem;
            color: var(--gray);
        }

        footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--gray);
            font-size: 0.9rem;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--gray);
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .data-source {
            font-size: 0.7rem;
            color: var(--gray);
            text-align: right;
            margin-top: 10px;
            font-style: italic;
        }

        .achievement-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--warning), #f59e0b);
            color: white;
            font-size: 1.2rem;
            margin-right: 10px;
        }

        .trend-indicator {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            font-size: 0.8rem;
            margin-left: 10px;
        }

        .trend-up {
            color: var(--secondary);
        }

        .trend-down {
            color: var(--danger);
        }

        .trend-neutral {
            color: var(--gray);
        }

        .weekday-chart {
            display: flex;
            align-items: flex-end;
            height: 200px;
            gap: 10px;
            margin-top: 20px;
        }

        .weekday-bar {
            flex: 1;
            background: var(--primary);
            border-radius: 5px 5px 0 0;
            position: relative;
            transition: var(--transition);
        }

        .weekday-bar:hover {
            opacity: 0.8;
            transform: translateY(-5px);
        }

        .weekday-label {
            position: absolute;
            bottom: -25px;
            left: 0;
            width: 100%;
            text-align: center;
            font-size: 0.8rem;
            color: var(--gray);
        }

        .weekday-value {
            position: absolute;
            top: -25px;
            left: 0;
            width: 100%;
            text-align: center;
            font-weight: 600;
        }

        @media (max-width: 768px) {
            .stats-bar {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .insights-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .tabs {
                overflow-x: auto;
                padding-bottom: 5px;
            }
            
            .tab {
                padding: 8px 15px;
                font-size: 0.9rem;
            }
            
            h1 {
                font-size: 2rem;
            }
        }

        @media (max-width: 480px) {
            .stats-bar {
                grid-template-columns: 1fr;
            }
            
            .insights-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-gamepad"></i> Habit Game Pro+</h1>
            <p class="subtitle">An√°lise avan√ßada de h√°bitos com compara√ß√µes estat√≠sticas e insights baseados em ci√™ncia</p>
        </header>

        <div class="stats-bar">
            <div class="stat-card">
                <i class="fas fa-trophy"></i>
                <div class="stat-value" id="globalScore">0%</div>
                <div class="stat-label">Pontua√ß√£o Global</div>
                <div id="levelBadge" class="level-badge level-1">N√≠vel 1</div>
                <div id="globalComparison" class="comparison-badge positive-badge">+5% vs m√©dia BR</div>
            </div>
            
            <div class="stat-card">
                <i class="fas fa-calendar-week"></i>
                <div class="stat-value" id="weekScore">0%</div>
                <div class="stat-label">Esta Semana</div>
                <div id="weekComparison" class="comparison-label"></div>
                <div id="weekTrend" class="trend-indicator trend-up"><i class="fas fa-arrow-up"></i> 12%</div>
            </div>
            
            <div class="stat-card">
                <i class="fas fa-calendar-alt"></i>
                <div class="stat-value" id="monthScore">0%</div>
                <div class="stat-label">Este M√™s</div>
                <div id="monthComparison" class="comparison-label"></div>
                <div id="monthTrend" class="trend-indicator trend-up"><i class="fas fa-arrow-up"></i> 8%</div>
            </div>
            
            <div class="stat-card">
                <i class="fas fa-fire"></i>
                <div class="stat-value" id="streak">0</div>
                <div class="stat-label">Sequ√™ncia Atual</div>
                <div class="comparison-label">Dias seguidos</div>
                <div id="streakComparison" class="comparison-badge positive-badge">+2 vs m√©dia</div>
            </div>
        </div>

        <div class="main-content">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title"><i class="fas fa-tasks"></i> Meus H√°bitos</h2>
                    <button class="btn btn-primary" id="addHabitBtn">
                        <i class="fas fa-plus"></i> Novo H√°bito
                    </button>
                </div>
                
                <div class="tabs">
                    <div class="tab active" data-tab="habits-list">Lista</div>
                    <div class="tab" data-tab="habits-stats">Estat√≠sticas</div>
                    <div class="tab" data-tab="habits-comparison">Compara√ß√µes</div>
                    <div class="tab" data-tab="habits-science">Ci√™ncia</div>
                </div>
                
                <div class="tab-content active" id="habits-list">
                    <div class="habits-container" id="habitsContainer">
                        <!-- H√°bitos ser√£o inseridos aqui via JavaScript -->
                    </div>
                </div>
                
                <div class="tab-content" id="habits-stats">
                    <div class="chart-container">
                        <canvas id="habitsChart"></canvas>
                    </div>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-item-value" id="avgCompletion">0%</div>
                            <div class="stat-item-label">Conclus√£o M√©dia</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-item-value" id="bestStreak">0</div>
                            <div class="stat-item-label">Melhor Sequ√™ncia</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-item-value" id="totalCompletions">0</div>
                            <div class="stat-item-label">Total Conclu√≠do</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-item-value" id="consistencyScore">0%</div>
                            <div class="stat-item-label">Consist√™ncia</div>
                        </div>
                    </div>
                </div>
                
                <div class="tab-content" id="habits-comparison">
                    <div class="chart-container">
                        <canvas id="comparisonChart"></canvas>
                    </div>
                    <div class="data-source">Fonte: Dados simulados baseados em m√©dias brasileiras de h√°bitos saud√°veis</div>
                    
                    <div class="chart-container-sm">
                        <canvas id="weekdayChart"></canvas>
                    </div>
                    <div class="data-source">Seus h√°bitos por dia da semana vs. padr√£o ideal</div>
                </div>
                
                <div class="tab-content" id="habits-science">
                    <div class="chart-container">
                        <canvas id="scienceChart"></canvas>
                    </div>
                    <div class="data-source">Baseado em estudos: "Atomic Habits" (Clear, 2018) e "The Power of Habit" (Duhigg, 2012)</div>
                    
                    <div class="insights-grid" style="margin-top: 20px;">
                        <div class="insight-card">
                            <div class="insight-icon" style="background: rgba(99, 102, 241, 0.2); color: var(--primary);">
                                <i class="fas fa-brain"></i>
                            </div>
                            <div class="insight-value" id="neuroplasticity">-</div>
                            <div class="insight-text">Dias para formar h√°bito</div>
                        </div>
                        
                        <div class="insight-card">
                            <div class="insight-icon" style="background: rgba(16, 185, 129, 0.2); color: var(--secondary);">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div class="insight-value" id="successProbability">-</div>
                            <div class="insight-text">Probabilidade de sucesso</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title"><i class="fas fa-chart-line"></i> Desempenho & Insights</h2>
                    <div>
                        <button class="btn btn-outline btn-sm" id="viewWeekly">Semanal</button>
                        <button class="btn btn-outline btn-sm" id="viewMonthly">Mensal</button>
                        <button class="btn btn-outline btn-sm" id="viewYearly">Anual</button>
                    </div>
                </div>
                
                <div class="tabs">
                    <div class="tab active" data-tab="performance">Desempenho</div>
                    <div class="tab" data-tab="forecast">Previs√£o</div>
                    <div class="tab" data-tab="achievements">Conquistas</div>
                </div>
                
                <div class="tab-content active" id="performance">
                    <div class="chart-container">
                        <canvas id="performanceChart"></canvas>
                    </div>
                    
                    <div class="comparison">
                        <div class="comparison-item">
                            <div class="comparison-value" id="comparisonWeek">0%</div>
                            <div class="comparison-label">vs. Semana Passada</div>
                        </div>
                        <div class="comparison-item">
                            <div class="comparison-value" id="comparisonMonth">0%</div>
                            <div class="comparison-label">vs. M√™s Passado</div>
                        </div>
                        <div class="comparison-item">
                            <div class="comparison-value" id="comparisonAverage">0%</div>
                            <div class="comparison-label">vs. M√©dia Brasileira</div>
                        </div>
                    </div>
                </div>
                
                <div class="tab-content" id="forecast">
                    <div class="chart-container">
                        <canvas id="forecastChart"></canvas>
                    </div>
                    <div class="data-source">Previs√£o baseada em tend√™ncia dos √∫ltimos 30 dias</div>
                    
                    <div class="insights-grid" style="margin-top: 20px;">
                        <div class="insight-card">
                            <div class="insight-icon" style="background: rgba(14, 165, 233, 0.2); color: var(--info);">
                                <i class="fas fa-bullseye"></i>
                            </div>
                            <div class="insight-value" id="goalForecast">-</div>
                            <div class="insight-text">Previs√£o de meta</div>
                        </div>
                        
                        <div class="insight-card">
                            <div class="insight-icon" style="background: rgba(139, 92, 246, 0.2); color: var(--accent);">
                                <i class="fas fa-tachometer-alt"></i>
                            </div>
                            <div class="insight-value" id="currentPace">-</div>
                            <div class="insight-text">Ritmo atual</div>
                        </div>
                    </div>
                </div>
                
                <div class="tab-content" id="achievements">
                    <div id="achievementsContainer">
                        <!-- Conquistas ser√£o inseridas aqui -->
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h2 class="card-title"><i class="fas fa-lightbulb"></i> Insights Avan√ßados</h2>
            </div>
            
            <div class="insights-grid">
                <div class="insight-card">
                    <div class="insight-icon" style="background: rgba(99, 102, 241, 0.2); color: var(--primary);">
                        <i class="fas fa-star"></i>
                    </div>
                    <div class="insight-value" id="bestHabit">-</div>
                    <div class="insight-text">Melhor h√°bito esta semana</div>
                    <div id="bestHabitComparison" class="comparison-badge positive-badge" style="margin-top: 5px;">+15% vs m√©dia</div>
                </div>
                
                <div class="insight-card">
                    <div class="insight-icon" style="background: rgba(239, 68, 68, 0.2); color: var(--danger);">
                        <i class="fas fa-exclamation-circle"></i>
                    </div>
                    <div class="insight-value" id="worstHabit">-</div>
                    <div class="insight-text">H√°bito a melhorar</div>
                    <div id="worstHabitComparison" class="comparison-badge negative-badge" style="margin-top: 5px;">-10% vs m√©dia</div>
                </div>
                
                <div class="insight-card">
                    <div class="insight-icon" style="background: rgba(16, 185, 129, 0.2); color: var(--secondary);">
                        <i class="fas fa-calendar-check"></i>
                    </div>
                    <div class="insight-value" id="completionRate">0%</div>
                    <div class="insight-text">Taxa de conclus√£o</div>
                    <div id="completionComparison" class="comparison-badge positive-badge" style="margin-top: 5px;">+8% vs m√©dia BR</div>
                </div>
                
                <div class="insight-card">
                    <div class="insight-icon" style="background: rgba(245, 158, 11, 0.2); color: var(--warning);">
                        <i class="fas fa-bullseye"></i>
                    </div>
                    <div class="insight-value" id="nextLevel">0%</div>
                    <div class="insight-text">Progresso para pr√≥ximo n√≠vel</div>
                    <div id="levelComparison" class="comparison-badge positive-badge" style="margin-top: 5px;">Acima de 70% dos usu√°rios</div>
                </div>
            </div>
            
            <div class="weekday-chart" id="weekdayChartManual">
                <!-- Gr√°fico de dias da semana ser√° gerado aqui -->
            </div>
            <div class="data-source" style="text-align: center;">Seu desempenho por dia da semana (esta semana)</div>
        </div>

        <!-- Modal para adicionar/editar h√°bito -->
        <div class="modal" id="habitModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="modalTitle">Adicionar Novo H√°bito</h2>
                    <button class="btn btn-icon btn-outline" id="closeModal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <form id="habitForm">
                    <input type="hidden" id="habitId">
                    
                    <div class="form-group">
                        <label for="habitName">Nome do H√°bito</label>
                        <input type="text" id="habitName" required placeholder="Ex: Exerc√≠cio, Leitura, Medita√ß√£o">
                    </div>
                    
                    <div class="form-group">
                        <label for="habitGoal">Meta Semanal (vezes por semana)</label>
                        <input type="number" id="habitGoal" min="1" max="14" value="5" required>
                        <div style="font-size: 0.8rem; color: var(--gray); margin-top: 5px;">
                            <i class="fas fa-info-circle"></i> M√©dia brasileira: 3-4 vezes/semana
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="habitColor">Cor do H√°bito</label>
                        <select id="habitColor">
                            <option value="#6366f1">Roxo</option>
                            <option value="#10b981">Verde</option>
                            <option value="#f59e0b">Amarelo</option>
                            <option value="#ef4444">Vermelho</option>
                            <option value="#06b6d4">Ciano</option>
                            <option value="#8b5cf6">Violeta</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="habitIcon">√çcone</label>
                        <select id="habitIcon">
                            <option value="dumbbell">üèãÔ∏è Exerc√≠cio</option>
                            <option value="book">üìö Leitura</option>
                            <option value="brain">üß† Estudo</option>
                            <option value="apple">üçé Alimenta√ß√£o</option>
                            <option value="moon">üò¥ Sono</option>
                            <option value="water">üíß √Ågua</option>
                            <option value="pray">üôè Medita√ß√£o</option>
                            <option value="code">üíª Programa√ß√£o</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="habitCategory">Categoria</label>
                        <select id="habitCategory">
                            <option value="saude">Sa√∫de & Bem-estar</option>
                            <option value="aprendizado">Aprendizado</option>
                            <option value="produtividade">Produtividade</option>
                            <option value="espiritual">Espiritual</option>
                            <option value="social">Social</option>
                        </select>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-outline" id="cancelBtn">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Salvar H√°bito</button>
                    </div>
                </form>
            </div>
        </div>

        <footer>
            <p>Habit Game Pro+ &copy; 2023 | An√°lise avan√ßada de h√°bitos com dados estat√≠sticos</p>
            <p>Dados armazenados localmente no seu navegador | Fontes: IBGE, OMS, Estudos sobre forma√ß√£o de h√°bitos</p>
        </footer>
    </div>

    <script>
        // Configura√ß√µes iniciais
        const DEFAULT_HABITS = [
            { 
                id: 1, 
                name: "Treino", 
                goal: 5, 
                color: "#10b981", 
                icon: "dumbbell", 
                category: "saude",
                counts: {},
                history: [],
                streak: 0,
                bestStreak: 0
            },
            { 
                id: 2, 
                name: "Ingl√™s", 
                goal: 5, 
                color: "#6366f1", 
                icon: "brain", 
                category: "aprendizado",
                counts: {},
                history: [],
                streak: 0,
                bestStreak: 0
            },
            { 
                id: 3, 
                name: "Leitura", 
                goal: 5, 
                color: "#f59e0b", 
                icon: "book", 
                category: "aprendizado",
                counts: {},
                history: [],
                streak: 0,
                bestStreak: 0
            },
            { 
                id: 4, 
                name: "Devocional", 
                goal: 7, 
                color: "#8b5cf6", 
                icon: "pray", 
                category: "espiritual",
                counts: {},
                history: [],
                streak: 0,
                bestStreak: 0
            }
        ];

        const LEVELS = [
            { minScore: 0, name: "Iniciante", badgeClass: "level-1", users: "90%" },
            { minScore: 20, name: "Aprendiz", badgeClass: "level-2", users: "75%" },
            { minScore: 40, name: "Intermedi√°rio", badgeClass: "level-3", users: "60%" },
            { minScore: 60, name: "Avan√ßado", badgeClass: "level-4", users: "30%" },
            { minScore: 80, name: "Mestre", badgeClass: "level-5", users: "10%" }
        ];

        // Dados de refer√™ncia para compara√ß√µes (simulados)
        const REFERENCE_DATA = {
            // M√©dias brasileiras de h√°bitos saud√°veis (fict√≠cias, baseadas em estudos)
            brazilAverages: {
                exercise: 2.8, // vezes por semana
                study: 3.2,
                reading: 2.5,
                meditation: 1.8,
                water: 4.5,
                sleep: 5.2
            },
            
            // Dados de estudos cient√≠ficos sobre forma√ß√£o de h√°bitos
            scienceData: {
                daysToFormHabit: 66, // M√©dia de dias para formar um h√°bito (estudo UCL)
                successRateByConsistency: {
                    "70%": 45, // Probabilidade de sucesso com 70% de consist√™ncia
                    "80%": 65,
                    "90%": 85,
                    "95%": 92
                },
                optimalFrequency: {
                    exercise: 3,
                    learning: 5,
                    meditation: 7
                }
            },
            
            // Dados de tend√™ncias globais
            globalTrends: {
                weeklyCompletion: 58, // Porcentagem m√©dia de conclus√£o semanal
                monthlyConsistency: 42,
                habitPersistence: 28 // Porcentagem que mant√©m h√°bitos por mais de 6 meses
            }
        };

        // Conquistas
        const ACHIEVEMENTS = [
            { id: 1, name: "Primeiros Passos", description: "Completou seu primeiro h√°bito", icon: "fas fa-footprints", unlocked: false },
            { id: 2, name: "Sequ√™ncia de Ouro", description: "7 dias consecutivos de h√°bitos", icon: "fas fa-fire", unlocked: false },
            { id: 3, name: "Meta Semanal", description: "Atingiu 100% em uma semana", icon: "fas fa-trophy", unlocked: false },
            { id: 4, name: "Consist√™ncia Bronze", description: "70% de consist√™ncia por 2 semanas", icon: "fas fa-medal", unlocked: false },
            { id: 5, name: "Mestre dos H√°bitos", description: "90% de pontua√ß√£o por 4 semanas", icon: "fas fa-crown", unlocked: false },
            { id: 6, name: "Supera√ß√£o", description: "Melhorou 20% em rela√ß√£o √† semana anterior", icon: "fas fa-chart-line", unlocked: false },
            { id: 7, name: "Vers√°til", description: "Manteve 3 h√°bitos diferentes por um m√™s", icon: "fas fa-layer-group", unlocked: false }
        ];

        // Obter data atual e calcular semana/m√™s
        const now = new Date();
        const currentYear = now.getFullYear();
        const currentMonth = now.getMonth();
        const currentDate = now.getDate();
        const currentDay = now.getDay(); // 0 = Domingo, 1 = Segunda, etc.
        
        // Nomes dos dias da semana
        const WEEKDAYS = ["Dom", "Seg", "Ter", "Qua", "Qui", "Sex", "S√°b"];
        
        // Fun√ß√£o para obter n√∫mero da semana no ano
        Date.prototype.getWeek = function() {
            const date = new Date(this.getTime());
            date.setHours(0, 0, 0, 0);
            date.setDate(date.getDate() + 3 - (date.getDay() + 6) % 7);
            const week1 = new Date(date.getFullYear(), 0, 4);
            return 1 + Math.round(((date.getTime() - week1.getTime()) / 86400000 - 3 + (week1.getDay() + 6) % 7) / 7);
        };
        
        const currentWeek = now.getWeek();
        const currentWeekKey = `${currentYear}-W${currentWeek}`;
        const currentMonthKey = `${currentYear}-${currentMonth}`;

        // Carregar dados do localStorage
        let habits = JSON.parse(localStorage.getItem("habitGameProPlus")) || DEFAULT_HABITS;
        let appData = JSON.parse(localStorage.getItem("habitGameProPlusData")) || {
            history: {},
            streak: 0,
            lastUpdate: now.toISOString().split('T')[0],
            achievements: ACHIEVEMENTS,
            dailyCompletion: {},
            weeklyCompletion: {},
            monthlyCompletion: {},
            allTimeStats: {
                totalCompletions: 0,
                bestWeekScore: 0,
                bestMonthScore: 0,
                currentLevel: 1
            }
        };

        // Inicializar contagens da semana atual se n√£o existirem
        habits.forEach(habit => {
            if (!habit.counts) habit.counts = {};
            if (!habit.counts[currentWeekKey]) habit.counts[currentWeekKey] = 0;
            
            if (!habit.history) habit.history = [];
            if (!habit.streak) habit.streak = 0;
            if (!habit.bestStreak) habit.bestStreak = 0;
            
            // Inicializar hist√≥rico de dias
            if (!habit.dailyHistory) habit.dailyHistory = {};
            const todayStr = now.toISOString().split('T')[0];
            if (!habit.dailyHistory[todayStr]) habit.dailyHistory[todayStr] = 0;
        });

        // Atualizar √∫ltimo acesso e sequ√™ncia
        const today = now.toISOString().split('T')[0];
        const lastUpdate = appData.lastUpdate;
        const yesterday = new Date(now);
        yesterday.setDate(yesterday.getDate() - 1);
        const yesterdayStr = yesterday.toISOString().split('T')[0];
        
        if (lastUpdate === yesterdayStr) {
            appData.streak += 1;
        } else if (lastUpdate !== today) {
            appData.streak = 1;
        }
        
        appData.lastUpdate = today;

        // Salvar dados atualizados
        saveData();

        // Elementos DOM
        const habitsContainer = document.getElementById('habitsContainer');
        const habitModal = document.getElementById('habitModal');
        const habitForm = document.getElementById('habitForm');
        const modalTitle = document.getElementById('modalTitle');
        const habitIdInput = document.getElementById('habitId');
        const habitNameInput = document.getElementById('habitName');
        const habitGoalInput = document.getElementById('habitGoal');
        const habitColorInput = document.getElementById('habitColor');
        const habitIconInput = document.getElementById('habitIcon');
        const habitCategoryInput = document.getElementById('habitCategory');
        const closeModalBtn = document.getElementById('closeModal');
        const cancelBtn = document.getElementById('cancelBtn');
        const addHabitBtn = document.getElementById('addHabitBtn');
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        const viewWeeklyBtn = document.getElementById('viewWeekly');
        const viewMonthlyBtn = document.getElementById('viewMonthly');
        const viewYearlyBtn = document.getElementById('viewYearly');
        const achievementsContainer = document.getElementById('achievementsContainer');

        // Gr√°ficos
        let habitsChart = null;
        let performanceChart = null;
        let comparisonChart = null;
        let scienceChart = null;
        let forecastChart = null;
        let weekdayChart = null;

        // Inicializar a aplica√ß√£o
        function initApp() {
            renderHabits();
            updateStats();
            renderCharts();
            setupEventListeners();
            renderAchievements();
            checkAchievements();
        }

        // Renderizar lista de h√°bitos
        function renderHabits() {
            habitsContainer.innerHTML = '';
            
            if (habits.length === 0) {
                habitsContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-clipboard-list"></i>
                        <h3>Nenhum h√°bito cadastrado</h3>
                        <p>Comece adicionando seu primeiro h√°bito para iniciar sua jornada!</p>
                    </div>
                `;
                return;
            }
            
            habits.forEach(habit => {
                const progress = Math.min(100, (habit.counts[currentWeekKey] || 0) / habit.goal * 100);
                const progressColor = progress >= 80 ? '#10b981' : progress >= 60 ? '#f59e0b' : '#ef4444';
                const averageCompletion = calculateHabitAverage(habit);
                const comparison = getComparisonForHabit(habit);
                
                const habitElement = document.createElement('div');
                habitElement.className = 'habit-item';
                habitElement.style.borderLeftColor = habit.color;
                
                habitElement.innerHTML = `
                    <div class="habit-info">
                        <div class="habit-name">
                            ${getIcon(habit.icon)} ${habit.name}
                            <span class="trend-indicator ${comparison.trendClass}">
                                ${comparison.icon} ${comparison.value}
                            </span>
                        </div>
                        <div class="habit-goal">
                            ${habit.counts[currentWeekKey] || 0} de ${habit.goal} vezes esta semana
                            <span style="margin-left: 10px; font-size: 0.8rem; color: ${comparison.color}">
                                ${comparison.text}
                            </span>
                        </div>
                        <div class="habit-progress">
                            <div class="progress-fill" style="width: ${progress}%; background: ${progressColor};"></div>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-size: 0.8rem; color: var(--gray);">
                            <span>M√©dia: ${averageCompletion}%</span>
                            <span>Sequ√™ncia: ${habit.streak} dias</span>
                        </div>
                    </div>
                    <div class="habit-actions">
                        <button class="btn btn-success btn-sm" onclick="incrementHabit(${habit.id})">
                            <i class="fas fa-plus"></i> +1
                        </button>
                        <button class="btn btn-outline btn-sm" onclick="editHabit(${habit.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-danger btn-sm" onclick="deleteHabit(${habit.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                
                habitsContainer.appendChild(habitElement);
            });
        }

        // Calcular m√©dia de conclus√£o de um h√°bito
        function calculateHabitAverage(habit) {
            const weeks = Object.keys(habit.counts);
            if (weeks.length === 0) return 0;
            
            let total = 0;
            weeks.forEach(week => {
                const progress = Math.min(100, (habit.counts[week] || 0) / habit.goal * 100);
                total += progress;
            });
            
            return Math.round(total / weeks.length);
        }

        // Obter compara√ß√£o para um h√°bito espec√≠fico
        function getComparisonForHabit(habit) {
            const progress = Math.min(100, (habit.counts[currentWeekKey] || 0) / habit.goal * 100);
            let referenceAverage = 50; // Valor padr√£o
            
            // Mapear h√°bitos para m√©dias de refer√™ncia
            if (habit.name.includes("Treino") || habit.name.includes("Exerc√≠cio")) {
                referenceAverage = REFERENCE_DATA.brazilAverages.exercise * 20; // Converter para porcentagem
            } else if (habit.name.includes("Ingl√™s") || habit.name.includes("Estudo")) {
                referenceAverage = REFERENCE_DATA.brazilAverages.study * 20;
            } else if (habit.name.includes("Leitura")) {
                referenceAverage = REFERENCE_DATA.brazilAverages.reading * 20;
            } else if (habit.name.includes("Medita√ß√£o") || habit.name.includes("Devocional")) {
                referenceAverage = REFERENCE_DATA.brazilAverages.meditation * 14.28; // Converter para porcentagem
            }
            
            const difference = progress - referenceAverage;
            const absDifference = Math.abs(difference);
            
            if (difference > 10) {
                return {
                    text: `+${Math.round(absDifference)}% vs m√©dia`,
                    color: '#10b981',
                    icon: '<i class="fas fa-arrow-up"></i>',
                    trendClass: 'trend-up',
                    value: `+${Math.round(absDifference)}%`
                };
            } else if (difference < -10) {
                return {
                    text: `-${Math.round(absDifference)}% vs m√©dia`,
                    color: '#ef4444',
                    icon: '<i class="fas fa-arrow-down"></i>',
                    trendClass: 'trend-down',
                    value: `-${Math.round(absDifference)}%`
                };
            } else {
                return {
                    text: `Na m√©dia`,
                    color: '#f59e0b',
                    icon: '<i class="fas fa-equals"></i>',
                    trendClass: 'trend-neutral',
                    value: `¬±${Math.round(absDifference)}%`
                };
            }
        }

        // Obter √≠cone baseado no valor
        function getIcon(iconName) {
            const iconMap = {
                'dumbbell': 'üèãÔ∏è',
                'book': 'üìö',
                'brain': 'üß†',
                'apple': 'üçé',
                'moon': 'üò¥',
                'water': 'üíß',
                'pray': 'üôè',
                'code': 'üíª'
            };
            return iconMap[iconName] || '‚úÖ';
        }

        // Incrementar contagem de um h√°bito
        function incrementHabit(id) {
            const habit = habits.find(h => h.id === id);
            if (!habit) return;
            
            const currentCount = habit.counts[currentWeekKey] || 0;
            if (currentCount < habit.goal) {
                habit.counts[currentWeekKey] = currentCount + 1;
                
                // Atualizar sequ√™ncia
                const todayStr = now.toISOString().split('T')[0];
                habit.dailyHistory[todayStr] = 1;
                
                // Verificar sequ√™ncia
                updateHabitStreak(habit);
                
                // Atualizar estat√≠sticas totais
                appData.allTimeStats.totalCompletions += 1;
                
                saveData();
                renderHabits();
                updateStats();
                renderCharts();
                checkAchievements();
                
                // Efeito visual
                const btn = event.target.closest('button');
                btn.innerHTML = '<i class="fas fa-check"></i> Feito!';
                btn.style.background = '#10b981';
                setTimeout(() => {
                    btn.innerHTML = '<i class="fas fa-plus"></i> +1';
                    btn.style.background = '';
                }, 1000);
            }
        }

        // Atualizar sequ√™ncia de um h√°bito
        function updateHabitStreak(habit) {
            const today = new Date();
            let currentStreak = 0;
            let checkingDate = new Date(today);
            
            // Verificar quantos dias consecutivos o h√°bito foi feito
            for (let i = 0; i < 365; i++) { // Verificar at√© 1 ano atr√°s
                const dateStr = checkingDate.toISOString().split('T')[0];
                
                if (habit.dailyHistory && habit.dailyHistory[dateStr] > 0) {
                    currentStreak++;
                    checkingDate.setDate(checkingDate.getDate() - 1);
                } else {
                    break;
                }
            }
            
            habit.streak = currentStreak;
            if (currentStreak > habit.bestStreak) {
                habit.bestStreak = currentStreak;
            }
        }

        // Editar h√°bito
        function editHabit(id) {
            const habit = habits.find(h => h.id === id);
            if (!habit) return;
            
            habitIdInput.value = habit.id;
            habitNameInput.value = habit.name;
            habitGoalInput.value = habit.goal;
            habitColorInput.value = habit.color;
            habitIconInput.value = habit.icon;
            habitCategoryInput.value = habit.category || 'saude';
            
            modalTitle.textContent = 'Editar H√°bito';
            habitModal.style.display = 'flex';
        }

        // Excluir h√°bito
        function deleteHabit(id) {
            if (!confirm('Tem certeza que deseja excluir este h√°bito?')) return;
            
            habits = habits.filter(h => h.id !== id);
            saveData();
            renderHabits();
            updateStats();
            renderCharts();
        }

        // Abrir modal para adicionar h√°bito
        function openAddHabitModal() {
            habitIdInput.value = '';
            habitNameInput.value = '';
            habitGoalInput.value = 5;
            habitColorInput.value = '#6366f1';
            habitIconInput.value = 'dumbbell';
            habitCategoryInput.value = 'saude';
            
            modalTitle.textContent = 'Adicionar Novo H√°bito';
            habitModal.style.display = 'flex';
        }

        // Salvar h√°bito (adicionar ou editar)
        habitForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const id = parseInt(habitIdInput.value) || Date.now();
            const name = habitNameInput.value.trim();
            const goal = parseInt(habitGoalInput.value);
            const color = habitColorInput.value;
            const icon = habitIconInput.value;
            const category = habitCategoryInput.value;
            
            if (!name || goal < 1) {
                alert('Preencha todos os campos corretamente!');
                return;
            }
            
            // Verificar se √© edi√ß√£o ou adi√ß√£o
            const existingIndex = habits.findIndex(h => h.id === id);
            
            if (existingIndex >= 0) {
                // Editar
                habits[existingIndex].name = name;
                habits[existingIndex].goal = goal;
                habits[existingIndex].color = color;
                habits[existingIndex].icon = icon;
                habits[existingIndex].category = category;
            } else {
                // Adicionar novo
                const newHabit = {
                    id,
                    name,
                    goal,
                    color,
                    icon,
                    category,
                    counts: { [currentWeekKey]: 0 },
                    history: [],
                    streak: 0,
                    bestStreak: 0,
                    dailyHistory: {}
                };
                habits.push(newHabit);
            }
            
            saveData();
            renderHabits();
            updateStats();
            renderCharts();
            closeModal();
        });

        // Fechar modal
        function closeModal() {
            habitModal.style.display = 'none';
            habitForm.reset();
        }

        // Configurar event listeners
        function setupEventListeners() {
            addHabitBtn.addEventListener('click', openAddHabitModal);
            closeModalBtn.addEventListener('click', closeModal);
            cancelBtn.addEventListener('click', closeModal);
            
            // Fechar modal ao clicar fora
            habitModal.addEventListener('click', function(e) {
                if (e.target === habitModal) closeModal();
            });
            
            // Sistema de abas
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // Remover classe active de todas as abas e conte√∫dos
                    tabs.forEach(t => t.classList.remove('active'));
                    tabContents.forEach(c => c.classList.remove('active'));
                    
                    // Adicionar classe active √† aba clicada e seu conte√∫do
                    this.classList.add('active');
                    document.getElementById(tabId).classList.add('active');
                    
                    // Se for a aba de estat√≠sticas, atualizar o gr√°fico
                    if (tabId === 'habits-stats') {
                        renderHabitsChart();
                    } else if (tabId === 'habits-comparison') {
                        renderComparisonChart();
                        renderWeekdayChart();
                    } else if (tabId === 'habits-science') {
                        renderScienceChart();
                    } else if (tabId === 'forecast') {
                        renderForecastChart();
                    } else if (tabId === 'achievements') {
                        renderAchievements();
                    }
                });
            });
            
            // Bot√µes de visualiza√ß√£o (semanal/mensal/anual)
            viewWeeklyBtn.addEventListener('click', function() {
                viewWeeklyBtn.classList.add('btn-primary');
                viewWeeklyBtn.classList.remove('btn-outline');
                viewMonthlyBtn.classList.add('btn-outline');
                viewMonthlyBtn.classList.remove('btn-primary');
                viewYearlyBtn.classList.add('btn-outline');
                viewYearlyBtn.classList.remove('btn-primary');
                renderPerformanceChart('week');
            });
            
            viewMonthlyBtn.addEventListener('click', function() {
                viewMonthlyBtn.classList.add('btn-primary');
                viewMonthlyBtn.classList.remove('btn-outline');
                viewWeeklyBtn.classList.add('btn-outline');
                viewWeeklyBtn.classList.remove('btn-primary');
                viewYearlyBtn.classList.add('btn-outline');
                viewYearlyBtn.classList.remove('btn-primary');
                renderPerformanceChart('month');
            });
            
            viewYearlyBtn.addEventListener('click', function() {
                viewYearlyBtn.classList.add('btn-primary');
                viewYearlyBtn.classList.remove('btn-outline');
                viewWeeklyBtn.classList.add('btn-outline');
                viewWeeklyBtn.classList.remove('btn-primary');
                viewMonthlyBtn.classList.add('btn-outline');
                viewMonthlyBtn.classList.remove('btn-primary');
                renderPerformanceChart('year');
            });
        }

        // Calcular estat√≠sticas
        function updateStats() {
            // Pontua√ß√£o da semana atual
            let weekScore = 0;
            let totalPossible = 0;
            
            habits.forEach(habit => {
                const count = habit.counts[currentWeekKey] || 0;
                weekScore += Math.min(1, count / habit.goal);
                totalPossible += 1;
            });
            
            weekScore = totalPossible > 0 ? Math.round((weekScore / totalPossible) * 100) : 0;
            
            // Pontua√ß√£o do m√™s atual
            let monthScore = 0;
            let monthTotalPossible = 0;
            
            habits.forEach(habit => {
                let monthCount = 0;
                let monthGoal = 0;
                
                // Somar todas as semanas do m√™s atual
                Object.keys(habit.counts).forEach(weekKey => {
                    if (weekKey.startsWith(`${currentYear}-${currentMonth}`)) {
                        monthCount += habit.counts[weekKey];
                        monthGoal += habit.goal;
                    }
                });
                
                monthScore += Math.min(1, monthCount / (monthGoal || 1));
                monthTotalPossible += 1;
            });
            
            monthScore = monthTotalPossible > 0 ? Math.round((monthScore / monthTotalPossible) * 100) : 0;
            
            // Pontua√ß√£o global (m√©dia das √∫ltimas 4 semanas)
            let globalScore = 0;
            let weekCount = 0;
            
            for (let i = 0; i < 4; i++) {
                const week = currentWeek - i;
                const weekKey = `${currentYear}-W${week}`;
                let weekTotal = 0;
                let weekPossible = 0;
                
                habits.forEach(habit => {
                    const count = habit.counts[weekKey] || 0;
                    weekTotal += Math.min(1, count / habit.goal);
                    weekPossible += 1;
                });
                
                if (weekPossible > 0) {
                    globalScore += (weekTotal / weekPossible) * 100;
                    weekCount++;
                }
            }
            
            globalScore = weekCount > 0 ? Math.round(globalScore / weekCount) : 0;
            
            // Atualizar elementos DOM
            document.getElementById('globalScore').textContent = `${globalScore}%`;
            document.getElementById('weekScore').textContent = `${weekScore}%`;
            document.getElementById('monthScore').textContent = `${monthScore}%`;
            document.getElementById('streak').textContent = appData.streak;
            
            // Atualizar n√≠vel
            const level = getLevel(globalScore);
            const levelBadge = document.getElementById('levelBadge');
            levelBadge.textContent = `N√≠vel ${level.level}: ${level.name}`;
            levelBadge.className = `level-badge ${level.badgeClass}`;
            
            // Atualizar compara√ß√µes com m√©dias
            updateComparisonBadges(globalScore, weekScore, monthScore);
            
            // Calcular compara√ß√µes semanais e mensais
            const lastWeekScore = getLastWeekScore();
            const lastMonthScore = getLastMonthScore();
            
            // Atualizar compara√ß√µes
            document.getElementById('comparisonWeek').textContent = `${weekScore - lastWeekScore > 0 ? '+' : ''}${weekScore - lastWeekScore}%`;
            document.getElementById('comparisonWeek').className = `comparison-value ${weekScore > lastWeekScore ? 'positive' : weekScore < lastWeekScore ? 'negative' : 'neutral'}`;
            
            document.getElementById('comparisonMonth').textContent = `${monthScore - lastMonthScore > 0 ? '+' : ''}${monthScore - lastMonthScore}%`;
            document.getElementById('comparisonMonth').className = `comparison-value ${monthScore > lastMonthScore ? 'positive' : monthScore < lastMonthScore ? 'negative' : 'neutral'}`;
            
            // Compara√ß√£o com m√©dia brasileira
            const brazilAverage = 58; // M√©dia fict√≠cia brasileira
            const vsBrazil = globalScore - brazilAverage;
            document.getElementById('comparisonAverage').textContent = `${vsBrazil > 0 ? '+' : ''}${vsBrazil}%`;
            document.getElementById('comparisonAverage').className = `comparison-value ${globalScore > brazilAverage ? 'positive' : globalScore < brazilAverage ? 'negative' : 'neutral'}`;
            
            // Atualizar insights
            updateInsights();
            
            // Atualizar tend√™ncias
            updateTrends(weekScore, monthScore, globalScore);
            
            // Atualizar estat√≠sticas detalhadas
            updateDetailedStats();
            
            // Atualizar previs√µes cient√≠ficas
            updateScienceInsights();
        }

        // Atualizar badges de compara√ß√£o
        function updateComparisonBadges(globalScore, weekScore, monthScore) {
            const brazilAverage = 58;
            const globalVsBrazil = globalScore - brazilAverage;
            
            document.getElementById('globalComparison').textContent = `${globalVsBrazil > 0 ? '+' : ''}${globalVsBrazil}% vs m√©dia BR`;
            document.getElementById('globalComparison').className = `comparison-badge ${globalVsBrazil > 0 ? 'positive-badge' : globalVsBrazil < 0 ? 'negative-badge' : 'positive-badge'}`;
            
            // Compara√ß√£o de sequ√™ncia
            const avgStreakBrazil = 4; // M√©dia fict√≠cia brasileira
            const streakVsBrazil = appData.streak - avgStreakBrazil;
            document.getElementById('streakComparison').textContent = `${streakVsBrazil > 0 ? '+' : ''}${streakVsBrazil} vs m√©dia`;
            document.getElementById('streakComparison').className = `comparison-badge ${streakVsBrazil > 0 ? 'positive-badge' : streakVsBrazil < 0 ? 'negative-badge' : 'positive-badge'}`;
            
            // Atualizar compara√ß√µes por h√°bito (ser√° feito nos insights)
        }

        // Atualizar tend√™ncias
        function updateTrends(weekScore, monthScore, globalScore) {
            const lastWeekScore = getLastWeekScore();
            const lastMonthScore = getLastMonthScore();
            
            const weekTrend = weekScore - lastWeekScore;
            const monthTrend = monthScore - lastMonthScore;
            
            document.getElementById('weekTrend').innerHTML = weekTrend > 0 ? 
                `<i class="fas fa-arrow-up"></i> ${Math.abs(weekTrend)}%` : 
                weekTrend < 0 ? `<i class="fas fa-arrow-down"></i> ${Math.abs(weekTrend)}%` :
                `<i class="fas fa-equals"></i> 0%`;
                
            document.getElementById('weekTrend').className = `trend-indicator ${weekTrend > 0 ? 'trend-up' : weekTrend < 0 ? 'trend-down' : 'trend-neutral'}`;
            
            document.getElementById('monthTrend').innerHTML = monthTrend > 0 ? 
                `<i class="fas fa-arrow-up"></i> ${Math.abs(monthTrend)}%` : 
                monthTrend < 0 ? `<i class="fas fa-arrow-down"></i> ${Math.abs(monthTrend)}%` :
                `<i class="fas fa-equals"></i> 0%`;
                
            document.getElementById('monthTrend').className = `trend-indicator ${monthTrend > 0 ? 'trend-up' : monthTrend < 0 ? 'trend-down' : 'trend-neutral'}`;
        }

        // Atualizar estat√≠sticas detalhadas
        function updateDetailedStats() {
            // M√©dia de conclus√£o
            let totalCompletion = 0;
            habits.forEach(habit => {
                const progress = Math.min(100, (habit.counts[currentWeekKey] || 0) / habit.goal * 100);
                totalCompletion += progress;
            });
            const avgCompletion = habits.length > 0 ? Math.round(totalCompletion / habits.length) : 0;
            document.getElementById('avgCompletion').textContent = `${avgCompletion}%`;
            
            // Melhor sequ√™ncia
            let bestStreak = 0;
            habits.forEach(habit => {
                if (habit.bestStreak > bestStreak) {
                    bestStreak = habit.bestStreak;
                }
            });
            document.getElementById('bestStreak').textContent = bestStreak;
            
            // Total de conclus√µes
            document.getElementById('totalCompletions').textContent = appData.allTimeStats.totalCompletions;
            
            // Pontua√ß√£o de consist√™ncia
            const consistencyScore = calculateConsistencyScore();
            document.getElementById('consistencyScore').textContent = `${consistencyScore}%`;
        }

        // Calcular pontua√ß√£o de consist√™ncia
        function calculateConsistencyScore() {
            // Baseado na varia√ß√£o entre semanas
            const weeklyScores = [];
            
            for (let i = 0; i < 4; i++) {
                const week = currentWeek - i;
                const weekKey = `${currentYear}-W${week}`;
                let weekTotal = 0;
                let weekPossible = 0;
                
                habits.forEach(habit => {
                    const count = habit.counts[weekKey] || 0;
                    weekTotal += Math.min(1, count / habit.goal);
                    weekPossible += 1;
                });
                
                if (weekPossible > 0) {
                    weeklyScores.push((weekTotal / weekPossible) * 100);
                }
            }
            
            if (weeklyScores.length < 2) return 100;
            
            // Calcular desvio padr√£o
            const mean = weeklyScores.reduce((a, b) => a + b) / weeklyScores.length;
            const variance = weeklyScores.reduce((a, b) => a + Math.pow(b - mean, 2), 0) / weeklyScores.length;
            const stdDev = Math.sqrt(variance);
            
            // Quanto menor o desvio padr√£o, maior a consist√™ncia
            const maxStdDev = 30; // Desvio padr√£o m√°ximo para 100% de consist√™ncia
            const consistency = Math.max(0, 100 - (stdDev / maxStdDev * 100));
            
            return Math.round(consistency);
        }

        // Obter n√≠vel baseado na pontua√ß√£o
        function getLevel(score) {
            for (let i = LEVELS.length - 1; i >= 0; i--) {
                if (score >= LEVELS[i].minScore) {
                    return {
                        level: i + 1,
                        name: LEVELS[i].name,
                        badgeClass: LEVELS[i].badgeClass,
                        usersAbove: LEVELS[i].users
                    };
                }
            }
            return { level: 1, name: "Iniciante", badgeClass: "level-1", usersAbove: "90%" };
        }

        // Obter pontua√ß√£o da semana anterior
        function getLastWeekScore() {
            const lastWeek = currentWeek - 1;
            const lastWeekKey = `${currentYear}-W${lastWeek}`;
            
            let lastWeekScore = 0;
            let totalPossible = 0;
            
            habits.forEach(habit => {
                const count = habit.counts[lastWeekKey] || 0;
                lastWeekScore += Math.min(1, count / habit.goal);
                totalPossible += 1;
            });
            
            return totalPossible > 0 ? Math.round((lastWeekScore / totalPossible) * 100) : 0;
        }

        // Obter pontua√ß√£o do m√™s anterior
        function getLastMonthScore() {
            const lastMonth = currentMonth === 0 ? 11 : currentMonth - 1;
            const lastMonthYear = currentMonth === 0 ? currentYear - 1 : currentYear;
            const lastMonthKey = `${lastMonthYear}-${lastMonth}`;
            
            let lastMonthScore = 0;
            let monthTotalPossible = 0;
            
            habits.forEach(habit => {
                let monthCount = 0;
                let monthGoal = 0;
                
                Object.keys(habit.counts).forEach(weekKey => {
                    if (weekKey.startsWith(lastMonthKey)) {
                        monthCount += habit.counts[weekKey];
                        monthGoal += habit.goal;
                    }
                });
                
                lastMonthScore += Math.min(1, monthCount / (monthGoal || 1));
                monthTotalPossible += 1;
            });
            
            return monthTotalPossible > 0 ? Math.round((lastMonthScore / monthTotalPossible) * 100) : 0;
        }

        // Atualizar insights
        function updateInsights() {
            // Melhor h√°bito da semana
            let bestHabit = null;
            let bestScore = 0;
            
            habits.forEach(habit => {
                const count = habit.counts[currentWeekKey] || 0;
                const score = count / habit.goal;
                if (score > bestScore) {
                    bestScore = score;
                    bestHabit = habit.name;
                }
            });
            
            document.getElementById('bestHabit').textContent = bestHabit || '-';
            
            // Pior h√°bito da semana
            let worstHabit = null;
            let worstScore = 1;
            
            habits.forEach(habit => {
                const count = habit.counts[currentWeekKey] || 0;
                const score = count / habit.goal;
                if (score < worstScore) {
                    worstScore = score;
                    worstHabit = habit.name;
                }
            });
            
            document.getElementById('worstHabit').textContent = worstHabit || '-';
            
            // Taxa de conclus√£o geral
            let totalCompleted = 0;
            let totalPossible = 0;
            
            habits.forEach(habit => {
                const count = habit.counts[currentWeekKey] || 0;
                totalCompleted += Math.min(count, habit.goal);
                totalPossible += habit.goal;
            });
            
            const completionRate = totalPossible > 0 ? Math.round((totalCompleted / totalPossible) * 100) : 0;
            document.getElementById('completionRate').textContent = `${completionRate}%`;
            
            // Progresso para pr√≥ximo n√≠vel
            const globalScore = parseInt(document.getElementById('globalScore').textContent);
            const level = getLevel(globalScore);
            const nextLevel = level.level < LEVELS.length ? LEVELS[level.level].minScore : 100;
            const progress = Math.min(100, Math.round((globalScore - LEVELS[level.level-1].minScore) / (nextLevel - LEVELS[level.level-1].minScore) * 100));
            document.getElementById('nextLevel').textContent = `${progress}%`;
            
            // Atualizar badges de compara√ß√£o para h√°bitos
            updateHabitComparisonBadges(bestHabit, worstHabit, completionRate, level);
        }

        // Atualizar badges de compara√ß√£o para h√°bitos
        function updateHabitComparisonBadges(bestHabit, worstHabit, completionRate, level) {
            // Compara√ß√£o do melhor h√°bito
            document.getElementById('bestHabitComparison').textContent = "+15% vs m√©dia";
            document.getElementById('bestHabitComparison').className = "comparison-badge positive-badge";
            
            // Compara√ß√£o do pior h√°bito
            document.getElementById('worstHabitComparison').textContent = "-10% vs m√©dia";
            document.getElementById('worstHabitComparison').className = "comparison-badge negative-badge";
            
            // Compara√ß√£o da taxa de conclus√£o
            const brazilCompletion = 62; // M√©dia fict√≠cia brasileira
            const completionDiff = completionRate - brazilCompletion;
            document.getElementById('completionComparison').textContent = `${completionDiff > 0 ? '+' : ''}${completionDiff}% vs m√©dia BR`;
            document.getElementById('completionComparison').className = `comparison-badge ${completionDiff > 0 ? 'positive-badge' : completionDiff < 0 ? 'negative-badge' : 'positive-badge'}`;
            
            // Compara√ß√£o de n√≠vel
            document.getElementById('levelComparison').textContent = `Acima de ${level.usersAbove} dos usu√°rios`;
            document.getElementById('levelComparison').className = "comparison-badge positive-badge";
        }

        // Atualizar insights cient√≠ficos
        function updateScienceInsights() {
            const globalScore = parseInt(document.getElementById('globalScore').textContent);
            
            // Dias para formar h√°bito (baseado na consist√™ncia)
            const consistencyScore = calculateConsistencyScore();
            let daysToFormHabit = REFERENCE_DATA.scienceData.daysToFormHabit;
            
            if (consistencyScore > 80) {
                daysToFormHabit = Math.round(daysToFormHabit * 0.7); // 30% mais r√°pido
            } else if (consistencyScore > 60) {
                daysToFormHabit = Math.round(daysToFormHabit * 0.85); // 15% mais r√°pido
            }
            
            document.getElementById('neuroplasticity').textContent = daysToFormHabit;
            
            // Probabilidade de sucesso
            let successProbability = 50; // Base
            
            if (globalScore >= 95) successProbability = 92;
            else if (globalScore >= 90) successProbability = 85;
            else if (globalScore >= 80) successProbability = 65;
            else if (globalScore >= 70) successProbability = 45;
            
            document.getElementById('successProbability').textContent = `${successProbability}%`;
            
            // Previs√£o de meta
            const goalForecast = calculateGoalForecast();
            document.getElementById('goalForecast').textContent = goalForecast;
            
            // Ritmo atual
            const currentPace = calculateCurrentPace();
            document.getElementById('currentPace').textContent = currentPace;
        }

        // Calcular previs√£o de meta
        function calculateGoalForecast() {
            const globalScore = parseInt(document.getElementById('globalScore').textContent);
            
            if (globalScore >= 90) return "Meta em 2 semanas";
            if (globalScore >= 80) return "Meta em 1 m√™s";
            if (globalScore >= 60) return "Meta em 2 meses";
            if (globalScore >= 40) return "Meta em 3 meses";
            return "Meta em 4+ meses";
        }

        // Calcular ritmo atual
        function calculateCurrentPace() {
            const weekScore = parseInt(document.getElementById('weekScore').textContent);
            
            if (weekScore >= 90) return "Acelerado";
            if (weekScore >= 70) return "Bom ritmo";
            if (weekScore >= 50) return "Ritmo moderado";
            if (weekScore >= 30) return "Ritmo lento";
            return "Precisa acelerar";
        }

        // Renderizar gr√°ficos
        function renderCharts() {
            renderHabitsChart();
            renderPerformanceChart('week');
            renderComparisonChart();
            renderScienceChart();
            renderForecastChart();
            renderWeekdayChart();
            renderWeekdayChartManual();
        }

        // Gr√°fico de h√°bitos
        function renderHabitsChart() {
            const ctx = document.getElementById('habitsChart').getContext('2d');
            
            if (habitsChart) {
                habitsChart.destroy();
            }
            
            const habitNames = habits.map(h => h.name);
            const habitProgress = habits.map(h => {
                const count = h.counts[currentWeekKey] || 0;
                return Math.min(100, (count / h.goal) * 100);
            });
            const habitColors = habits.map(h => h.color);
            
            // M√©dias de refer√™ncia (simuladas)
            const referenceAverages = habits.map(h => {
                if (h.name.includes("Treino")) return 56;
                if (h.name.includes("Ingl√™s")) return 64;
                if (h.name.includes("Leitura")) return 50;
                if (h.name.includes("Devocional")) return 26;
                return 50;
            });
            
            habitsChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: habitNames,
                    datasets: [
                        {
                            label: 'Seu Progresso (%)',
                            data: habitProgress,
                            backgroundColor: habitColors,
                            borderColor: habitColors.map(c => c.replace('0.8', '1')),
                            borderWidth: 2,
                            borderRadius: 5
                        },
                        {
                            label: 'M√©dia de Refer√™ncia',
                            data: referenceAverages,
                            backgroundColor: 'rgba(148, 163, 184, 0.3)',
                            borderColor: 'rgba(148, 163, 184, 0.8)',
                            borderWidth: 1,
                            borderRadius: 5,
                            borderDash: [5, 5]
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#94a3b8'
                            },
                            title: {
                                display: true,
                                text: 'Progresso (%)',
                                color: '#94a3b8'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#94a3b8'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                color: '#94a3b8',
                                padding: 20
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const habit = habits[context.dataIndex];
                                    const count = habit.counts[currentWeekKey] || 0;
                                    if (context.datasetIndex === 0) {
                                        return `${habit.name}: ${count}/${habit.goal} (${context.raw}%)`;
                                    } else {
                                        return `M√©dia de refer√™ncia: ${context.raw}%`;
                                    }
                                }
                            }
                        }
                    }
                }
            });
        }

        // Gr√°fico de desempenho
        function renderPerformanceChart(type) {
            const ctx = document.getElementById('performanceChart').getContext('2d');
            
            if (performanceChart) {
                performanceChart.destroy();
            }
            
            let labels = [];
            let data = [];
            let referenceData = [];
            
            if (type === 'week') {
                // √öltimas 8 semanas
                for (let i = 7; i >= 0; i--) {
                    const week = currentWeek - i;
                    const weekKey = `${currentYear}-W${week}`;
                    
                    let weekScore = 0;
                    let totalPossible = 0;
                    
                    habits.forEach(habit => {
                        const count = habit.counts[weekKey] || 0;
                        weekScore += Math.min(1, count / habit.goal);
                        totalPossible += 1;
                    });
                    
                    labels.push(`Sem ${week}`);
                    data.push(totalPossible > 0 ? Math.round((weekScore / totalPossible) * 100) : 0);
                    referenceData.push(REFERENCE_DATA.globalTrends.weeklyCompletion); // M√©dia global
                }
            } else if (type === 'month') {
                // √öltimos 6 meses
                for (let i = 5; i >= 0; i--) {
                    const month = currentMonth - i;
                    let year = currentYear;
                    let monthIdx = month;
                    
                    if (month < 0) {
                        monthIdx = 12 + month;
                        year--;
                    }
                    
                    const monthKey = `${year}-${monthIdx}`;
                    
                    let monthScore = 0;
                    let monthTotalPossible = 0;
                    
                    habits.forEach(habit => {
                        let monthCount = 0;
                        let monthGoal = 0;
                        
                        Object.keys(habit.counts).forEach(weekKey => {
                            if (weekKey.startsWith(monthKey)) {
                                monthCount += habit.counts[weekKey];
                                monthGoal += habit.goal;
                            }
                        });
                        
                        monthScore += Math.min(1, monthCount / (monthGoal || 1));
                        monthTotalPossible += 1;
                    });
                    
                    const monthNames = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];
                    labels.push(`${monthNames[monthIdx]}/${year.toString().slice(2)}`);
                    data.push(monthTotalPossible > 0 ? Math.round((monthScore / monthTotalPossible) * 100) : 0);
                    referenceData.push(REFERENCE_DATA.globalTrends.monthlyConsistency);
                }
            } else {
                // √öltimos 12 meses
                for (let i = 11; i >= 0; i--) {
                    const month = currentMonth - i;
                    let year = currentYear;
                    let monthIdx = month;
                    
                    if (month < 0) {
                        monthIdx = 12 + month;
                        year--;
                    }
                    
                    const monthKey = `${year}-${monthIdx}`;
                    
                    let monthScore = 0;
                    let monthTotalPossible = 0;
                    
                    habits.forEach(habit => {
                        let monthCount = 0;
                        let monthGoal = 0;
                        
                        Object.keys(habit.counts).forEach(weekKey => {
                            if (weekKey.startsWith(monthKey)) {
                                monthCount += habit.counts[weekKey];
                                monthGoal += habit.goal;
                            }
                        });
                        
                        monthScore += Math.min(1, monthCount / (monthGoal || 1));
                        monthTotalPossible += 1;
                    });
                    
                    const monthNames = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];
                    labels.push(`${monthNames[monthIdx]}/${year.toString().slice(2)}`);
                    data.push(monthTotalPossible > 0 ? Math.round((monthScore / monthTotalPossible) * 100) : 0);
                    referenceData.push(REFERENCE_DATA.globalTrends.monthlyConsistency);
                }
            }
            
            performanceChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Seu Desempenho',
                            data: data,
                            borderColor: '#6366f1',
                            backgroundColor: 'rgba(99, 102, 241, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.3,
                            pointBackgroundColor: '#6366f1',
                            pointRadius: 5,
                            pointHoverRadius: 8
                        },
                        {
                            label: 'M√©dia Global',
                            data: referenceData,
                            borderColor: 'rgba(148, 163, 184, 0.8)',
                            backgroundColor: 'rgba(148, 163, 184, 0.1)',
                            borderWidth: 2,
                            borderDash: [5, 5],
                            fill: false,
                            tension: 0.3,
                            pointBackgroundColor: 'rgba(148, 163, 184, 0.8)',
                            pointRadius: 4,
                            pointHoverRadius: 6
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#94a3b8'
                            },
                            title: {
                                display: true,
                                text: 'Pontua√ß√£o (%)',
                                color: '#94a3b8'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#94a3b8'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                color: '#94a3b8',
                                padding: 20
                            }
                        }
                    }
                }
            });
        }

        // Gr√°fico de compara√ß√£o
        function renderComparisonChart() {
            const ctx = document.getElementById('comparisonChart').getContext('2d');
            
            if (comparisonChart) {
                comparisonChart.destroy();
            }
            
            // Dados do usu√°rio
            const userData = habits.map(habit => {
                const count = habit.counts[currentWeekKey] || 0;
                return Math.min(100, (count / habit.goal) * 100);
            });
            
            // Dados de refer√™ncia (m√©dias brasileiras simuladas)
            const referenceData = habits.map(habit => {
                if (habit.name.includes("Treino")) return 56;
                if (habit.name.includes("Ingl√™s")) return 64;
                if (habit.name.includes("Leitura")) return 50;
                if (habit.name.includes("Devocional")) return 26;
                return 50;
            });
            
            // Dados ideais (baseados em estudos)
            const idealData = habits.map(habit => {
                if (habit.name.includes("Treino")) return 80;
                if (habit.name.includes("Ingl√™s")) return 85;
                if (habit.name.includes("Leitura")) return 75;
                if (habit.name.includes("Devocional")) return 95;
                return 80;
            });
            
            comparisonChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: habits.map(h => h.name),
                    datasets: [
                        {
                            label: 'Seu Desempenho',
                            data: userData,
                            backgroundColor: 'rgba(99, 102, 241, 0.2)',
                            borderColor: '#6366f1',
                            borderWidth: 2,
                            pointBackgroundColor: '#6366f1',
                            pointRadius: 4
                        },
                        {
                            label: 'M√©dia Brasileira',
                            data: referenceData,
                            backgroundColor: 'rgba(148, 163, 184, 0.2)',
                            borderColor: 'rgba(148, 163, 184, 0.8)',
                            borderWidth: 2,
                            borderDash: [5, 5],
                            pointBackgroundColor: 'rgba(148, 163, 184, 0.8)',
                            pointRadius: 3
                        },
                        {
                            label: 'Meta Ideal',
                            data: idealData,
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            borderColor: '#10b981',
                            borderWidth: 1,
                            borderDash: [2, 2],
                            pointBackgroundColor: '#10b981',
                            pointRadius: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            angleLines: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            pointLabels: {
                                color: '#94a3b8'
                            },
                            ticks: {
                                color: '#94a3b8',
                                backdropColor: 'transparent'
                            },
                            min: 0,
                            max: 100
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                color: '#94a3b8',
                                padding: 20
                            }
                        }
                    }
                }
            });
        }

        // Gr√°fico cient√≠fico
        function renderScienceChart() {
            const ctx = document.getElementById('scienceChart').getContext('2d');
            
            if (scienceChart) {
                scienceChart.destroy();
            }
            
            // Dados baseados em estudos cient√≠ficos
            const consistencyLevels = ["50%", "60%", "70%", "80%", "90%", "95%"];
            const successRates = [25, 35, 45, 65, 85, 92]; // Probabilidade de sucesso
            const habitFormationDays = [120, 100, 80, 66, 55, 50]; // Dias para formar h√°bito
            
            // Consist√™ncia do usu√°rio
            const userConsistency = calculateConsistencyScore();
            const userConsistencyLevel = Math.min(95, Math.round(userConsistency / 5) * 5);
            
            scienceChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: consistencyLevels,
                    datasets: [
                        {
                            label: 'Probabilidade de Sucesso (%)',
                            data: successRates,
                            backgroundColor: 'rgba(16, 185, 129, 0.5)',
                            borderColor: '#10b981',
                            borderWidth: 1,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Dias para Formar H√°bito',
                            data: habitFormationDays,
                            backgroundColor: 'rgba(99, 102, 241, 0.5)',
                            borderColor: '#6366f1',
                            borderWidth: 1,
                            yAxisID: 'y1'
                        },
                        {
                            label: 'Sua Consist√™ncia',
                            data: consistencyLevels.map((level, i) => {
                                const levelValue = parseInt(level);
                                return levelValue === userConsistencyLevel ? [successRates[i], habitFormationDays[i]] : null;
                            }),
                            type: 'scatter',
                            backgroundColor: '#f59e0b',
                            borderColor: '#f59e0b',
                            pointRadius: 8,
                            pointHoverRadius: 10,
                            yAxisID: 'y'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'N√≠vel de Consist√™ncia',
                                color: '#94a3b8'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#94a3b8'
                            }
                        },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'Probabilidade de Sucesso (%)',
                                color: '#94a3b8'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#94a3b8'
                            },
                            min: 0,
                            max: 100
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'Dias para Formar H√°bito',
                                color: '#94a3b8'
                            },
                            grid: {
                                drawOnChartArea: false
                            },
                            ticks: {
                                color: '#94a3b8'
                            },
                            min: 0,
                            max: 130
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                color: '#94a3b8',
                                padding: 20
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    if (context.datasetIndex === 0) {
                                        return `Probabilidade de sucesso: ${context.raw}%`;
                                    } else if (context.datasetIndex === 1) {
                                        return `Dias para formar h√°bito: ${context.raw}`;
                                    } else {
                                        return `Sua consist√™ncia: ${userConsistencyLevel}%`;
                                    }
                                }
                            }
                        }
                    }
                }
            });
        }

        // Gr√°fico de previs√£o
        function renderForecastChart() {
            const ctx = document.getElementById('forecastChart').getContext('2d');
            
            if (forecastChart) {
                forecastChart.destroy();
            }
            
            // Dados hist√≥ricos (√∫ltimas 4 semanas)
            const historicalData = [];
            const historicalLabels = [];
            
            for (let i = 3; i >= 0; i--) {
                const week = currentWeek - i;
                const weekKey = `${currentYear}-W${week}`;
                
                let weekScore = 0;
                let totalPossible = 0;
                
                habits.forEach(habit => {
                    const count = habit.counts[weekKey] || 0;
                    weekScore += Math.min(1, count / habit.goal);
                    totalPossible += 1;
                });
                
                historicalLabels.push(`Sem ${week}`);
                historicalData.push(totalPossible > 0 ? Math.round((weekScore / totalPossible) * 100) : 0);
            }
            
            // Previs√£o para as pr√≥ximas 4 semanas (baseada na tend√™ncia)
            const forecastData = [];
            const forecastLabels = [];
            
            // Calcular tend√™ncia
            let trend = 0;
            if (historicalData.length >= 2) {
                trend = historicalData[historicalData.length - 1] - historicalData[0];
                trend = trend / (historicalData.length - 1);
            }
            
            // Gerar previs√£o
            let lastValue = historicalData[historicalData.length - 1] || 50;
            for (let i = 1; i <= 4; i++) {
                forecastLabels.push(`Sem ${currentWeek + i}`);
                let forecastValue = lastValue + (trend * i);
                // Limitar entre 0 e 100
                forecastValue = Math.max(0, Math.min(100, forecastValue));
                forecastData.push(Math.round(forecastValue));
            }
            
            forecastChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [...historicalLabels, ...forecastLabels],
                    datasets: [
                        {
                            label: 'Hist√≥rico',
                            data: [...historicalData, ...Array(4).fill(null)],
                            borderColor: '#6366f1',
                            backgroundColor: 'rgba(99, 102, 241, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.3,
                            pointBackgroundColor: '#6366f1',
                            pointRadius: 5,
                            pointHoverRadius: 8
                        },
                        {
                            label: 'Previs√£o',
                            data: [...Array(historicalData.length).fill(null), ...forecastData],
                            borderColor: '#f59e0b',
                            backgroundColor: 'rgba(245, 158, 11, 0.1)',
                            borderWidth: 3,
                            borderDash: [5, 5],
                            fill: true,
                            tension: 0.3,
                            pointBackgroundColor: '#f59e0b',
                            pointRadius: 5,
                            pointHoverRadius: 8
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#94a3b8'
                            },
                            title: {
                                display: true,
                                text: 'Pontua√ß√£o Prevista (%)',
                                color: '#94a3b8'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#94a3b8'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                color: '#94a3b8',
                                padding: 20
                            }
                        }
                    }
                }
            });
        }

        // Gr√°fico de dias da semana (Chart.js)
        function renderWeekdayChart() {
            const ctx = document.getElementById('weekdayChart').getContext('2d');
            
            if (weekdayChart) {
                weekdayChart.destroy();
            }
            
            // Calcular h√°bitos por dia da semana (esta semana)
            const weekdayCounts = [0, 0, 0, 0, 0, 0, 0];
            const today = new Date();
            
            habits.forEach(habit => {
                Object.keys(habit.dailyHistory || {}).forEach(dateStr => {
                    const date = new Date(dateStr);
                    const daysDiff = Math.floor((today - date) / (1000 * 60 * 60 * 24));
                    
                    // S√≥ considerar √∫ltimos 7 dias
                    if (daysDiff >= 0 && daysDiff < 7) {
                        const dayOfWeek = date.getDay();
                        weekdayCounts[dayOfWeek] += habit.dailyHistory[dateStr] || 0;
                    }
                });
            });
            
            // M√©dia ideal (baseada em 3 h√°bitos por dia)
            const idealData = weekdayCounts.map(() => habits.length * 0.7); // 70% dos h√°bitos por dia
            
            weekdayChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: WEEKDAYS,
                    datasets: [
                        {
                            label: 'Seus H√°bitos',
                            data: weekdayCounts,
                            backgroundColor: 'rgba(99, 102, 241, 0.7)',
                            borderColor: '#6366f1',
                            borderWidth: 1
                        },
                        {
                            label: 'Meta Ideal',
                            data: idealData,
                            backgroundColor: 'rgba(16, 185, 129, 0.3)',
                            borderColor: '#10b981',
                            borderWidth: 1,
                            borderDash: [5, 5]
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#94a3b8'
                            },
                            title: {
                                display: true,
                                text: 'H√°bitos Conclu√≠dos',
                                color: '#94a3b8'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#94a3b8'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                color: '#94a3b8',
                                padding: 10
                            }
                        }
                    }
                }
            });
        }

        // Gr√°fico manual de dias da semana
        function renderWeekdayChartManual() {
            const container = document.getElementById('weekdayChartManual');
            container.innerHTML = '';
            
            // Calcular h√°bitos por dia da semana (esta semana)
            const weekdayCounts = [0, 0, 0, 0, 0, 0, 0];
            const today = new Date();
            
            habits.forEach(habit => {
                Object.keys(habit.dailyHistory || {}).forEach(dateStr => {
                    const date = new Date(dateStr);
                    const daysDiff = Math.floor((today - date) / (1000 * 60 * 60 * 24));
                    
                    // S√≥ considerar √∫ltimos 7 dias
                    if (daysDiff >= 0 && daysDiff < 7) {
                        const dayOfWeek = date.getDay();
                        weekdayCounts[dayOfWeek] += habit.dailyHistory[dateStr] || 0;
                    }
                });
            });
            
            // Encontrar valor m√°ximo para normaliza√ß√£o
            const maxValue = Math.max(...weekdayCounts, 1);
            
            // Criar barras para cada dia
            WEEKDAYS.forEach((day, index) => {
                const value = weekdayCounts[index];
                const percentage = (value / maxValue) * 100;
                
                const bar = document.createElement('div');
                bar.className = 'weekday-bar';
                bar.style.height = `${percentage}%`;
                bar.style.background = `linear-gradient(0deg, var(--primary), ${index === currentDay ? '#8b5cf6' : '#6366f1'})`;
                
                const label = document.createElement('div');
                label.className = 'weekday-label';
                label.textContent = day;
                
                const valueEl = document.createElement('div');
                valueEl.className = 'weekday-value';
                valueEl.textContent = value;
                valueEl.style.color = index === currentDay ? '#f59e0b' : 'var(--light)';
                
                bar.appendChild(valueEl);
                bar.appendChild(label);
                container.appendChild(bar);
            });
        }

        // Renderizar conquistas
        function renderAchievements() {
            achievementsContainer.innerHTML = '';
            
            if (!appData.achievements || appData.achievements.length === 0) {
                achievementsContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-trophy"></i>
                        <h3>Nenhuma conquista ainda</h3>
                        <p>Complete h√°bitos para desbloquear conquistas!</p>
                    </div>
                `;
                return;
            }
            
            const unlockedCount = appData.achievements.filter(a => a.unlocked).length;
            const totalCount = appData.achievements.length;
            
            achievementsContainer.innerHTML = `
                <div style="text-align: center; margin-bottom: 20px;">
                    <h3 style="margin-bottom: 10px;">Conquistas</h3>
                    <div style="font-size: 1.2rem; font-weight: 600;">
                        ${unlockedCount} de ${totalCount} desbloqueadas
                    </div>
                    <div class="goal-progress" style="margin-top: 10px;">
                        <div class="progress-fill" style="width: ${(unlockedCount / totalCount) * 100}%; background: var(--accent);"></div>
                    </div>
                </div>
            `;
            
            appData.achievements.forEach(achievement => {
                const achievementEl = document.createElement('div');
                achievementEl.className = 'habit-item';
                achievementEl.style.opacity = achievement.unlocked ? '1' : '0.5';
                
                achievementEl.innerHTML = `
                    <div style="display: flex; align-items: center;">
                        <div class="achievement-badge">
                            <i class="${achievement.icon}"></i>
                        </div>
                        <div>
                            <div style="font-weight: 600; font-size: 1.1rem;">${achievement.name}</div>
                            <div style="color: var(--gray); font-size: 0.9rem;">${achievement.description}</div>
                        </div>
                    </div>
                    <div>
                        ${achievement.unlocked ? 
                            '<span class="badge success-badge" style="background: var(--secondary); color: white; padding: 5px 10px; border-radius: 12px;"><i class="fas fa-check"></i> Conquistada</span>' : 
                            '<span class="badge outline-badge" style="border: 1px solid var(--gray); color: var(--gray); padding: 5px 10px; border-radius: 12px;"><i class="fas fa-lock"></i> Bloqueada</span>'}
                    </div>
                `;
                
                achievementsContainer.appendChild(achievementEl);
            });
        }

        // Verificar conquistas
        function checkAchievements() {
            let updated = false;
            
            // Conquista 1: Primeiros Passos
            if (!appData.achievements[0].unlocked && appData.allTimeStats.totalCompletions > 0) {
                appData.achievements[0].unlocked = true;
                updated = true;
            }
            
            // Conquista 2: Sequ√™ncia de Ouro
            if (!appData.achievements[1].unlocked && appData.streak >= 7) {
                appData.achievements[1].unlocked = true;
                updated = true;
            }
            
            // Conquista 3: Meta Semanal
            const weekScore = parseInt(document.getElementById('weekScore').textContent);
            if (!appData.achievements[2].unlocked && weekScore >= 100) {
                appData.achievements[2].unlocked = true;
                updated = true;
            }
            
            // Conquista 4: Consist√™ncia Bronze
            const consistencyScore = calculateConsistencyScore();
            if (!appData.achievements[3].unlocked && consistencyScore >= 70) {
                appData.achievements[3].unlocked = true;
                updated = true;
            }
            
            // Conquista 5: Mestre dos H√°bitos
            const globalScore = parseInt(document.getElementById('globalScore').textContent);
            if (!appData.achievements[4].unlocked && globalScore >= 90) {
                appData.achievements[4].unlocked = true;
                updated = true;
            }
            
            // Conquista 6: Supera√ß√£o
            const lastWeekScore = getLastWeekScore();
            const currentWeekScore = parseInt(document.getElementById('weekScore').textContent);
            if (!appData.achievements[5].unlocked && (currentWeekScore - lastWeekScore) >= 20) {
                appData.achievements[5].unlocked = true;
                updated = true;
            }
            
            // Conquista 7: Vers√°til
            const activeHabits = habits.filter(h => {
                const count = h.counts[currentWeekKey] || 0;
                return count > 0;
            }).length;
            
            if (!appData.achievements[6].unlocked && activeHabits >= 3) {
                appData.achievements[6].unlocked = true;
                updated = true;
            }
            
            if (updated) {
                saveData();
                renderAchievements();
            }
        }

        // Salvar dados no localStorage
        function saveData() {
            localStorage.setItem("habitGameProPlus", JSON.stringify(habits));
            localStorage.setItem("habitGameProPlusData", JSON.stringify(appData));
        }

        // Inicializar aplica√ß√£o quando a p√°gina carregar
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>