<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Habit Game Pro</title>

<style>
body {
  font-family:-apple-system,BlinkMacSystemFont,"SF Pro",sans-serif;
  background:#0e0e11;
  color:#fff;
  padding:20px;
}

h1 { text-align:center; margin-bottom:4px; }
.sub { text-align:center; color:#9ca3af; font-size:13px; margin-bottom:20px; }

.card {
  background:#1c1c22;
  border-radius:16px;
  padding:16px;
  margin-bottom:14px;
}

.center { text-align:center; }

button {
  background:#22c55e;
  color:#0e0e11;
  border:none;
  border-radius:10px;
  padding:6px 12px;
  font-weight:bold;
  cursor:pointer;
}

.bar { background:#2a2a32; height:8px; border-radius:8px; overflow:hidden; margin-top:8px; }
.fill { height:100%; }

.badge {
  display:inline-block;
  padding:6px 12px;
  border-radius:999px;
  font-weight:600;
  margin-top:8px;
}

canvas { width:100%; height:160px; margin-top:12px; }

.habit-header {
  display:flex;
  justify-content:space-between;
  align-items:center;
}
</style>
</head>

<body>

<h1>ğŸ® Habit Game Pro</h1>
<div class="sub">ConsistÃªncia vence intensidade</div>

<div class="card center">
  <div id="globalScore" style="font-size:26px;font-weight:700">0%</div>
  <div id="badge"></div>
  <div id="compare" style="margin-top:6px;font-size:13px;color:#9ca3af"></div>
</div>

<div id="habits"></div>

<div class="card">
  <strong>ğŸ“Š HistÃ³rico Semanal (8 semanas)</strong>
  <canvas id="historyChart"></canvas>
</div>

<script>
const habits = [
  { name:"Treino", goal:5 },
  { name:"InglÃªs", goal:5 },
  { name:"Leitura", goal:5 },
  { name:"Devocional", goal:7 }
];

Date.prototype.getWeek = function(){
  const d=new Date(Date.UTC(this.getFullYear(),this.getMonth(),this.getDate()));
  const day=d.getUTCDay()||7;
  d.setUTCDate(d.getUTCDate()+4-day);
  const yearStart=new Date(Date.UTC(d.getUTCFullYear(),0,1));
  return Math.ceil((((d-yearStart)/86400000)+1)/7);
};

const now=new Date();
const currentWeek=now.getWeek();

const data = JSON.parse(localStorage.getItem("habitPro")) || {
  week:currentWeek,
  counts:{},
  history:[]
};

if(data.week !== currentWeek){
  const score = calcScore();
  data.history.unshift(score);
  data.history = data.history.slice(0,8);
  data.counts = {};
  data.week = currentWeek;
}

habits.forEach((h,i)=> data.counts[i] ||= 0);

function save(){
  localStorage.setItem("habitPro", JSON.stringify(data));
}

const container=document.getElementById("habits");

habits.forEach((h,i)=>{
  const div=document.createElement("div");
  div.className="card";
  div.innerHTML=`
    <div class="habit-header">
      <strong>${h.name}</strong>
      <button onclick="add(${i})">+1</button>
    </div>
    <div class="bar"><div class="fill" id="bar-${i}"></div></div>
    <div style="font-size:12px;color:#9ca3af;margin-top:6px" id="info-${i}"></div>
  `;
  container.appendChild(div);
  updateHabit(i);
});

function add(i){
  if(data.counts[i] < habits[i].goal){
    data.counts[i]++;
    save();
    updateHabit(i);
  }
}

function updateHabit(i){
  const h=habits[i];
  const p=(data.counts[i]/h.goal)*100;
  const bar=document.getElementById(`bar-${i}`);
  bar.style.width=Math.min(100,p)+"%";
  bar.style.background=p>=80?"#22c55e":p>=60?"#eab308":"#ef4444";
  document.getElementById(`info-${i}`).innerText=`${data.counts[i]}/${h.goal}`;
  updateGlobal();
}

function calcScore(){
  let total=0;
  habits.forEach((h,i)=> total+=Math.min(1,data.counts[i]/h.goal));
  return Math.round((total/habits.length)*100);
}

function updateGlobal(){
  const score=calcScore();
  document.getElementById("globalScore").innerText=score+"%";

  let badgeText="", color="";
  if(score>=90){ badgeText="ğŸ¥‡ Elite"; color="#22c55e"; }
  else if(score>=80){ badgeText="ğŸŸ¢ Consistente"; color="#16a34a"; }
  else if(score>=60){ badgeText="ğŸŸ¡ Em progresso"; color="#eab308"; }
  else { badgeText="ğŸ”´ Em risco"; color="#ef4444"; }

  document.getElementById("badge").innerHTML =
    `<span class="badge" style="background:${color}">${badgeText}</span>`;

  const best=Math.max(...data.history, score);
  const last=data.history[0] || score;

  let msg="Primeira semana registrada";
  if(score > last) msg=`â¬†ï¸ VocÃª melhorou +${score-last}%`;
  else if(score < last) msg=`â¬‡ï¸ Caiu ${last-score}%`;
  if(score >= best) msg+=" â€¢ Novo recorde pessoal ğŸ†";

  document.getElementById("compare").innerText=msg;

  drawHistory();
}

function drawHistory(){
  const c=document.getElementById("historyChart");
  const ctx=c.getContext("2d");
  ctx.clearRect(0,0,c.width,c.height);

  const values=[calcScore(),...data.history].slice(0,8);
  const step=c.width/(values.length-1||1);

  ctx.strokeStyle="#22c55e";
  ctx.lineWidth=3;
  ctx.beginPath();
  values.forEach((v,i)=>{
    const x=i*step;
    const y=c.height-(v/100*c.height);
    i?ctx.lineTo(x,y):ctx.moveTo(x,y);
  });
  ctx.stroke();
}

updateGlobal();
</script>

</body>
</html>
