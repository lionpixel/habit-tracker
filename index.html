<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Habit Science Pro 2026 - An√°lise Cient√≠fica Baseada em Dados Reais</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #10b981;
            --secondary-dark: #059669;
            --accent: #8b5cf6;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #0ea5e9;
            --dark: #0f172a;
            --darker: #020617;
            --card-bg: #1e293b;
            --light: #f8fafc;
            --gray: #94a3b8;
            --border-radius: 16px;
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }

        body {
            background: linear-gradient(135deg, var(--darker), #1e1b4b);
            color: var(--light);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 25px;
            background: rgba(30, 41, 59, 0.7);
            border-radius: var(--border-radius);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(99, 102, 241, 0.1), transparent);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        h1 {
            font-size: 2.8rem;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            position: relative;
            z-index: 1;
        }

        .subtitle {
            color: var(--gray);
            font-size: 1.05rem;
            max-width: 700px;
            margin: 0 auto 10px;
            position: relative;
            z-index: 1;
        }

        .date-display {
            font-size: 0.9rem;
            color: var(--info);
            margin-top: 10px;
            font-weight: 600;
        }

        .stats-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.9), rgba(30, 41, 59, 0.7));
            border-radius: var(--border-radius);
            padding: 25px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            transition: var(--transition);
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
        }

        .stat-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--accent));
        }

        .stat-card i {
            font-size: 2.2rem;
            margin-bottom: 15px;
            color: var(--primary);
            background: rgba(99, 102, 241, 0.1);
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            margin: 0 auto 15px;
        }

        .stat-value {
            font-size: 2.4rem;
            font-weight: 800;
            margin: 10px 0;
            background: linear-gradient(90deg, var(--light), #cbd5e1);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .stat-label {
            color: var(--gray);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
        }

        .comparison-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-top: 8px;
        }

        .positive-badge {
            background: linear-gradient(90deg, rgba(16, 185, 129, 0.2), rgba(16, 185, 129, 0.1));
            color: var(--secondary);
            border: 1px solid var(--secondary);
        }

        .negative-badge {
            background: linear-gradient(90deg, rgba(239, 68, 68, 0.2), rgba(239, 68, 68, 0.1));
            color: var(--danger);
            border: 1px solid var(--danger);
        }

        .neutral-badge {
            background: linear-gradient(90deg, rgba(148, 163, 184, 0.2), rgba(148, 163, 184, 0.1));
            color: var(--gray);
            border: 1px solid var(--gray);
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        @media (max-width: 1100px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.9), rgba(30, 41, 59, 0.7));
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
            transition: var(--transition);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .card-title {
            font-size: 1.4rem;
            color: var(--light);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-title i {
            color: var(--primary);
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-top: 20px;
        }

        .chart-container.tall {
            height: 400px;
        }

        .habit-form {
            background: rgba(15, 23, 42, 0.5);
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 25px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--gray);
            font-size: 0.9rem;
            font-weight: 600;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            background: rgba(15, 23, 42, 0.8);
            color: var(--light);
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(99, 102, 241, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--secondary), var(--secondary-dark));
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(16, 185, 129, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #dc2626);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(239, 68, 68, 0.4);
        }

        .habits-list {
            display: grid;
            gap: 15px;
        }

        .habit-item {
            background: rgba(15, 23, 42, 0.5);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: var(--transition);
        }

        .habit-item:hover {
            background: rgba(15, 23, 42, 0.7);
            border-color: rgba(255, 255, 255, 0.1);
        }

        .habit-info {
            flex: 1;
        }

        .habit-name {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--light);
            margin-bottom: 5px;
        }

        .habit-details {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .habit-progress {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 10px;
        }

        .progress-bar-container {
            flex: 1;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .progress-text {
            font-size: 0.9rem;
            color: var(--gray);
            min-width: 60px;
            text-align: right;
        }

        .habit-actions {
            display: flex;
            gap: 10px;
        }

        .btn-icon {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .btn-icon:hover {
            transform: scale(1.1);
        }

        .insights-grid {
            display: grid;
            gap: 15px;
        }

        .insight-item {
            background: rgba(15, 23, 42, 0.5);
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid;
            display: flex;
            align-items: start;
            gap: 15px;
        }

        .insight-item.success {
            border-color: var(--secondary);
        }

        .insight-item.warning {
            border-color: var(--warning);
        }

        .insight-item.info {
            border-color: var(--info);
        }

        .insight-item.danger {
            border-color: var(--danger);
        }

        .insight-icon {
            font-size: 1.5rem;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .insight-item.success .insight-icon {
            color: var(--secondary);
            background: rgba(16, 185, 129, 0.1);
        }

        .insight-item.warning .insight-icon {
            color: var(--warning);
            background: rgba(245, 158, 11, 0.1);
        }

        .insight-item.info .insight-icon {
            color: var(--info);
            background: rgba(14, 165, 233, 0.1);
        }

        .insight-item.danger .insight-icon {
            color: var(--danger);
            background: rgba(239, 68, 68, 0.1);
        }

        .insight-content {
            flex: 1;
        }

        .insight-title {
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--light);
        }

        .insight-text {
            color: var(--gray);
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .comparison-legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
            color: var(--gray);
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 4px;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }

            .stats-bar {
                grid-template-columns: 1fr;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .habit-item {
                flex-direction: column;
                align-items: flex-start;
            }

            .habit-actions {
                width: 100%;
                justify-content: flex-end;
                margin-top: 15px;
            }

            /* Responsividade do jejum de a√ß√∫car */
            .card > div[style*="grid-template-columns: 1fr 1fr"] {
                grid-template-columns: 1fr !important;
            }
        }

        .ranking-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: linear-gradient(135deg, var(--warning), #d97706);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
        }

        .scientific-note {
            background: rgba(14, 165, 233, 0.1);
            border-left: 4px solid var(--info);
            padding: 12px 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-size: 0.85rem;
            color: var(--gray);
        }

        .scientific-note strong {
            color: var(--info);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>
                <i class="fas fa-brain"></i>
                Habit Science Pro 2026
            </h1>
            <p class="subtitle">üìä An√°lise cient√≠fica baseada em pesquisas reais - Compare-se com Brasil e Mundo</p>
            <div class="date-display" id="currentDate">
                <i class="fas fa-calendar-alt"></i> Carregando data...
            </div>
        </header>

        <!-- Barra de Estat√≠sticas Melhorada -->
        <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 15px; margin-bottom: 30px;">
            
            <!-- Sequ√™ncia Atual -->
            <div style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.15), rgba(220, 38, 38, 0.1)); padding: 20px; border-radius: 16px; border: 2px solid rgba(239, 68, 68, 0.4); position: relative; overflow: hidden;">
                <div style="position: absolute; top: 10px; right: 10px; font-size: 2.5rem; opacity: 0.1;">üî•</div>
                <div style="position: relative; z-index: 1;">
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                        <i class="fas fa-fire" style="color: var(--danger); font-size: 1.2rem;"></i>
                        <div style="font-size: 0.85rem; color: var(--gray); font-weight: 600;">Sequ√™ncia</div>
                    </div>
                    <div style="font-size: 3rem; font-weight: 900; color: var(--danger); line-height: 1; margin-bottom: 5px;" id="streakValue">0</div>
                    <div style="font-size: 0.75rem; color: var(--light); font-weight: 600; margin-bottom: 8px;">dias seguidos</div>
                    <div style="height: 4px; background: rgba(0,0,0,0.2); border-radius: 10px; overflow: hidden;">
                        <div id="streakProgress" style="height: 100%; background: linear-gradient(90deg, #ef4444, #dc2626); width: 0%; transition: width 0.5s ease;"></div>
                    </div>
                    <div style="font-size: 0.7rem; color: var(--gray); margin-top: 5px;" id="streakBadge">Comece hoje!</div>
                </div>
            </div>

            <!-- Score Semanal -->
            <div style="background: linear-gradient(135deg, rgba(245, 158, 11, 0.15), rgba(217, 119, 6, 0.1)); padding: 20px; border-radius: 16px; border: 2px solid rgba(245, 158, 11, 0.4); position: relative; overflow: hidden;">
                <div style="position: absolute; top: 10px; right: 10px; font-size: 2.5rem; opacity: 0.1;">üèÜ</div>
                <div style="position: relative; z-index: 1;">
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                        <i class="fas fa-trophy" style="color: var(--warning); font-size: 1.2rem;"></i>
                        <div style="font-size: 0.85rem; color: var(--gray); font-weight: 600;">Score Semanal</div>
                    </div>
                    <div style="font-size: 3rem; font-weight: 900; color: var(--warning); line-height: 1; margin-bottom: 5px;" id="weeklyScoreValue">0%</div>
                    <div style="font-size: 0.75rem; color: var(--light); font-weight: 600; margin-bottom: 8px;">desta semana</div>
                    <div style="height: 4px; background: rgba(0,0,0,0.2); border-radius: 10px; overflow: hidden;">
                        <div id="scoreProgress" style="height: 100%; background: linear-gradient(90deg, #f59e0b, #d97706); width: 0%; transition: width 0.5s ease;"></div>
                    </div>
                    <div style="font-size: 0.7rem; color: var(--gray); margin-top: 5px;" id="scoreBadge">vs M√©dia: 0%</div>
                </div>
            </div>

            <!-- Total Horas 2026 -->
            <div style="background: linear-gradient(135deg, rgba(14, 165, 233, 0.15), rgba(6, 182, 212, 0.1)); padding: 20px; border-radius: 16px; border: 2px solid rgba(14, 165, 233, 0.4); position: relative; overflow: hidden;">
                <div style="position: absolute; top: 10px; right: 10px; font-size: 2.5rem; opacity: 0.1;">‚è±Ô∏è</div>
                <div style="position: relative; z-index: 1;">
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                        <i class="fas fa-clock" style="color: var(--info); font-size: 1.2rem;"></i>
                        <div style="font-size: 0.85rem; color: var(--gray); font-weight: 600;">Horas 2026</div>
                    </div>
                    <div style="font-size: 3rem; font-weight: 900; color: var(--info); line-height: 1; margin-bottom: 5px;" id="totalHours2026">0h</div>
                    <div style="font-size: 0.75rem; color: var(--light); font-weight: 600; margin-bottom: 8px;">acumuladas</div>
                    <div style="height: 4px; background: rgba(0,0,0,0.2); border-radius: 10px; overflow: hidden;">
                        <div id="hoursProgress" style="height: 100%; background: linear-gradient(90deg, #0ea5e9, #06b6d4); width: 0%; transition: width 0.5s ease;"></div>
                    </div>
                    <div style="font-size: 0.7rem; color: var(--gray); margin-top: 5px;" id="hoursBadge">Meta ano: 2.080h</div>
                </div>
            </div>

            <!-- Progresso Anual -->
            <div style="background: linear-gradient(135deg, rgba(139, 92, 246, 0.15), rgba(99, 102, 241, 0.1)); padding: 20px; border-radius: 16px; border: 2px solid rgba(139, 92, 246, 0.4); position: relative; overflow: hidden;">
                <div style="position: absolute; top: 10px; right: 10px; font-size: 2.5rem; opacity: 0.1;">üìÖ</div>
                <div style="position: relative; z-index: 1;">
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                        <i class="fas fa-calendar-check" style="color: var(--accent); font-size: 1.2rem;"></i>
                        <div style="font-size: 0.85rem; color: var(--gray); font-weight: 600;">Ano 2026</div>
                    </div>
                    <div style="font-size: 3rem; font-weight: 900; color: var(--accent); line-height: 1; margin-bottom: 5px;" id="weeks2026Value">6</div>
                    <div style="font-size: 0.75rem; color: var(--light); font-weight: 600; margin-bottom: 8px;">semanas completas</div>
                    <div style="height: 4px; background: rgba(0,0,0,0.2); border-radius: 10px; overflow: hidden;">
                        <div id="yearProgress" style="height: 100%; background: linear-gradient(90deg, #8b5cf6, #6366f1); width: 11.5%; transition: width 0.5s ease;"></div>
                    </div>
                    <div style="font-size: 0.7rem; color: var(--gray); margin-top: 5px;" id="weeksBadge">11.5% do ano</div>
                </div>
            </div>

            <!-- Ranking Global -->
            <div style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.15), rgba(5, 150, 105, 0.1)); padding: 20px; border-radius: 16px; border: 2px solid rgba(16, 185, 129, 0.4); position: relative; overflow: hidden;">
                <div style="position: absolute; top: 10px; right: 10px; font-size: 2.5rem; opacity: 0.1;">üåç</div>
                <div style="position: relative; z-index: 1;">
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                        <i class="fas fa-globe-americas" style="color: var(--secondary); font-size: 1.2rem;"></i>
                        <div style="font-size: 0.85rem; color: var(--gray); font-weight: 600;">Ranking</div>
                    </div>
                    <div style="font-size: 2.5rem; font-weight: 900; color: var(--secondary); line-height: 1; margin-bottom: 5px;" id="globalRankValue">Top 75%</div>
                    <div style="font-size: 0.75rem; color: var(--light); font-weight: 600; margin-bottom: 8px;">popula√ß√£o mundial</div>
                    <div style="height: 4px; background: rgba(0,0,0,0.2); border-radius: 10px; overflow: hidden;">
                        <div id="rankProgress" style="height: 100%; background: linear-gradient(90deg, #10b981, #059669); width: 25%; transition: width 0.5s ease;"></div>
                    </div>
                    <div style="font-size: 0.7rem; color: var(--gray); margin-top: 5px;" id="globalRankBadge">Melhor que 25%</div>
                </div>
            </div>
        </div>

        <!-- Mini Gr√°ficos de Vis√£o Geral -->
        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-bottom: 30px;">
            
            <!-- Progresso Semanal Mini -->
            <div style="background: rgba(15, 23, 42, 0.6); padding: 20px; border-radius: 12px; border: 2px solid rgba(99, 102, 241, 0.3);">
                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px;">
                    <div>
                        <div style="font-size: 0.9rem; color: var(--primary); font-weight: 700;">üìä Esta Semana</div>
                        <div style="font-size: 0.75rem; color: var(--gray);">06-12 Fev 2026</div>
                    </div>
                    <div style="font-size: 2rem; font-weight: 900; color: var(--primary);" id="weekCompletionRate">0%</div>
                </div>
                <div style="height: 120px;">
                    <canvas id="miniWeekChart"></canvas>
                </div>
            </div>

            <!-- H√°bitos Cr√≠ticos -->
            <div style="background: rgba(15, 23, 42, 0.6); padding: 20px; border-radius: 12px; border: 2px solid rgba(239, 68, 68, 0.3);">
                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px;">
                    <div>
                        <div style="font-size: 0.9rem; color: var(--danger); font-weight: 700;">‚ö†Ô∏è Aten√ß√£o Hoje</div>
                        <div style="font-size: 0.75rem; color: var(--gray);">H√°bitos pendentes</div>
                    </div>
                    <div style="font-size: 2rem; font-weight: 900; color: var(--danger);" id="pendingToday">0</div>
                </div>
                <div id="criticalHabits" style="display: flex; flex-direction: column; gap: 8px;"></div>
            </div>

            <!-- Evolu√ß√£o Mensal -->
            <div style="background: rgba(15, 23, 42, 0.6); padding: 20px; border-radius: 12px; border: 2px solid rgba(16, 185, 129, 0.3);">
                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px;">
                    <div>
                        <div style="font-size: 0.9rem; color: var(--secondary); font-weight: 700;">üìà Fevereiro</div>
                        <div style="font-size: 0.75rem; color: var(--gray);">vs Janeiro 2026</div>
                    </div>
                    <div style="font-size: 2rem; font-weight: 900; color: var(--secondary);" id="monthGrowth">+0%</div>
                </div>
                <div style="height: 120px;">
                    <canvas id="miniMonthChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Dashboard Grid -->
        <div class="dashboard-grid">
            <!-- Compara√ß√£o Voc√™ vs Brasil vs Mundial -->
            <div class="card full-width">
                <div class="ranking-badge">
                    <i class="fas fa-crown"></i>
                    <span id="yourRanking">Top ?%</span>
                </div>
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-globe"></i>
                        Compara√ß√£o Cient√≠fica: Voc√™ vs üáßüá∑ Brasil vs üåç Mundial
                    </h2>
                </div>
                <div class="chart-container tall">
                    <canvas id="globalComparisonChart"></canvas>
                </div>
                <div class="comparison-legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: linear-gradient(135deg, #6366f1, #8b5cf6);"></div>
                        <span><strong>Voc√™</strong> (Suas metas)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: linear-gradient(135deg, #10b981, #059669);"></div>
                        <span>üáßüá∑ <strong>M√©dia Brasil</strong> (Pesquisas 2024)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: linear-gradient(135deg, #f59e0b, #d97706);"></div>
                        <span>üåç <strong>M√©dia Mundial</strong> (OMS/Pesquisas)</span>
                    </div>
                </div>
                <div class="scientific-note">
                    <strong>üìö Fontes:</strong> Instituto Pr√≥-Livro 2024, OMS (150-300min exerc√≠cio/semana), Cambridge English (1200h flu√™ncia), Estudos CEFR
                </div>
            </div>

            <!-- Adicionar H√°bito -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-plus-circle"></i>
                        Gerenciar H√°bitos
                    </h2>
                </div>

                <div class="habit-form">
                    <div class="form-group">
                        <label for="habitName">Nome do H√°bito</label>
                        <input type="text" id="habitName" placeholder="Ex: Correr, Meditar, Ler...">
                    </div>

                    <div class="form-group">
                        <label for="habitGoal">Meta Semanal (vezes)</label>
                        <input type="number" id="habitGoal" placeholder="Quantas vezes por semana?" min="1" max="7" value="3">
                    </div>

                    <div class="form-group">
                        <label for="habitDuration">Dura√ß√£o (minutos)</label>
                        <input type="number" id="habitDuration" placeholder="Quanto tempo por sess√£o?" min="1" value="30">
                    </div>

                    <button class="btn btn-primary" onclick="addHabit()">
                        <i class="fas fa-plus"></i> Adicionar H√°bito
                    </button>
                </div>

                <!-- Lista de H√°bitos -->
                <div class="habits-list" id="habitsList"></div>
            </div>

            <!-- Progresso Semanal -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-calendar-week"></i>
                        Seu Progresso Semanal
                    </h2>
                </div>
                <div class="chart-container">
                    <canvas id="weeklyProgressChart"></canvas>
                </div>
            </div>

            <!-- Evolu√ß√£o 2026 -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-chart-line"></i>
                        Evolu√ß√£o em 2026 (Semana a Semana)
                    </h2>
                </div>
                <div class="chart-container">
                    <canvas id="evolution2026Chart"></canvas>
                </div>
                <div class="scientific-note">
                    <strong>üí° Acumulado:</strong> Dados salvos automaticamente semana ap√≥s semana em 2026
                </div>
            </div>

            <!-- Compara√ß√£o por Categoria -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-balance-scale"></i>
                        Voc√™ vs M√©dias por Categoria
                    </h2>
                </div>
                <div class="chart-container">
                    <canvas id="categoryComparisonChart"></canvas>
                </div>
            </div>

            <!-- An√°lise de Performance -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-chart-radar"></i>
                        An√°lise de Performance
                    </h2>
                </div>
                <div class="chart-container">
                    <canvas id="performanceRadarChart"></canvas>
                </div>
            </div>

            <!-- Jejum de A√ß√∫car - 40 Dias -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-candy-cane"></i>
                        üç≠ Desafio 40 Dias Sem A√ß√∫car
                    </h2>
                </div>

                <!-- PLACAR ANUAL 2026 -->
                <div style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.15), rgba(5, 150, 105, 0.1)); padding: 20px; border-radius: 12px; margin-bottom: 20px; border: 2px solid rgba(16, 185, 129, 0.4);">
                    <div style="text-align: center; margin-bottom: 15px;">
                        <div style="font-size: 1rem; color: var(--secondary); font-weight: 700;">
                            üèÜ PLACAR ANUAL 2026
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px;">
                        <div style="text-align: center; padding: 15px; background: rgba(0,0,0,0.2); border-radius: 10px; border: 2px solid rgba(16, 185, 129, 0.3);">
                            <div style="font-size: 0.75rem; color: var(--gray); margin-bottom: 5px;">‚úÖ Completados</div>
                            <div style="font-size: 2.5rem; font-weight: 900; color: var(--secondary);" id="jejumsCompleted">0</div>
                            <div style="font-size: 0.7rem; color: var(--secondary); margin-top: 3px;">ciclos de 40 dias</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: rgba(0,0,0,0.2); border-radius: 10px; border: 2px solid rgba(239, 68, 68, 0.3);">
                            <div style="font-size: 0.75rem; color: var(--gray); margin-bottom: 5px;">‚ùå Falhados</div>
                            <div style="font-size: 2.5rem; font-weight: 900; color: var(--danger);" id="jejumsFailed">0</div>
                            <div style="font-size: 0.7rem; color: var(--danger); margin-top: 3px;">tentativas quebradas</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: rgba(0,0,0,0.2); border-radius: 10px; border: 2px solid rgba(14, 165, 233, 0.3);">
                            <div style="font-size: 0.75rem; color: var(--gray); margin-bottom: 5px;">üìä Taxa Sucesso</div>
                            <div style="font-size: 2.5rem; font-weight: 900; color: var(--info);" id="successRate">0%</div>
                            <div style="font-size: 0.7rem; color: var(--info); margin-top: 3px;">completados/total</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: rgba(0,0,0,0.2); border-radius: 10px; border: 2px solid rgba(245, 158, 11, 0.3);">
                            <div style="font-size: 0.75rem; color: var(--gray); margin-bottom: 5px;">üî• Dias Totais</div>
                            <div style="font-size: 2.5rem; font-weight: 900; color: var(--warning);" id="totalDaysFasted">0</div>
                            <div style="font-size: 0.7rem; color: var(--warning); margin-top: 3px;">dias sem a√ß√∫car</div>
                        </div>
                    </div>
                </div>
                
                <!-- LINHA 1: Contador + Mini Gr√°fico + Benef√≠cios -->
                <div style="display: grid; grid-template-columns: 1.3fr 1.5fr 1.2fr; gap: 20px; margin-bottom: 20px;">
                    
                    <!-- CONTADOR PRINCIPAL -->
                    <div style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.15), rgba(245, 158, 11, 0.15)); padding: 25px; border-radius: 16px; border: 2px solid rgba(239, 68, 68, 0.4); text-align: center; position: relative; overflow: hidden;">
                        
                        <!-- Efeito de fundo pulsante -->
                        <div style="position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: radial-gradient(circle, rgba(239, 68, 68, 0.1) 0%, transparent 70%); animation: pulse 3s ease-in-out infinite;"></div>
                        
                        <div style="position: relative; z-index: 1;">
                            <!-- Contador Gigante -->
                            <div style="font-size: 5rem; font-weight: 900; background: linear-gradient(135deg, #ef4444, #f59e0b, #ef4444); -webkit-background-clip: text; background-clip: text; color: transparent; margin: 10px 0; text-shadow: 0 0 30px rgba(239, 68, 68, 0.3); line-height: 1;">
                                <span id="sugarFastDays">0</span>
                            </div>
                            
                            <div style="font-size: 1.3rem; font-weight: 700; color: var(--light); margin-bottom: 3px; letter-spacing: 1px;">
                                DIAS SEM A√á√öCAR
                            </div>
                            
                            <div style="font-size: 0.95rem; color: var(--warning); margin-bottom: 20px; font-weight: 600;">
                                üéØ Meta: 40 dias (<span id="sugarFastPercentage">0%</span>)
                            </div>

                            <!-- Barra de Progresso -->
                            <div style="width: 100%; background: rgba(0,0,0,0.3); border-radius: 25px; height: 30px; overflow: hidden; margin-bottom: 20px; box-shadow: inset 0 2px 10px rgba(0,0,0,0.3);">
                                <div id="sugarFastProgressBar" style="height: 100%; background: linear-gradient(90deg, #ef4444, #f59e0b, #ef4444); background-size: 200% 100%; width: 0%; transition: width 0.5s ease; display: flex; align-items: center; justify-content: center; font-weight: 800; color: white; font-size: 0.95rem; animation: gradientShift 3s ease infinite; box-shadow: 0 0 20px rgba(239, 68, 68, 0.5);"></div>
                            </div>

                            <!-- Bot√µes Corrigidos -->
                            <div style="display: flex; flex-direction: column; gap: 10px;">
                                <button class="btn btn-success" onclick="startSugarFast()" id="startFastBtn" style="width: 100%; font-size: 1rem; padding: 12px; font-weight: 700; box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);">
                                    <i class="fas fa-play-circle"></i> INICIAR JEJUM
                                </button>
                                <div style="display: none; flex-direction: column; gap: 8px;" id="activeButtonsContainer">
                                    <button class="btn btn-danger" onclick="breakSugarFast()" id="breakFastBtn" style="width: 100%; font-size: 0.95rem; padding: 10px; font-weight: 700;">
                                        <i class="fas fa-times-circle"></i> QUEBREI O JEJUM
                                    </button>
                                    <button class="btn btn-primary" onclick="resetSugarFast()" id="resetFastBtn" style="width: 100%; font-size: 0.95rem; padding: 10px; font-weight: 700;">
                                        <i class="fas fa-redo-alt"></i> RESETAR
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- MINI GR√ÅFICO DE PROGRESSO -->
                    <div style="background: rgba(15, 23, 42, 0.6); padding: 25px; border-radius: 16px; border: 2px solid rgba(99, 102, 241, 0.3);">
                        <div style="text-align: center; margin-bottom: 15px;">
                            <div style="font-size: 1rem; color: var(--primary); font-weight: 700; margin-bottom: 5px;">
                                üìà PROGRESSO VISUAL
                            </div>
                            <div style="font-size: 0.8rem; color: var(--gray);">Sua jornada at√© 40 dias</div>
                        </div>
                        
                        <!-- Canvas para mini gr√°fico -->
                        <div style="position: relative; height: 180px; margin-bottom: 10px;">
                            <canvas id="sugarFastMiniChart"></canvas>
                        </div>

                        <!-- Legenda do gr√°fico -->
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 0.75rem; text-align: center;">
                            <div style="padding: 6px; background: rgba(16, 185, 129, 0.1); border-radius: 6px; border: 1px solid rgba(16, 185, 129, 0.3);">
                                <div style="color: var(--secondary); font-weight: 700;">‚úì Progresso</div>
                                <div style="color: var(--gray);"><span id="miniChartDays">0</span> dias</div>
                            </div>
                            <div style="padding: 6px; background: rgba(148, 163, 184, 0.1); border-radius: 6px; border: 1px solid rgba(148, 163, 184, 0.3);">
                                <div style="color: var(--gray); font-weight: 700;">‚óã Restante</div>
                                <div style="color: var(--gray);"><span id="miniChartRemaining">40</span> dias</div>
                            </div>
                        </div>
                    </div>

                    <!-- BENEF√çCIOS CIENT√çFICOS + CONEX√ÉO CORPORAL -->
                    <div style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.15), rgba(5, 150, 105, 0.15)); padding: 20px; border-radius: 16px; border: 2px solid rgba(16, 185, 129, 0.4);">
                        <div style="font-size: 0.95rem; color: var(--secondary); font-weight: 700; margin-bottom: 15px; text-align: center;">
                            üí™ IMPACTO NO ABD√îMEN
                        </div>
                        <div style="display: flex; flex-direction: column; gap: 8px; font-size: 0.78rem; color: var(--light);">
                            <div style="display: flex; align-items: center; gap: 8px; padding: 6px; background: rgba(0,0,0,0.2); border-radius: 6px;">
                                <span style="color: var(--secondary); font-size: 1rem;">‚úì</span>
                                <span>40 dias = <strong>-2 a 5% BF</strong></span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px; padding: 6px; background: rgba(0,0,0,0.2); border-radius: 6px;">
                                <span style="color: var(--secondary); font-size: 1rem;">‚úì</span>
                                <span><strong>Abs vis√≠veis</strong> abaixo 12% BF</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px; padding: 6px; background: rgba(0,0,0,0.2); border-radius: 6px;">
                                <span style="color: var(--secondary); font-size: 1rem;">‚úì</span>
                                <span>Reduz gordura <strong>visceral</strong></span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px; padding: 6px; background: rgba(0,0,0,0.2); border-radius: 6px;">
                                <span style="color: var(--secondary); font-size: 1rem;">‚úì</span>
                                <span>Insulina ‚Üì = <strong>queima gordura</strong></span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px; padding: 6px; background: rgba(0,0,0,0.2); border-radius: 6px;">
                                <span style="color: var(--secondary); font-size: 1rem;">‚úì</span>
                                <span><strong>Defini√ß√£o muscular</strong> aumenta</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- LINHA 2: Marcos Principais + Hist√≥rico (lado a lado) -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    
                    <!-- MARCOS PRINCIPAIS -->
                    <div style="background: rgba(15, 23, 42, 0.6); padding: 20px; border-radius: 12px; border: 2px solid rgba(99, 102, 241, 0.3);">
                        <div style="text-align: center; margin-bottom: 15px;">
                            <div style="font-size: 0.95rem; color: var(--primary); font-weight: 700;">
                                üéØ MARCOS PRINCIPAIS
                            </div>
                        </div>
                        
                        <div style="display: flex; flex-direction: column; gap: 10px;">
                            <!-- Marco 7 dias -->
                            <div id="milestone7" style="padding: 12px; border-radius: 10px; background: rgba(255,255,255,0.05); border: 2px solid transparent; transition: all 0.3s ease; cursor: pointer;">
                                <div style="display: flex; align-items: center; gap: 12px;">
                                    <div style="font-size: 1.8rem; min-width: 40px; text-align: center;">‚≠ê</div>
                                    <div style="flex: 1;">
                                        <div style="font-weight: 700; font-size: 0.95rem; color: var(--light);">DIA 7</div>
                                        <div style="font-size: 0.75rem; color: var(--gray);">Primeira semana completa</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Marco 21 dias -->
                            <div id="milestone21" style="padding: 12px; border-radius: 10px; background: rgba(255,255,255,0.05); border: 2px solid transparent; transition: all 0.3s ease; cursor: pointer;">
                                <div style="display: flex; align-items: center; gap: 12px;">
                                    <div style="font-size: 1.8rem; min-width: 40px; text-align: center;">üß†</div>
                                    <div style="flex: 1;">
                                        <div style="font-weight: 700; font-size: 0.95rem; color: var(--light);">DIA 21</div>
                                        <div style="font-size: 0.75rem; color: var(--gray);">H√°bito neurologicamente formado</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Marco 40 dias -->
                            <div id="milestone40" style="padding: 12px; border-radius: 10px; background: rgba(255,255,255,0.05); border: 2px solid transparent; transition: all 0.3s ease; cursor: pointer;">
                                <div style="display: flex; align-items: center; gap: 12px;">
                                    <div style="font-size: 1.8rem; min-width: 40px; text-align: center;">üëë</div>
                                    <div style="flex: 1;">
                                        <div style="font-weight: 700; font-size: 0.95rem; color: var(--light);">DIA 40</div>
                                        <div style="font-size: 0.75rem; color: var(--gray);">META ALCAN√áADA! üèÜ</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- SEU HIST√ìRICO -->
                    <div style="background: linear-gradient(135deg, rgba(139, 92, 246, 0.15), rgba(99, 102, 241, 0.15)); padding: 20px; border-radius: 12px; border: 2px solid rgba(139, 92, 246, 0.4);">
                        <div style="font-size: 0.95rem; color: var(--accent); font-weight: 700; margin-bottom: 15px; text-align: center;">
                            üìä SEU HIST√ìRICO
                        </div>
                        <div style="display: flex; flex-direction: column; gap: 10px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: rgba(0,0,0,0.2); border-radius: 10px; border: 2px solid rgba(245, 158, 11, 0.3);">
                                <div>
                                    <div style="font-size: 0.75rem; color: var(--gray); margin-bottom: 2px;">üèÜ Recorde Pessoal</div>
                                    <div style="font-size: 0.8rem; color: var(--warning); font-weight: 600;">Melhor sequ√™ncia</div>
                                </div>
                                <div style="font-size: 2rem; font-weight: 800; color: var(--warning);"><span id="bestStreakDisplay">0</span><span style="font-size: 1.2rem;">d</span></div>
                            </div>
                            
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: rgba(0,0,0,0.2); border-radius: 10px; border: 2px solid rgba(14, 165, 233, 0.3);">
                                <div>
                                    <div style="font-size: 0.75rem; color: var(--gray); margin-bottom: 2px;">üéØ Total de Tentativas</div>
                                    <div style="font-size: 0.8rem; color: var(--info); font-weight: 600;">Vezes que iniciou</div>
                                </div>
                                <div style="font-size: 2rem; font-weight: 800; color: var(--info);"><span id="totalAttemptsDisplay">0</span><span style="font-size: 1.2rem;">x</span></div>
                            </div>
                            
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: rgba(0,0,0,0.2); border-radius: 10px; border: 2px solid rgba(239, 68, 68, 0.3);">
                                <div>
                                    <div style="font-size: 0.75rem; color: var(--gray); margin-bottom: 2px;">üíî Vezes que Quebrou</div>
                                    <div style="font-size: 0.8rem; color: var(--danger); font-weight: 600;">Hist√≥rico de quebras</div>
                                </div>
                                <div style="font-size: 2rem; font-weight: 800; color: var(--danger);"><span id="breaksDisplay">0</span><span style="font-size: 1.2rem;">x</span></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- LINHA 3: Compara√ß√£o Brasil vs Voc√™ -->
                <div style="padding: 20px; background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(239, 68, 68, 0.1)); border-radius: 12px; border: 2px solid rgba(245, 158, 11, 0.3);">
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; text-align: center;">
                        <div>
                            <div style="font-size: 0.8rem; color: var(--gray); margin-bottom: 5px;">üáßüá∑ CONSUMO BRASIL</div>
                            <div style="font-size: 2rem; font-weight: 800; color: var(--danger);">51kg</div>
                            <div style="font-size: 0.7rem; color: var(--gray);">a√ß√∫car/ano (Embrapa)</div>
                        </div>
                        <div>
                            <div style="font-size: 0.8rem; color: var(--gray); margin-bottom: 5px;">üåç RECOMENDA√á√ÉO OMS</div>
                            <div style="font-size: 2rem; font-weight: 800; color: var(--warning);">25g</div>
                            <div style="font-size: 0.7rem; color: var(--gray);">por dia (m√°ximo)</div>
                        </div>
                        <div>
                            <div style="font-size: 0.8rem; color: var(--gray); margin-bottom: 5px;">üéØ VOC√ä NO JEJUM</div>
                            <div style="font-size: 2rem; font-weight: 800; color: var(--secondary);">0g</div>
                            <div style="font-size: 0.7rem; color: var(--secondary); font-weight: 700;">TOP 5% MUNDIAL! üèÜ</div>
                        </div>
                    </div>
                </div>

                <div class="scientific-note" style="margin-top: 15px;">
                    <strong>üìö Fontes:</strong> OMS 2015, BMC Medicine 2023, Harvard Medical, Embrapa, NSC Total 2024, Journal of Clinical Endocrinology 2024
                </div>
            </div>

            <style>
                @keyframes pulse {
                    0%, 100% { opacity: 0.3; transform: scale(1); }
                    50% { opacity: 0.6; transform: scale(1.05); }
                }

                @keyframes gradientShift {
                    0% { background-position: 0% 50%; }
                    50% { background-position: 100% 50%; }
                    100% { background-position: 0% 50%; }
                }

                /* Responsividade */
                @media (max-width: 1200px) {
                    .card > div[style*="grid-template-columns: 1.3fr 1.5fr 1.2fr"],
                    .card > div[style*="grid-template-columns: 1fr 1fr"] {
                        grid-template-columns: 1fr !important;
                    }
                }
            </style>

            <!-- Insights Inteligentes -->
            <div class="card full-width">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-lightbulb"></i>
                        Insights Cient√≠ficos Baseados em Dados Reais
                    </h2>
                </div>
                <div class="insights-grid" id="insightsGrid"></div>
            </div>


            <!-- Acompanhamento Corporal - NOVA SE√á√ÉO -->
            <div class="card full-width">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-weight"></i>
                        üí™ Acompanhamento Corporal - Evolu√ß√£o F√≠sica
                    </h2>
                </div>

                <!-- Seus Dados Fixos -->
                <div style="background: linear-gradient(135deg, rgba(99, 102, 241, 0.15), rgba(139, 92, 246, 0.15)); padding: 20px; border-radius: 12px; margin-bottom: 25px; border: 2px solid rgba(99, 102, 241, 0.4);">
                    <div style="text-align: center; margin-bottom: 15px;">
                        <div style="font-size: 1rem; color: var(--primary); font-weight: 700;">
                            üìã SEUS DADOS PESSOAIS
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
                        <div style="text-align: center; padding: 15px; background: rgba(0,0,0,0.2); border-radius: 10px;">
                            <div style="font-size: 0.8rem; color: var(--gray); margin-bottom: 5px;">üìè Altura</div>
                            <div style="font-size: 2rem; font-weight: 800; color: var(--primary);">1,84m</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: rgba(0,0,0,0.2); border-radius: 10px;">
                            <div style="font-size: 0.8rem; color: var(--gray); margin-bottom: 5px;">üéÇ Idade</div>
                            <div style="font-size: 2rem; font-weight: 800; color: var(--accent);">28 anos</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: rgba(0,0,0,0.2); border-radius: 10px;">
                            <div style="font-size: 0.8rem; color: var(--gray); margin-bottom: 5px;">üéØ Meta BF</div>
                            <div style="font-size: 2rem; font-weight: 800; color: var(--secondary);">12%</div>
                        </div>
                    </div>
                </div>

                <!-- Formul√°rio de Registro Semanal -->
                <div style="background: rgba(15, 23, 42, 0.5); padding: 25px; border-radius: 12px; margin-bottom: 25px; border: 2px solid rgba(16, 185, 129, 0.3);">
                    <div style="font-size: 1rem; color: var(--secondary); font-weight: 700; margin-bottom: 20px; text-align: center;">
                        üìù REGISTRAR MEDI√á√ÉO
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 15px; margin-bottom: 15px;">
                        <div class="form-group">
                            <label for="measurementDate">üìÖ Data</label>
                            <input type="date" id="measurementDate" style="font-size: 0.95rem; font-weight: 700;">
                        </div>
                        <div class="form-group">
                            <label for="bodyWeight">‚öñÔ∏è Peso (kg)</label>
                            <input type="number" id="bodyWeight" placeholder="Ex: 85" min="40" max="200" step="0.1" style="font-size: 1rem; font-weight: 700;">
                        </div>
                        <div class="form-group">
                            <label for="bodyFatPercent">üìä Gordura (%)</label>
                            <input type="number" id="bodyFatPercent" placeholder="Ex: 15" min="3" max="50" step="0.1" style="font-size: 1rem; font-weight: 700;">
                        </div>
                        <div class="form-group">
                            <label for="muscleMass">üí™ Massa Magra (kg)</label>
                            <input type="number" id="muscleMass" placeholder="Ex: 70" min="20" max="150" step="0.1" style="font-size: 1rem; font-weight: 700;">
                        </div>
                        <div class="form-group">
                            <label style="opacity: 0;">.</label>
                            <button class="btn btn-success" onclick="addBodyMeasurement()" style="width: 100%; font-size: 0.95rem; padding: 14px; font-weight: 700;">
                                <i class="fas fa-plus-circle"></i> REGISTRAR
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Dashboard de M√©tricas Atuais -->
                <div id="bodyMetricsDashboard" style="display: none;">
                    
                    <!-- Cards de M√©tricas Atuais -->
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 25px;">
                        
                        <!-- Peso Atual -->
                        <div style="background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(99, 102, 241, 0.1)); padding: 20px; border-radius: 12px; border: 2px solid rgba(99, 102, 241, 0.5); text-align: center;">
                            <div style="font-size: 0.85rem; color: var(--primary); font-weight: 700; margin-bottom: 8px;">‚öñÔ∏è PESO ATUAL</div>
                            <div style="font-size: 2.5rem; font-weight: 900; color: var(--primary);" id="currentWeight">0 kg</div>
                            <div style="font-size: 0.75rem; color: var(--gray); margin-top: 5px;" id="weightChange">-</div>
                        </div>

                        <!-- BF% Atual -->
                        <div style="background: linear-gradient(135deg, rgba(245, 158, 11, 0.2), rgba(245, 158, 11, 0.1)); padding: 20px; border-radius: 12px; border: 2px solid rgba(245, 158, 11, 0.5); text-align: center;">
                            <div style="font-size: 0.85rem; color: var(--warning); font-weight: 700; margin-bottom: 8px;">üìä GORDURA (%)</div>
                            <div style="font-size: 2.5rem; font-weight: 900; color: var(--warning);" id="currentBF">0%</div>
                            <div style="font-size: 0.75rem; color: var(--gray); margin-top: 5px;" id="bfChange">-</div>
                        </div>

                        <!-- Massa Magra -->
                        <div style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(16, 185, 129, 0.1)); padding: 20px; border-radius: 12px; border: 2px solid rgba(16, 185, 129, 0.5); text-align: center;">
                            <div style="font-size: 0.85rem; color: var(--secondary); font-weight: 700; margin-bottom: 8px;">üí™ MASSA MAGRA</div>
                            <div style="font-size: 2.5rem; font-weight: 900; color: var(--secondary);" id="currentMuscle">0 kg</div>
                            <div style="font-size: 0.75rem; color: var(--gray); margin-top: 5px;" id="muscleChange">-</div>
                        </div>

                        <!-- IMC -->
                        <div style="background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(139, 92, 246, 0.1)); padding: 20px; border-radius: 12px; border: 2px solid rgba(139, 92, 246, 0.5); text-align: center;">
                            <div style="font-size: 0.85rem; color: var(--accent); font-weight: 700; margin-bottom: 8px;">üìè IMC</div>
                            <div style="font-size: 2.5rem; font-weight: 900; color: var(--accent);" id="currentIMC">0</div>
                            <div style="font-size: 0.75rem; color: var(--gray); margin-top: 5px;" id="imcClassification">-</div>
                        </div>
                    </div>

                    <!-- Gr√°ficos de Evolu√ß√£o -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin-bottom: 25px;">
                        
                        <!-- Gr√°fico de Peso -->
                        <div style="background: rgba(15, 23, 42, 0.6); padding: 25px; border-radius: 12px; border: 2px solid rgba(99, 102, 241, 0.3);">
                            <div style="text-align: center; margin-bottom: 15px;">
                                <div style="font-size: 1rem; color: var(--primary); font-weight: 700;">
                                    üìà EVOLU√á√ÉO DO PESO
                                </div>
                                <div style="font-size: 0.8rem; color: var(--gray);">Semana a semana em 2026</div>
                            </div>
                            <div style="position: relative; height: 280px;">
                                <canvas id="weightEvolutionChart"></canvas>
                            </div>
                        </div>

                        <!-- Gr√°fico de BF% -->
                        <div style="background: rgba(15, 23, 42, 0.6); padding: 25px; border-radius: 12px; border: 2px solid rgba(245, 158, 11, 0.3);">
                            <div style="text-align: center; margin-bottom: 15px;">
                                <div style="font-size: 1rem; color: var(--warning); font-weight: 700;">
                                    üéØ EVOLU√á√ÉO GORDURA (%)
                                </div>
                                <div style="font-size: 0.8rem; color: var(--gray);">Meta: 12% BF</div>
                            </div>
                            <div style="position: relative; height: 280px;">
                                <canvas id="bfEvolutionChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Gr√°fico de Composi√ß√£o Corporal -->
                    <div style="background: rgba(15, 23, 42, 0.6); padding: 25px; border-radius: 12px; border: 2px solid rgba(16, 185, 129, 0.3); margin-bottom: 25px;">
                        <div style="text-align: center; margin-bottom: 15px;">
                            <div style="font-size: 1.1rem; color: var(--secondary); font-weight: 700;">
                                üí™ COMPOSI√á√ÉO CORPORAL - Massa Magra vs Gordura
                            </div>
                            <div style="font-size: 0.85rem; color: var(--gray);">Evolu√ß√£o mensal 2026</div>
                        </div>
                        <div style="position: relative; height: 300px;">
                            <canvas id="bodyCompositionChart"></canvas>
                        </div>
                    </div>

                    <!-- An√°lise Cient√≠fica -->
                    <div style="background: linear-gradient(135deg, rgba(14, 165, 233, 0.15), rgba(6, 182, 212, 0.1)); padding: 25px; border-radius: 12px; border: 2px solid rgba(14, 165, 233, 0.4);">
                        <div style="font-size: 1.1rem; color: var(--info); font-weight: 700; margin-bottom: 15px; text-align: center;">
                            üî¨ AN√ÅLISE CIENT√çFICA - Seu Perfil vs Dados M√©dicos
                        </div>
                        <div id="bodyAnalysis"></div>
                    </div>
                </div>

                <div class="scientific-note" style="margin-top: 20px;">
                    <strong>üìö Fontes:</strong> ACE (American Council on Exercise), OMS, Tua Sa√∫de 2024, Harvard Medical School, Estudos Bioimped√¢ncia 2024
                </div>
            </div>
        </div>
    </div>

    <script>
        // DADOS CIENT√çFICOS REAIS - Baseados em pesquisas de 2024
        const scientificData = {
            reading: {
                brazil: {
                    weekly: 2,  // Brasileiros leem 2,4 livros/ano = ~0,3 livros/semana ‚âà 2x por semana
                    minutes: 20, // Maioria n√£o l√™ mais que 10 p√°ginas seguidas
                    source: 'Instituto Pr√≥-Livro 2024 - 53% n√£o leem'
                },
                world: {
                    weekly: 4,  // M√©dia global: EUA 11 livros/ano, Fran√ßa 7
                    minutes: 30,
                    source: 'Pesquisas globais 2024'
                },
                elite: {
                    weekly: 7,  // Leitores de elite: 5 p√°ginas/dia = 1825 p√°g/ano
                    minutes: 30,
                    source: 'Estudo "5 p√°ginas por dia"'
                }
            },
            english: {
                brazil: {
                    weekly: 2,  // Maioria estuda 3h/semana em escolas
                    minutes: 45, // Aulas de 90min 2x/semana
                    totalHours: 1200, // 1200h para flu√™ncia
                    source: 'Cambridge English + escolas BR'
                },
                world: {
                    weekly: 3,  // Recomenda√ß√£o: 1h/dia para flu√™ncia em 3 anos
                    minutes: 60,
                    source: 'CEFR - Common European Framework'
                },
                elite: {
                    weekly: 5,  // 5h/dia para flu√™ncia em 1 ano
                    minutes: 60,
                    source: 'Estudos de imers√£o lingu√≠stica'
                }
            },
            exercise: {
                brazil: {
                    weekly: 2,  // 50% n√£o atingem 150min/semana OMS
                    minutes: 37, // M√©dia dos ativos: ~75min/semana √∑ 2 dias
                    source: 'Minist√©rio da Sa√∫de 2021 - Vigitel'
                },
                world: {
                    weekly: 3,  // OMS: 150min/semana = 30min 5x
                    minutes: 50, // Recomenda√ß√£o OMS m√≠nima
                    source: 'OMS 2020 - 150-300min/semana'
                },
                elite: {
                    weekly: 5,  // OMS: 300min/semana para benef√≠cios m√°ximos
                    minutes: 60,
                    source: 'OMS - Diretrizes 2020'
                }
            },
            career: {
                brazil: {
                    weekly: 2,  // Poucos investem em desenvolvimento
                    minutes: 30,
                    source: 'Estimativa baseada em mercado BR'
                },
                world: {
                    weekly: 3,  // Profissionais dedicados
                    minutes: 50,
                    source: 'Estudos de desenvolvimento profissional'
                },
                elite: {
                    weekly: 5,  // Alta dedica√ß√£o
                    minutes: 60,
                    source: 'Top performers'
                }
            },
            wellness: {
                brazil: {
                    weekly: 1,  // Bem-estar negligenciado
                    minutes: 20,
                    source: 'Estimativa comportamento BR'
                },
                world: {
                    weekly: 2,  // Crescente conscientiza√ß√£o
                    minutes: 30,
                    source: 'Tend√™ncias globais sa√∫de mental'
                },
                elite: {
                    weekly: 3,  // Alta prioridade
                    minutes: 45,
                    source: 'Pr√°ticas de mindfulness'
                }
            }
        };

        // Vari√°veis globais
        let habits = [];
        let appData = {
            streak: 0,
            lastActiveDate: null,
            weeklyScores: {},
            totalHours2026: 0,
            year2026Data: {},
            sugarFast: {
                active: false,
                startDate: null,
                currentDays: 0,
                bestStreak: 0,
                totalAttempts: 0,
                breaks: []
            }
        };

        // Dados cient√≠ficos do jejum de a√ß√∫car
        const sugarFastScience = {
            timeline: [
                {
                    day: 1,
                    phase: "In√≠cio do Desafio",
                    icon: "fa-flag-checkered",
                    color: "#0ea5e9",
                    effects: [
                        "Corpo come√ßa a sentir falta do a√ß√∫car",
                        "Poss√≠vel irritabilidade e dor de cabe√ßa",
                        "Aumento do cortisol (horm√¥nio do estresse)"
                    ],
                    source: "Estudo Faculdade Anhanguera 2024"
                },
                {
                    day: 3,
                    phase: "Supera√ß√£o Inicial",
                    icon: "fa-check-circle",
                    color: "#10b981",
                    effects: [
                        "Sintomas de abstin√™ncia diminuem",
                        "Redu√ß√£o da irritabilidade",
                        "Corpo come√ßa adapta√ß√£o metab√≥lica"
                    ],
                    source: "National Geographic 2025"
                },
                {
                    day: 7,
                    phase: "1¬™ Semana Completa",
                    icon: "fa-star",
                    color: "#f59e0b",
                    effects: [
                        "Redu√ß√£o do incha√ßo abdominal",
                        "Melhora no perfil glic√™mico",
                        "Normaliza√ß√£o do humor",
                        "Energia mais est√°vel"
                    ],
                    source: "Minha Vida 2018"
                },
                {
                    day: 14,
                    phase: "2 Semanas - Mudan√ßas Vis√≠veis",
                    icon: "fa-heartbeat",
                    color: "#ef4444",
                    effects: [
                        "Perda de peso: 2-5kg",
                        "Melhora na qualidade do sono",
                        "Redu√ß√£o da ansiedade",
                        "Sistema imunol√≥gico fortalecido",
                        "Pele mais clara e menos oleosa"
                    ],
                    source: "NSC Total 2024 + Longevidade Saud√°vel"
                },
                {
                    day: 21,
                    phase: "3 Semanas - H√°bito Formado",
                    icon: "fa-brain",
                    color: "#8b5cf6",
                    effects: [
                        "H√°bito neurologicamente formado",
                        "Redu√ß√£o significativa do desejo por doces",
                        "Melhora na concentra√ß√£o e foco",
                        "Redu√ß√£o de 10% risco de AVC (BMC Medicine)",
                        "Melhor fun√ß√£o cognitiva"
                    ],
                    source: "BMC Medicine 2023 + Harvard Medical"
                },
                {
                    day: 30,
                    phase: "1 M√™s - Transforma√ß√£o Completa",
                    icon: "fa-trophy",
                    color: "#f59e0b",
                    effects: [
                        "Redu√ß√£o triglicer√≠deos e colesterol",
                        "Menos inflama√ß√£o (prote√≠na C reativa ‚Üì)",
                        "Risco 6% menor de doen√ßas card√≠acas",
                        "Pele renovada, menos acne",
                        "Energia sustentada o dia todo",
                        "Melhor sa√∫de dental"
                    ],
                    source: "Cardio DF 2024 + OMS"
                },
                {
                    day: 40,
                    phase: "40 Dias - Meta Alcan√ßada! üèÜ",
                    icon: "fa-crown",
                    color: "#10b981",
                    effects: [
                        "Revers√£o da resist√™ncia √† insulina",
                        "Redu√ß√£o de 50-100x uso glicose c√©lulas cancer√≠genas",
                        "Menor risco dem√™ncia e Alzheimer",
                        "Regenera√ß√£o completa do paladar",
                        "Transforma√ß√£o metab√≥lica profunda",
                        "Voc√™ est√° no TOP 5% da popula√ß√£o!"
                    ],
                    source: "Scripps Research 2008 + Harvard"
                }
            ],
            milestones: [
                { days: 3, title: "Sintomas passam", emoji: "üí™" },
                { days: 7, title: "1 Semana!", emoji: "‚≠ê" },
                { days: 14, title: "2 Semanas!", emoji: "üî•" },
                { days: 21, title: "H√°bito formado", emoji: "üß†" },
                { days: 30, title: "1 M√™s!", emoji: "üèÜ" },
                { days: 40, title: "META!", emoji: "üëë" }
            ],
            comparisons: {
                brazil: {
                    consumption: 51,  // kg/ano
                    source: "Embrapa - 51-55kg/ano per capita"
                },
                world: {
                    consumption: 25,  // kg/ano
                    source: "M√©dia mundial ~25kg/ano"
                },
                who: {
                    recommendation: 25,  // gramas/dia m√°ximo (5% calorias)
                    source: "OMS 2015 - m√°x 25g/dia"
                }
            }
        };

        // Vari√°veis de gr√°ficos
        let weeklyProgressChart = null;
        let categoryComparisonChart = null;
        let performanceRadarChart = null;
        let globalComparisonChart = null;
        let evolution2026Chart = null;
        let financeComparisonChart = null;

        // DADOS FINANCEIROS CIENT√çFICOS - IBGE/DIEESE 2025
        const financeData = {
            brazil: {
                average: 3294, // R$ - IBGE/DIEESE 2025
                byAge: {
                    '14-17': 850,
                    '18-24': 1850,
                    '25-39': 3200,  // Pico salarial
                    '40-59': 3800,  // Maior experi√™ncia
                    '60+': 2400
                },
                pyramid: {
                    bottom50: 1848,  // Metade mais pobre
                    upto1Min: 35.63, // % at√© 1 sal√°rio m√≠nimo
                    '1to2Min': 31.56, // % entre 1 e 2 sal√°rios
                    above2Min: 32.81, // % acima de 2 sal√°rios
                    top10: 20664,    // 10% mais ricos
                    top1: 20664      // 1% mais ricos
                }
            },
            world: {
                average: 21970, // R$ (USD 4,232 √ó R$ 5,19)
                usdAverage: 4232,
                exchangeRate: 5.19,
                topCountries: {
                    switzerland: 42651, // USD 8,218 √ó 5,19
                    luxembourg: 34978,
                    usa: 34055,
                    iceland: 33990,
                    norway: 29951
                }
            }
        };

        // DADOS CORPORAIS CIENT√çFICOS - ACE/OMS 2024
        const bodyData = {
            userProfile: {
                height: 1.84, // metros
                age: 28,
                gender: 'male',
                goalBF: 12 // Meta de gordura corporal %
            },
            bodyFatStandards: {
                male: {
                    essential: { min: 2, max: 5 },    // Gordura essencial
                    athletes: { min: 6, max: 13 },    // Atletas
                    fitness: { min: 14, max: 17 },    // Fitness
                    average: { min: 18, max: 24 },    // M√©dia
                    obese: { min: 25, max: 100 }      // Obesidade
                },
                ageRanges: {
                    '18-24': { min: 13.2, max: 18.6 },
                    '25-34': { min: 15.3, max: 21.8 },
                    '35-44': { min: 16.2, max: 23.1 },
                    '45-54': { min: 16.6, max: 23.7 }
                }
            },
            measurements: [] // Armazenar medi√ß√µes
        };

        // Vari√°veis de gr√°ficos corporais
        let weightEvolutionChart = null;
        let bfEvolutionChart = null;
        let bodyCompositionChart = null;

        // Fun√ß√£o para obter a semana do ano
        function getWeekNumber(date) {
            const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
            const dayNum = d.getUTCDay() || 7;
            d.setUTCDate(d.getUTCDate() + 4 - dayNum);
            const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
            return Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
        }

        // Fun√ß√£o para obter a chave da semana atual
        function getCurrentWeekKey() {
            const now = new Date();
            const year = now.getFullYear();
            const week = getWeekNumber(now);
            return `${year}-W${String(week).padStart(2, '0')}`;
        }

        // Atualizar data no header
        function updateCurrentDate() {
            const now = new Date();
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            };
            const dateStr = now.toLocaleDateString('pt-BR', options);
            const weekNum = getWeekNumber(now);
            document.getElementById('currentDate').innerHTML = `
                <i class="fas fa-calendar-alt"></i> ${dateStr} - Semana ${weekNum} de 2026
            `;
        }

        // Fun√ß√£o para inicializar com dados padr√£o do usu√°rio
        function initializeDefaultHabits() {
            const defaultHabits = [
                {
                    id: Date.now() + 1,
                    name: 'Leitura (10 p√°ginas/dia)',
                    goal: 5,  // 5x por semana
                    duration: 30,
                    category: 'Educa√ß√£o',
                    counts: {},
                    history: []
                },
                {
                    id: Date.now() + 2,
                    name: 'Ingl√™s',
                    goal: 5,  // 5x por semana
                    duration: 50,
                    category: 'Educa√ß√£o',
                    counts: {},
                    history: []
                },
                {
                    id: Date.now() + 3,
                    name: 'Exerc√≠cios F√≠sicos',
                    goal: 5,  // 5x por semana
                    duration: 50,
                    category: 'Sa√∫de',
                    counts: {},
                    history: []
                },
                {
                    id: Date.now() + 4,
                    name: 'Curso PPCI (Engenharia)',
                    goal: 3,  // 3x por semana
                    duration: 50,
                    category: 'Produtividade',
                    counts: {},
                    history: []
                },
                {
                    id: Date.now() + 5,
                    name: 'Curso Reservat√≥rio Dopamina',
                    goal: 2,  // 2x por semana
                    duration: 50,
                    category: 'Bem-estar',
                    counts: {},
                    history: []
                }
            ];

            return defaultHabits;
        }

        // ==================== FUN√á√ïES JEJUM DE A√á√öCAR ====================
        
        // Iniciar jejum de a√ß√∫car
        function startSugarFast() {
            // Garantir que sugarFast existe
            if (!appData.sugarFast) {
                appData.sugarFast = {
                    active: false,
                    startDate: null,
                    currentDays: 0,
                    bestStreak: 0,
                    totalAttempts: 0,
                    breaks: []
                };
            }

            appData.sugarFast.active = true;
            appData.sugarFast.startDate = new Date().toISOString();
            appData.sugarFast.currentDays = 0;
            appData.sugarFast.totalAttempts = (appData.sugarFast.totalAttempts || 0) + 1;
            
            saveData();
            updateSugarFastDisplay();
            
            alert('üç≠ Jejum de A√ß√∫car iniciado! Boa sorte nos pr√≥ximos 40 dias! üí™');
        }

        // Quebrar jejum
        function breakSugarFast() {
            if (!confirm('üòî Tem certeza que quebrou o jejum? Isso vai reiniciar sua contagem, mas seus dados ser√£o salvos.')) return;
            
            // Garantir que sugarFast existe
            if (!appData.sugarFast) {
                appData.sugarFast = {
                    active: false,
                    startDate: null,
                    currentDays: 0,
                    bestStreak: 0,
                    totalAttempts: 0,
                    breaks: [],
                    completed40Days: 0,
                    failed40Days: 0,
                    totalDaysFasted: 0
                };
            }

            const currentDays = calculateSugarFastDays();
            
            // Verificar se completou 40 dias
            if (currentDays >= 40) {
                appData.sugarFast.completed40Days = (appData.sugarFast.completed40Days || 0) + 1;
                alert(`üèÜ PARAB√âNS! Voc√™ COMPLETOU um ciclo de 40 dias sem a√ß√∫car! Total completado em 2026: ${appData.sugarFast.completed40Days}! Seu corpo agradece! üí™`);
            } else {
                appData.sugarFast.failed40Days = (appData.sugarFast.failed40Days || 0) + 1;
            }

            // Adicionar ao total de dias em jejum
            appData.sugarFast.totalDaysFasted = (appData.sugarFast.totalDaysFasted || 0) + currentDays;
            
            const breakRecord = {
                date: new Date().toISOString(),
                daysAchieved: currentDays,
                startDate: appData.sugarFast.startDate,
                completed: currentDays >= 40
            };
            
            if (!appData.sugarFast.breaks) {
                appData.sugarFast.breaks = [];
            }
            appData.sugarFast.breaks.push(breakRecord);
            
            // Atualizar melhor sequ√™ncia
            if (currentDays > (appData.sugarFast.bestStreak || 0)) {
                appData.sugarFast.bestStreak = currentDays;
            }
            
            appData.sugarFast.active = false;
            appData.sugarFast.currentDays = 0;
            appData.sugarFast.startDate = null;
            
            saveData();
            updateSugarFastDisplay();
            updateSugarFastYearlyStats();
            
            if (currentDays < 40) {
                alert(`Jejum quebrado ap√≥s ${currentDays} dia(s). ${currentDays > 0 ? 'Parab√©ns pelo esfor√ßo! ' : ''}Voc√™ pode tentar novamente quando quiser! üí™`);
            }
        }

        // Resetar jejum
        function resetSugarFast() {
            if (!confirm('üîÑ Resetar o jejum? Isso vai zerar o contador atual, mas manter√° seu hist√≥rico de melhor sequ√™ncia.')) return;
            
            // Garantir que sugarFast existe
            if (!appData.sugarFast) {
                appData.sugarFast = {
                    active: false,
                    startDate: null,
                    currentDays: 0,
                    bestStreak: 0,
                    totalAttempts: 0,
                    breaks: []
                };
            }

            appData.sugarFast.active = false;
            appData.sugarFast.startDate = null;
            appData.sugarFast.currentDays = 0;
            // Mant√©m bestStreak, totalAttempts e breaks
            
            saveData();
            updateSugarFastDisplay();
            
            alert('‚úÖ Jejum resetado! Voc√™ pode come√ßar de novo quando quiser.');
        }

        // Calcular dias do jejum
        function calculateSugarFastDays() {
            if (!appData.sugarFast || !appData.sugarFast.active || !appData.sugarFast.startDate) {
                return 0;
            }
            
            const start = new Date(appData.sugarFast.startDate);
            const now = new Date();
            const diffTime = Math.abs(now - start);
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            
            return diffDays;
        }

        // Atualizar display do jejum
        function updateSugarFastDisplay() {
            // Garantir que sugarFast existe
            if (!appData.sugarFast) {
                appData.sugarFast = {
                    active: false,
                    startDate: null,
                    currentDays: 0,
                    bestStreak: 0,
                    totalAttempts: 0,
                    breaks: []
                };
            }

            const days = calculateSugarFastDays();
            appData.sugarFast.currentDays = days;
            
            // Atualizar contador principal
            const daysElement = document.getElementById('sugarFastDays');
            if (daysElement) daysElement.textContent = days;
            
            // Atualizar percentual
            const percentage = Math.min(100, Math.round((days / 40) * 100));
            const percentageElement = document.getElementById('sugarFastPercentage');
            if (percentageElement) percentageElement.textContent = percentage + '%';
            
            // Atualizar barra de progresso
            const progressBar = document.getElementById('sugarFastProgressBar');
            if (progressBar) {
                progressBar.style.width = percentage + '%';
                progressBar.textContent = percentage >= 10 ? percentage + '%' : '';
            }

            // Atualizar estat√≠sticas
            const bestStreakEl = document.getElementById('bestStreakDisplay');
            if (bestStreakEl) bestStreakEl.textContent = appData.sugarFast.bestStreak || 0;

            const attemptsEl = document.getElementById('totalAttemptsDisplay');
            if (attemptsEl) attemptsEl.textContent = appData.sugarFast.totalAttempts || 0;

            const breaksEl = document.getElementById('breaksDisplay');
            if (breaksEl) breaksEl.textContent = (appData.sugarFast.breaks || []).length;
            
            // Atualizar display
            renderSugarMilestones(days);
            renderSugarFastMiniChart();
            updateSugarFastYearlyStats();
            
            // Atualizar bot√µes CORRIGIDO
            const startBtn = document.getElementById('startFastBtn');
            const activeButtonsContainer = document.getElementById('activeButtonsContainer');
            
            if (appData.sugarFast.active) {
                if (startBtn) startBtn.style.display = 'none';
                if (activeButtonsContainer) activeButtonsContainer.style.display = 'flex';
            } else {
                if (startBtn) startBtn.style.display = 'block';
                if (activeButtonsContainer) activeButtonsContainer.style.display = 'none';
            }
        }

        // Renderizar mini gr√°fico do jejum
        let sugarFastMiniChart = null;

        function renderSugarFastMiniChart() {
            const ctx = document.getElementById('sugarFastMiniChart');
            if (!ctx) return;

            if (sugarFastMiniChart) {
                sugarFastMiniChart.destroy();
            }

            const currentDays = calculateSugarFastDays();
            const remaining = Math.max(0, 40 - currentDays);

            // Atualizar displays
            const miniChartDaysEl = document.getElementById('miniChartDays');
            const miniChartRemainingEl = document.getElementById('miniChartRemaining');
            if (miniChartDaysEl) miniChartDaysEl.textContent = currentDays;
            if (miniChartRemainingEl) miniChartRemainingEl.textContent = remaining;

            sugarFastMiniChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Progresso', 'Restante'],
                    datasets: [{
                        data: [currentDays, remaining],
                        backgroundColor: [
                            'rgba(16, 185, 129, 0.8)',
                            'rgba(148, 163, 184, 0.3)'
                        ],
                        borderColor: [
                            'rgba(16, 185, 129, 1)',
                            'rgba(148, 163, 184, 0.5)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.parsed;
                                    const percentage = ((value / 40) * 100).toFixed(1);
                                    return `${label}: ${value} dias (${percentage}%)`;
                                }
                            }
                        }
                    }
                },
                plugins: [{
                    id: 'centerText',
                    beforeDraw: function(chart) {
                        const width = chart.width;
                        const height = chart.height;
                        const ctx = chart.ctx;
                        ctx.restore();

                        const fontSize = (height / 80).toFixed(2);
                        ctx.font = `bold ${fontSize}em sans-serif`;
                        ctx.textBaseline = 'middle';

                        const text = `${currentDays}/40`;
                        const textX = Math.round((width - ctx.measureText(text).width) / 2);
                        const textY = height / 2;

                        ctx.fillStyle = '#10b981';
                        ctx.fillText(text, textX, textY);
                        ctx.save();
                    }
                }]
            });
        }

        // Atualizar estat√≠sticas anuais do jejum
        function updateSugarFastYearlyStats() {
            if (!appData.sugarFast) return;

            const completed = appData.sugarFast.completed40Days || 0;
            const failed = appData.sugarFast.failed40Days || 0;
            const total = completed + failed;
            const successRate = total > 0 ? ((completed / total) * 100).toFixed(1) : 0;
            const totalDays = appData.sugarFast.totalDaysFasted || 0;

            document.getElementById('jejumsCompleted').textContent = completed;
            document.getElementById('jejumsFailed').textContent = failed;
            document.getElementById('successRate').textContent = successRate + '%';
            document.getElementById('totalDaysFasted').textContent = totalDays;
        }

        // Renderizar marcos do desafio
        function renderSugarMilestones(currentDays) {
            // Atualizar marcos visuais principais (7, 21, 40)
            const milestones = [
                { id: 'milestone7', day: 7 },
                { id: 'milestone21', day: 21 },
                { id: 'milestone40', day: 40 }
            ];

            milestones.forEach((milestone, index) => {
                const element = document.getElementById(milestone.id);
                if (!element) return;

                const achieved = currentDays >= milestone.day;
                const isNext = !achieved && (currentDays < milestone.day) && 
                               (index === 0 || currentDays >= milestones[index - 1].day);

                if (achieved) {
                    element.style.background = 'linear-gradient(135deg, rgba(16, 185, 129, 0.3), rgba(16, 185, 129, 0.2))';
                    element.style.border = '2px solid var(--secondary)';
                    element.style.boxShadow = '0 0 20px rgba(16, 185, 129, 0.4)';
                    element.style.transform = 'scale(1.02)';
                } else if (isNext) {
                    element.style.background = 'linear-gradient(135deg, rgba(245, 158, 11, 0.25), rgba(245, 158, 11, 0.15))';
                    element.style.border = '2px solid var(--warning)';
                    element.style.boxShadow = '0 0 25px rgba(245, 158, 11, 0.5)';
                    element.style.transform = 'scale(1.05)';
                } else {
                    element.style.background = 'rgba(255,255,255,0.05)';
                    element.style.border = '2px solid transparent';
                    element.style.boxShadow = 'none';
                    element.style.transform = 'scale(1)';
                }
            });
        }

        // ==================== FUN√á√ïES AN√ÅLISE FINANCEIRA ====================
        
        function analyzeFinances() {
            const salary = parseFloat(document.getElementById('userSalary').value);
            const age = parseInt(document.getElementById('userAge').value);

            if (!salary || salary <= 0) {
                alert('Por favor, insira sua renda mensal!');
                return;
            }

            if (!age || age < 14 || age > 100) {
                alert('Por favor, insira uma idade v√°lida (14-100 anos)!');
                return;
            }

            // Mostrar resultados
            document.getElementById('financeResults').style.display = 'block';

            // Atualizar displays
            document.getElementById('yourSalaryDisplay').textContent = `R$ ${salary.toLocaleString('pt-BR')}`;
            document.getElementById('yourAgeDisplay').textContent = `Idade: ${age} anos`;

            // Renderizar an√°lises
            renderFinanceComparison(salary);
            renderAgeAnalysis(salary, age);
            renderSalaryPyramid(salary);
            renderFinancialRecommendations(salary, age);

            // Scroll suave at√© resultados
            document.getElementById('financeResults').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function renderFinanceComparison(userSalary) {
            const ctx = document.getElementById('financeComparisonChart');
            if (!ctx) return;

            if (financeComparisonChart) {
                financeComparisonChart.destroy();
            }

            const brazilAvg = financeData.brazil.average;
            const worldAvg = financeData.world.average;

            financeComparisonChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Voc√™', 'M√©dia Brasil', 'M√©dia Mundial'],
                    datasets: [{
                        label: 'Renda Mensal (R$)',
                        data: [userSalary, brazilAvg, worldAvg],
                        backgroundColor: [
                            'rgba(99, 102, 241, 0.8)',
                            'rgba(16, 185, 129, 0.8)',
                            'rgba(245, 158, 11, 0.8)'
                        ],
                        borderColor: [
                            'rgba(99, 102, 241, 1)',
                            'rgba(16, 185, 129, 1)',
                            'rgba(245, 158, 11, 1)'
                        ],
                        borderWidth: 2,
                        borderRadius: 10
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#94a3b8',
                                callback: function(value) {
                                    return 'R$ ' + value.toLocaleString('pt-BR');
                                }
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: '#94a3b8',
                                font: {
                                    size: 12,
                                    weight: 'bold'
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return 'R$ ' + context.parsed.y.toLocaleString('pt-BR');
                                }
                            }
                        }
                    }
                }
            });
        }

        function renderAgeAnalysis(userSalary, userAge) {
            const container = document.getElementById('ageAnalysis');
            
            let ageGroup = '';
            let expectedSalary = 0;
            
            if (userAge >= 14 && userAge <= 17) {
                ageGroup = '14-17 anos';
                expectedSalary = financeData.brazil.byAge['14-17'];
            } else if (userAge >= 18 && userAge <= 24) {
                ageGroup = '18-24 anos';
                expectedSalary = financeData.brazil.byAge['18-24'];
            } else if (userAge >= 25 && userAge <= 39) {
                ageGroup = '25-39 anos';
                expectedSalary = financeData.brazil.byAge['25-39'];
            } else if (userAge >= 40 && userAge <= 59) {
                ageGroup = '40-59 anos';
                expectedSalary = financeData.brazil.byAge['40-59'];
            } else {
                ageGroup = '60+ anos';
                expectedSalary = financeData.brazil.byAge['60+'];
            }

            const difference = userSalary - expectedSalary;
            const percentDiff = ((difference / expectedSalary) * 100).toFixed(1);
            const isAbove = difference > 0;

            container.innerHTML = `
                <div style="text-align: center; padding: 25px; background: rgba(0,0,0,0.2); border-radius: 12px;">
                    <div style="font-size: 0.9rem; color: var(--gray); margin-bottom: 10px;">
                        Sua Faixa Et√°ria: <strong style="color: var(--accent);">${ageGroup}</strong>
                    </div>
                    <div style="font-size: 0.85rem; color: var(--gray); margin-bottom: 15px;">
                        M√©dia esperada: <strong>R$ ${expectedSalary.toLocaleString('pt-BR')}</strong>
                    </div>
                    <div style="font-size: 2.5rem; font-weight: 900; color: ${isAbove ? 'var(--secondary)' : 'var(--danger)'}; margin-bottom: 10px;">
                        ${isAbove ? '+' : ''}${percentDiff}%
                    </div>
                    <div style="font-size: 1rem; font-weight: 600; color: ${isAbove ? 'var(--secondary)' : 'var(--danger)'};">
                        ${isAbove 
                            ? `üéâ Voc√™ ganha R$ ${Math.abs(difference).toLocaleString('pt-BR')} ACIMA da m√©dia da sua idade!` 
                            : `üìä Voc√™ ganha R$ ${Math.abs(difference).toLocaleString('pt-BR')} abaixo da m√©dia da sua idade`
                        }
                    </div>
                    ${isAbove ? `
                        <div style="margin-top: 15px; padding: 12px; background: rgba(16, 185, 129, 0.1); border-radius: 8px; border: 1px solid rgba(16, 185, 129, 0.3);">
                            <div style="font-size: 0.85rem; color: var(--secondary); font-weight: 600;">
                                ‚úÖ Parab√©ns! Voc√™ est√° ACIMA da m√©dia brasileira para sua faixa et√°ria!
                            </div>
                        </div>
                    ` : `
                        <div style="margin-top: 15px; padding: 12px; background: rgba(14, 165, 233, 0.1); border-radius: 8px; border: 1px solid rgba(14, 165, 233, 0.3);">
                            <div style="font-size: 0.85rem; color: var(--info); font-weight: 600;">
                                üí° H√° oportunidades para crescimento salarial!
                            </div>
                        </div>
                    `}
                </div>
            `;
        }

        function renderSalaryPyramid(userSalary) {
            const container = document.getElementById('salaryPyramid');
            
            const minWage = 1412; // Sal√°rio m√≠nimo 2025
            let position = '';
            let percentile = '';
            let color = '';

            if (userSalary <= minWage) {
                position = 'Base da Pir√¢mide';
                percentile = 'Grupo dos 35,63% (at√© 1 sal√°rio m√≠nimo)';
                color = 'var(--danger)';
            } else if (userSalary <= minWage * 2) {
                position = 'Baixa Renda';
                percentile = 'Grupo dos 31,56% (1-2 sal√°rios m√≠nimos)';
                color = 'var(--warning)';
            } else if (userSalary <= minWage * 5) {
                position = 'Classe M√©dia Baixa';
                percentile = 'Grupo dos 32,81% (acima de 2 sal√°rios)';
                color = 'var(--info)';
            } else if (userSalary <= minWage * 10) {
                position = 'Classe M√©dia';
                percentile = 'TOP 20% dos brasileiros';
                color = 'var(--primary)';
            } else if (userSalary <= 20000) {
                position = 'Classe M√©dia Alta';
                percentile = 'TOP 10% dos brasileiros';
                color = 'var(--accent)';
            } else {
                position = 'Alta Renda';
                percentile = 'TOP 1% dos brasileiros (R$ 20.664+)';
                color = 'var(--secondary)';
            }

            const pyramidLevels = [
                { label: 'TOP 1%', min: 20664, icon: 'üëë', perc: '1%' },
                { label: 'TOP 10%', min: 10000, icon: 'üèÜ', perc: '10%' },
                { label: 'Classe M√©dia', min: minWage * 5, icon: 'üìä', perc: '20%' },
                { label: '2+ Sal√°rios', min: minWage * 2, icon: 'üíº', perc: '32,81%' },
                { label: '1-2 Sal√°rios', min: minWage, icon: 'üìà', perc: '31,56%' },
                { label: 'At√© 1 Sal√°rio', min: 0, icon: 'üìâ', perc: '35,63%' }
            ];

            container.innerHTML = `
                <div style="display: flex; flex-direction: column; gap: 12px;">
                    ${pyramidLevels.map((level, index) => {
                        const isUserLevel = userSalary >= level.min && 
                            (index === 0 || userSalary < pyramidLevels[index - 1].min);
                        const width = 100 - (index * 15);
                        
                        return `
                            <div style="
                                display: flex;
                                align-items: center;
                                gap: 15px;
                                padding: 15px;
                                background: ${isUserLevel ? `linear-gradient(135deg, ${color}33, ${color}22)` : 'rgba(0,0,0,0.2)'};
                                border-radius: 10px;
                                border: 2px solid ${isUserLevel ? color : 'rgba(255,255,255,0.1)'};
                                transition: all 0.3s ease;
                                ${isUserLevel ? 'box-shadow: 0 0 20px ' + color + '44;' : ''}
                            ">
                                <div style="font-size: 2rem; min-width: 50px; text-align: center;">
                                    ${level.icon}
                                </div>
                                <div style="flex: 1;">
                                    <div style="font-weight: 700; font-size: 1rem; color: ${isUserLevel ? color : 'var(--light)'}; margin-bottom: 3px;">
                                        ${level.label}
                                        ${isUserLevel ? '<span style="margin-left: 10px; background: ' + color + '; color: white; padding: 3px 10px; border-radius: 12px; font-size: 0.75rem;">VOC√ä EST√Å AQUI</span>' : ''}
                                    </div>
                                    <div style="font-size: 0.8rem; color: var(--gray);">
                                        ${level.min > 0 ? 'Acima de R$ ' + level.min.toLocaleString('pt-BR') : 'At√© R$ ' + minWage.toLocaleString('pt-BR')} ‚Ä¢ ${level.perc} da popula√ß√£o
                                    </div>
                                </div>
                                <div style="width: ${width}%; height: 8px; background: ${isUserLevel ? color : 'rgba(255,255,255,0.2)'}; border-radius: 10px;"></div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        // ==================== FUN√á√ïES ACOMPANHAMENTO CORPORAL ====================
        
        function addBodyMeasurement() {
            const dateInput = document.getElementById('measurementDate').value;
            const weight = parseFloat(document.getElementById('bodyWeight').value);
            const bf = parseFloat(document.getElementById('bodyFatPercent').value);
            const muscle = parseFloat(document.getElementById('muscleMass').value);

            if (!dateInput) {
                alert('Por favor, selecione a data da medi√ß√£o!');
                return;
            }

            if (!weight || weight <= 0) {
                alert('Por favor, insira seu peso!');
                return;
            }

            if (!bf || bf < 3 || bf > 50) {
                alert('Por favor, insira um percentual de gordura v√°lido (3-50%)!');
                return;
            }

            if (!muscle || muscle <= 0) {
                alert('Por favor, insira sua massa magra!');
                return;
            }

            const selectedDate = new Date(dateInput + 'T12:00:00'); // Meio-dia para evitar problemas de timezone
            
            const measurement = {
                date: selectedDate.toISOString(),
                displayDate: selectedDate.toLocaleDateString('pt-BR'),
                weekKey: getCurrentWeekKey(),
                weight: weight,
                bodyFat: bf,
                muscleMass: muscle,
                fatMass: (weight * bf) / 100,
                imc: weight / (bodyData.userProfile.height ** 2)
            };

            bodyData.measurements.push(measurement);
            
            // Ordenar por data
            bodyData.measurements.sort((a, b) => new Date(a.date) - new Date(b.date));
            
            localStorage.setItem('bodyMeasurements', JSON.stringify(bodyData.measurements));

            // Limpar formul√°rio
            document.getElementById('measurementDate').value = '';
            document.getElementById('bodyWeight').value = '';
            document.getElementById('bodyFatPercent').value = '';
            document.getElementById('muscleMass').value = '';

            // Atualizar dashboard
            updateBodyDashboard();

            alert('‚úÖ Medi√ß√£o registrada com sucesso!');
        }

        function updateBodyDashboard() {
            if (bodyData.measurements.length === 0) {
                document.getElementById('bodyMetricsDashboard').style.display = 'none';
                return;
            }

            document.getElementById('bodyMetricsDashboard').style.display = 'block';

            const latest = bodyData.measurements[bodyData.measurements.length - 1];
            const previous = bodyData.measurements.length > 1 ? bodyData.measurements[bodyData.measurements.length - 2] : null;

            // Atualizar cards
            document.getElementById('currentWeight').textContent = latest.weight.toFixed(1) + ' kg';
            document.getElementById('currentBF').textContent = latest.bodyFat.toFixed(1) + '%';
            document.getElementById('currentMuscle').textContent = latest.muscleMass.toFixed(1) + ' kg';
            document.getElementById('currentIMC').textContent = latest.imc.toFixed(1);

            // Calcular mudan√ßas
            if (previous) {
                const weightDiff = latest.weight - previous.weight;
                const bfDiff = latest.bodyFat - previous.bodyFat;
                const muscleDiff = latest.muscleMass - previous.muscleMass;

                document.getElementById('weightChange').innerHTML = weightDiff >= 0 
                    ? `<span style="color: var(--danger);">+${weightDiff.toFixed(1)} kg ‚Üë</span>`
                    : `<span style="color: var(--secondary);">${weightDiff.toFixed(1)} kg ‚Üì</span>`;

                document.getElementById('bfChange').innerHTML = bfDiff >= 0 
                    ? `<span style="color: var(--danger);">+${bfDiff.toFixed(1)}% ‚Üë</span>`
                    : `<span style="color: var(--secondary);">${bfDiff.toFixed(1)}% ‚Üì</span>`;

                document.getElementById('muscleChange').innerHTML = muscleDiff >= 0 
                    ? `<span style="color: var(--secondary);">+${muscleDiff.toFixed(1)} kg ‚Üë</span>`
                    : `<span style="color: var(--danger);">${muscleDiff.toFixed(1)} kg ‚Üì</span>`;
            }

            // Classifica√ß√£o IMC
            let imcClass = '';
            if (latest.imc < 18.5) imcClass = 'Abaixo do peso';
            else if (latest.imc < 25) imcClass = 'Normal';
            else if (latest.imc < 30) imcClass = 'Sobrepeso';
            else imcClass = 'Obesidade';
            document.getElementById('imcClassification').textContent = imcClass;

            // Renderizar gr√°ficos
            renderWeightEvolutionChart();
            renderBFEvolutionChart();
            renderBodyCompositionChart();
            renderBodyAnalysis(latest);
        }

        function renderWeightEvolutionChart() {
            const ctx = document.getElementById('weightEvolutionChart');
            if (!ctx) return;

            if (weightEvolutionChart) {
                weightEvolutionChart.destroy();
            }

            const labels = bodyData.measurements.map(m => m.displayDate || new Date(m.date).toLocaleDateString('pt-BR'));
            const weights = bodyData.measurements.map(m => m.weight);

            weightEvolutionChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Peso (kg)',
                        data: weights,
                        borderColor: 'rgba(99, 102, 241, 1)',
                        backgroundColor: 'rgba(99, 102, 241, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: 'rgba(99, 102, 241, 1)',
                        pointRadius: 5,
                        pointHoverRadius: 7
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: false,
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            ticks: {
                                color: '#94a3b8',
                                callback: function(value) {
                                    return value + ' kg';
                                }
                            }
                        },
                        x: {
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            ticks: { 
                                color: '#94a3b8',
                                maxRotation: 45,
                                minRotation: 45
                            }
                        }
                    },
                    plugins: {
                        legend: { display: false }
                    }
                }
            });
        }

        function renderBFEvolutionChart() {
            const ctx = document.getElementById('bfEvolutionChart');
            if (!ctx) return;

            if (bfEvolutionChart) {
                bfEvolutionChart.destroy();
            }

            const labels = bodyData.measurements.map(m => m.displayDate || new Date(m.date).toLocaleDateString('pt-BR'));
            const bfData = bodyData.measurements.map(m => m.bodyFat);
            const goal = bodyData.measurements.map(() => bodyData.userProfile.goalBF);

            bfEvolutionChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Gordura (%)',
                            data: bfData,
                            borderColor: 'rgba(245, 158, 11, 1)',
                            backgroundColor: 'rgba(245, 158, 11, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: 'rgba(245, 158, 11, 1)',
                            pointRadius: 5
                        },
                        {
                            label: 'Meta (12%)',
                            data: goal,
                            borderColor: 'rgba(16, 185, 129, 1)',
                            borderWidth: 2,
                            borderDash: [5, 5],
                            fill: false,
                            pointRadius: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: false,
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            ticks: {
                                color: '#94a3b8',
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        },
                        x: {
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            ticks: { 
                                color: '#94a3b8',
                                maxRotation: 45,
                                minRotation: 45
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                color: '#94a3b8',
                                padding: 10,
                                font: { size: 11 }
                            }
                        }
                    }
                }
            });
        }

        function renderBodyCompositionChart() {
            const ctx = document.getElementById('bodyCompositionChart');
            if (!ctx) return;

            if (bodyCompositionChart) {
                bodyCompositionChart.destroy();
            }

            const labels = bodyData.measurements.map(m => m.displayDate || new Date(m.date).toLocaleDateString('pt-BR'));
            const muscleData = bodyData.measurements.map(m => m.muscleMass);
            const fatData = bodyData.measurements.map(m => m.fatMass);

            bodyCompositionChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Massa Magra (kg)',
                            data: muscleData,
                            backgroundColor: 'rgba(16, 185, 129, 0.8)',
                            borderColor: 'rgba(16, 185, 129, 1)',
                            borderWidth: 2
                        },
                        {
                            label: 'Massa Gorda (kg)',
                            data: fatData,
                            backgroundColor: 'rgba(239, 68, 68, 0.8)',
                            borderColor: 'rgba(239, 68, 68, 1)',
                            borderWidth: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            stacked: true,
                            beginAtZero: true,
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            ticks: {
                                color: '#94a3b8',
                                callback: function(value) {
                                    return value + ' kg';
                                }
                            }
                        },
                        x: {
                            stacked: true,
                            grid: { display: false },
                            ticks: { 
                                color: '#94a3b8',
                                maxRotation: 45,
                                minRotation: 45
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                color: '#94a3b8',
                                padding: 15
                            }
                        }
                    }
                }
            });
        }

        function renderBodyAnalysis(latest) {
            const container = document.getElementById('bodyAnalysis');
            const analysis = [];

            const bf = latest.bodyFat;
            const age = bodyData.userProfile.age;
            const goal = bodyData.userProfile.goalBF;

            // Verificar se h√° jejum ativo
            const isFasting = appData.sugarFast && appData.sugarFast.active;
            const fastingDays = isFasting ? calculateSugarFastDays() : 0;

            // An√°lise 1: Classifica√ß√£o BF
            let bfClass = '';
            let bfType = '';
            if (bf < 6) {
                bfClass = 'Gordura Essencial';
                bfType = 'danger';
            } else if (bf < 14) {
                bfClass = 'Atleta';
                bfType = 'success';
            } else if (bf < 18) {
                bfClass = 'Fitness / Excelente';
                bfType = 'success';
            } else if (bf < 25) {
                bfClass = 'M√©dia Saud√°vel';
                bfType = 'info';
            } else {
                bfClass = 'Acima da M√©dia';
                bfType = 'warning';
            }

            analysis.push({
                type: bfType,
                icon: 'fa-chart-pie',
                title: `Classifica√ß√£o: ${bfClass}`,
                text: `Com ${bf.toFixed(1)}% de gordura corporal, voc√™ est√° na categoria "${bfClass}". Para homens de 25-34 anos, o intervalo saud√°vel √© 15,3-21,8% (Bioimped√¢ncia 2024). ${bf < 14 ? 'Parab√©ns! N√≠vel de atleta!' : bf < 18 ? 'Excelente condicionamento!' : bf < 25 ? 'Dentro do saud√°vel!' : 'H√° espa√ßo para melhoria!'}`
            });

            // An√°lise 2: Abd√¥men Definido - DADOS CIENT√çFICOS
            if (bf <= 12) {
                analysis.push({
                    type: 'success',
                    icon: 'fa-award',
                    title: 'üèÜ ABD√îMEN DEFINIDO CONQUISTADO!',
                    text: `Com ${bf.toFixed(1)}% BF, seu abd√¥men est√° VIS√çVEL! Estudos mostram: abs aparecem <12% (ACE 2024). Voc√™ atingiu o "six-pack zone"! Mantenha treino abdominal 3x/semana para defini√ß√£o m√°xima. Parab√©ns pela dedica√ß√£o! üí™`
                });
            } else if (bf <= 15) {
                analysis.push({
                    type: 'success',
                    icon: 'fa-bullseye',
                    title: 'üéØ QUASE L√Å! Abs aparecendo',
                    text: `${bf.toFixed(1)}% BF = abs come√ßam a aparecer! Faltam ${(bf - 12).toFixed(1)}% para defini√ß√£o completa. Journal of Sports Sciences 2023: d√©ficit 500kcal/dia + treino = -1% BF/m√™s. Em ${Math.ceil(bf - 12)} meses voc√™ ter√° six-pack!`
                });
            } else {
                const monthsToAbs = Math.ceil((bf - 12) * 1.5);
                analysis.push({
                    type: 'info',
                    icon: 'fa-dumbbell',
                    title: `Caminho para Abd√¥men Definido: ${monthsToAbs} meses`,
                    text: `Voc√™ est√° a ${(bf - 12).toFixed(1)}% do six-pack (12% BF). Combinando: d√©ficit cal√≥rico 500kcal/dia + treino resistido + cardio HIIT 3x/semana = -0,5-1% BF/m√™s. Estimativa: ${monthsToAbs} meses para abs vis√≠veis! Meta realista e cientificamente comprovada.`
                });
            }

            // An√°lise 3: CONEX√ÉO COM JEJUM DE A√á√öCAR
            if (isFasting && fastingDays > 0) {
                const estimatedBFLoss = (fastingDays / 40) * 3; // M√©dia 2-5% em 40 dias
                const projectedBF = Math.max(bf - estimatedBFLoss, 10);
                
                analysis.push({
                    type: 'success',
                    icon: 'fa-candy-cane',
                    title: `üç≠ Jejum de A√ß√∫car ATIVO: Dia ${fastingDays}/40`,
                    text: `Parab√©ns! Estudos: 40 dias sem a√ß√∫car = -2 a 5% BF (Journal Clinical Endocrinology 2024). Voc√™ est√° no dia ${fastingDays}! Proje√ß√£o: de ${bf.toFixed(1)}% para ~${projectedBF.toFixed(1)}% BF! A√ß√∫car aumenta insulina = armazena gordura abdominal. Sem a√ß√∫car = queima gordura visceral PRIMEIRO! üî•`
                });
            } else if (appData.sugarFast && appData.sugarFast.completed40Days > 0) {
                analysis.push({
                    type: 'success',
                    icon: 'fa-trophy',
                    title: `Jejuns Completados: ${appData.sugarFast.completed40Days} ciclos`,
                    text: `Voc√™ j√° completou ${appData.sugarFast.completed40Days} ciclo(s) de 40 dias! Isso equivale a ${appData.sugarFast.completed40Days * 40} dias sem a√ß√∫car! Harvard Medical: cada ciclo reduz gordura visceral 15-25%. Gordura visceral = principal obst√°culo para abs vis√≠veis. Continue! üí™`
                });
            } else {
                analysis.push({
                    type: 'info',
                    icon: 'fa-lightbulb',
                    title: 'Dica para Acelerar: Jejum de A√ß√∫car',
                    text: `Quer abs mais r√°pido? Estudos provam: 40 dias sem a√ß√∫car reduz 2-5% BF, principalmente na regi√£o ABDOMINAL! A√ß√∫car = +insulina = gordura visceral. Sem a√ß√∫car = -insulina = queima de gordura. Combine com seu treino atual! üéØ`
                });
            }

            // An√°lise 4: Dist√¢ncia da meta com plano de a√ß√£o
            const distanceToGoal = bf - goal;
            if (Math.abs(distanceToGoal) <= 1) {
                analysis.push({
                    type: 'success',
                    icon: 'fa-bullseye',
                    title: 'üéØ META ALCAN√áADA!',
                    text: `Voc√™ est√° a apenas ${Math.abs(distanceToGoal).toFixed(1)}% da sua meta de ${goal}%! Parab√©ns! Mantenha sua rotina de treinos e alimenta√ß√£o. Com 12% BF, voc√™ estar√° no n√≠vel FITNESS/ATLETA segundo ACE (American Council on Exercise).`
                });
            } else if (distanceToGoal > 0) {
                const kgToLose = (latest.weight * distanceToGoal) / 100;
                const weeksNeeded = Math.ceil(kgToLose / 0.5); // 0,5kg/semana saud√°vel
                analysis.push({
                    type: 'info',
                    icon: 'fa-target',
                    title: `Plano para Meta: ${weeksNeeded} semanas`,
                    text: `Para atingir ${goal}% BF, reduza ${kgToLose.toFixed(1)}kg de gordura. Protocolo cient√≠fico: d√©ficit 500kcal/dia (n√£o mais!) = -0,5kg/semana. Treino resistido 4x/semana preserva massa magra. HIIT 3x/semana acelera perda. Tempo estimado: ${weeksNeeded} semanas (${Math.ceil(weeksNeeded/4)} meses).`
                });
            }

            // An√°lise 5: Composi√ß√£o corporal e metabolismo
            const musclePer = (latest.muscleMass / latest.weight) * 100;
            const tmb = 88.362 + (13.397 * latest.weight) + (4.799 * (bodyData.userProfile.height * 100)) - (5.677 * age); // F√≥rmula Mifflin-St Jeor
            
            analysis.push({
                type: musclePer > 45 ? 'success' : 'info',
                icon: 'fa-fire-alt',
                title: `Metabolismo Basal: ${Math.round(tmb)} kcal/dia`,
                text: `Massa magra: ${latest.muscleMass.toFixed(1)}kg (${musclePer.toFixed(1)}% do corpo). TMB calculada: ${Math.round(tmb)} kcal/dia. Cada kg de m√∫sculo queima +100 kcal/dia! ${musclePer > 45 ? 'Alto % muscular = metabolismo acelerado!' : 'Aumente massa magra para queimar mais!'} Para perder gordura: consuma ${Math.round(tmb - 500)} kcal/dia.`
            });

            // An√°lise 6: Benef√≠cios cient√≠ficos de 12% BF
            if (bf > 12) {
                analysis.push({
                    type: 'success',
                    icon: 'fa-heart',
                    title: 'Benef√≠cios Cient√≠ficos ao Atingir 12% BF',
                    text: `Com 12% BF voc√™ ter√°: ‚úì Defini√ß√£o muscular total (abs 6-pack vis√≠vel), ‚úì Testosterona 30% maior (Journal Endocrine 2023), ‚úì Risco 40% menor doen√ßas card√≠acas, ‚úì Sensibilidade insulina otimizada, ‚úì Performance atl√©tica superior, ‚úì Inflama√ß√£o reduzida 50%. Meta ideal para sa√∫de + est√©tica! üèÜ`
                });
            }

            // An√°lise 7: IMC vs BF% - Por que BF% importa mais
            analysis.push({
                type: 'info',
                icon: 'fa-balance-scale',
                title: `IMC ${latest.imc.toFixed(1)} vs BF% ${bf.toFixed(1)}% - O que importa`,
                text: `Seu IMC: ${latest.imc.toFixed(1)}. Mas IGNORE IMC! Harvard Medical 2024: "BF% √© 4x mais preciso que IMC para sa√∫de metab√≥lica". Atletas musculosos t√™m IMC "sobrepeso" mas BF% baixo = SAUD√ÅVEIS! Foque s√≥ no ${bf.toFixed(1)}% BF. Seu objetivo 12% √© perfeito para homens 28 anos! üìä`
            });

            container.innerHTML = analysis.map(item => `
                <div class="insight-item ${item.type}">
                    <div class="insight-icon">
                        <i class="fas ${item.icon}"></i>
                    </div>
                    <div class="insight-content">
                        <div class="insight-title">${item.title}</div>
                        <div class="insight-text">${item.text}</div>
                    </div>
                </div>
            `).join('');
        }

        function loadBodyMeasurements() {
            const saved = localStorage.getItem('bodyMeasurements');
            if (saved) {
                bodyData.measurements = JSON.parse(saved);
                updateBodyDashboard();
            }
            
            // Definir data padr√£o como hoje (06/02/2026)
            const dateInput = document.getElementById('measurementDate');
            if (dateInput) {
                dateInput.value = '2026-02-06'; // Formato YYYY-MM-DD
                dateInput.max = '2026-12-31'; // N√£o permitir datas futuras al√©m de 2026
            }
        }

        function renderFinancialRecommendations(userSalary, userAge) {
            const container = document.getElementById('financialRecommendations');
            const recommendations = [];

            const brazilAvg = financeData.brazil.average;
            const worldAvg = financeData.world.average;
            const diffBrazil = ((userSalary / brazilAvg - 1) * 100).toFixed(1);

            // Recomenda√ß√£o 1: Compara√ß√£o geral
            if (userSalary < brazilAvg) {
                recommendations.push({
                    type: 'warning',
                    icon: 'fa-chart-line',
                    title: 'Oportunidade de Crescimento',
                    text: `Voc√™ est√° ${Math.abs(diffBrazil)}% abaixo da m√©dia nacional (R$ ${brazilAvg.toLocaleString('pt-BR')}). Considere: qualifica√ß√£o profissional, cursos t√©cnicos ou gradua√ß√£o para aumentar seu potencial de renda.`
                });
            } else if (userSalary >= brazilAvg && userSalary < worldAvg) {
                recommendations.push({
                    type: 'info',
                    icon: 'fa-flag',
                    title: 'Acima da M√©dia Nacional!',
                    text: `Voc√™ ganha ${diffBrazil}% ACIMA da m√©dia brasileira! Est√° no caminho certo. Para alcan√ßar a m√©dia mundial (R$ ${worldAvg.toLocaleString('pt-BR')}), considere especializa√ß√£o ou trabalho remoto para empresas internacionais.`
                });
            } else {
                recommendations.push({
                    type: 'success',
                    icon: 'fa-trophy',
                    title: 'Parab√©ns! Renda de N√≠vel Mundial',
                    text: `Voc√™ est√° no TOP! Sua renda supera tanto a m√©dia brasileira quanto a mundial. Continue investindo em desenvolvimento e considere diversificar investimentos para crescimento patrimonial.`
                });
            }

            // Recomenda√ß√£o 2: Por idade
            if (userAge >= 25 && userAge <= 39 && userSalary < 5000) {
                recommendations.push({
                    type: 'info',
                    icon: 'fa-graduation-cap',
                    title: 'Idade de Ouro para Crescimento',
                    text: `Voc√™ est√° na faixa et√°ria de maior crescimento salarial (25-39 anos)! Dados IBGE mostram: profissionais com superior ganham 2,5x mais. Invista em certifica√ß√µes e MBA.`
                });
            }

            if (userAge >= 40 && userAge <= 59) {
                recommendations.push({
                    type: 'info',
                    icon: 'fa-briefcase',
                    title: 'Experi√™ncia √© Valorizada',
                    text: `Sua faixa et√°ria (40-59) tem a MAIOR renda m√©dia (R$ 3.800). Use sua experi√™ncia para posi√ß√µes de lideran√ßa ou consultoria. Considere networking e LinkedIn para oportunidades.`
                });
            }

            // Recomenda√ß√£o 3: Investimentos
            if (userSalary >= 3000) {
                recommendations.push({
                    type: 'success',
                    icon: 'fa-piggy-bank',
                    title: 'Hora de Investir',
                    text: `Com renda acima de R$ 3.000, reserve 10-20% para investimentos. Sugest√µes: Tesouro Direto, CDB, Fundos Imobili√°rios. Construa patrim√¥nio enquanto mant√©m seus h√°bitos saud√°veis!`
                });
            }

            // Recomenda√ß√£o 4: Setores em alta
            recommendations.push({
                type: 'info',
                icon: 'fa-rocket',
                title: 'Setores em Alta em 2025',
                text: `Segundo IBGE/DIEESE: Tecnologia (+12%), Sa√∫de (+8%), Constru√ß√£o (+6,9%) lideram crescimento salarial. Considere transi√ß√£o ou especializa√ß√£o nessas √°reas!`
            });

            // Recomenda√ß√£o 5: Trabalho remoto
            if (userSalary < worldAvg) {
                recommendations.push({
                    type: 'info',
                    icon: 'fa-laptop-house',
                    title: 'Trabalho Remoto Internacional',
                    text: `Profissionais remotos ganham 12% a mais (dados 2025). Plataformas: Upwork, Toptal, Remote.co. Trabalhando para o exterior em d√≥lar, voc√™ pode facilmente superar a m√©dia mundial!`
                });
            }

            container.innerHTML = recommendations.map(rec => `
                <div class="insight-item ${rec.type}">
                    <div class="insight-icon">
                        <i class="fas ${rec.icon}"></i>
                    </div>
                    <div class="insight-content">
                        <div class="insight-title">${rec.title}</div>
                        <div class="insight-text">${rec.text}</div>
                    </div>
                </div>
            `).join('');
        }

        // Inicializar aplica√ß√£o
        // ==================== MINI GR√ÅFICOS DASHBOARD ====================
        let miniWeekChart = null;
        let miniMonthChart = null;

        function renderMiniWeekChart() {
            const ctx = document.getElementById('miniWeekChart');
            if (!ctx) return;

            if (miniWeekChart) {
                miniWeekChart.destroy();
            }

            const weekDays = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'S√°b'];
            const today = new Date();
            const currentDay = today.getDay();
            
            // √öltimos 7 dias
            const data = [];
            const labels = [];
            for (let i = 6; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                labels.push(weekDays[date.getDay()]);
                
                const dateStr = date.toDateString();
                const dayCompleted = habits.filter(h => h.history && h.history[dateStr]).length;
                const completion = habits.length > 0 ? (dayCompleted / habits.length) * 100 : 0;
                data.push(completion);
            }

            miniWeekChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: data.map((v, i) => 
                            i === 6 ? 'rgba(99, 102, 241, 0.8)' : 'rgba(148, 163, 184, 0.5)'
                        ),
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { 
                            beginAtZero: true, 
                            max: 100,
                            display: false 
                        },
                        x: { 
                            grid: { display: false },
                            ticks: { color: '#94a3b8', font: { size: 10 } }
                        }
                    },
                    plugins: { legend: { display: false } }
                }
            });

            // Atualizar taxa de conclus√£o
            const weekCompletion = data.reduce((a, b) => a + b, 0) / data.length;
            document.getElementById('weekCompletionRate').textContent = Math.round(weekCompletion) + '%';
        }

        function renderCriticalHabits() {
            const container = document.getElementById('criticalHabits');
            if (!container) return;

            const today = new Date().toDateString();
            const pending = habits.filter(h => !h.history || !h.history[today]);
            
            document.getElementById('pendingToday').textContent = pending.length;

            if (pending.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: var(--secondary);">
                        <i class="fas fa-check-circle" style="font-size: 2rem; margin-bottom: 8px;"></i>
                        <div style="font-size: 0.85rem; font-weight: 600;">Tudo feito hoje! üéâ</div>
                    </div>
                `;
            } else {
                container.innerHTML = pending.slice(0, 3).map(h => `
                    <div style="display: flex; align-items: center; gap: 8px; padding: 8px; background: rgba(239, 68, 68, 0.1); border-radius: 8px; border-left: 3px solid var(--danger);">
                        <i class="fas ${h.icon}" style="color: var(--danger); font-size: 1rem;"></i>
                        <div style="flex: 1; font-size: 0.8rem; color: var(--light); font-weight: 600;">${h.name}</div>
                        <i class="fas fa-exclamation-circle" style="color: var(--warning); font-size: 0.9rem;"></i>
                    </div>
                `).join('');
            }
        }

        function renderMiniMonthChart() {
            const ctx = document.getElementById('miniMonthChart');
            if (!ctx) return;

            if (miniMonthChart) {
                miniMonthChart.destroy();
            }

            // √öltimas 4 semanas
            const data = [];
            const labels = [];
            const today = new Date();
            
            for (let i = 3; i >= 0; i--) {
                const weekDate = new Date(today);
                weekDate.setDate(weekDate.getDate() - (i * 7));
                const year = weekDate.getFullYear();
                const week = getWeekNumber(weekDate);
                const weekKey = `${year}-W${week}`;
                
                labels.push(`S${week}`);
                
                const weekData = appData.weekly[weekKey] || { completed: 0, total: 0 };
                const completion = weekData.total > 0 ? (weekData.completed / weekData.total) * 100 : 0;
                data.push(completion);
            }

            miniMonthChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        borderColor: 'rgba(16, 185, 129, 1)',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: 'rgba(16, 185, 129, 1)',
                        pointRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { 
                            beginAtZero: true,
                            max: 100,
                            display: false
                        },
                        x: {
                            grid: { display: false },
                            ticks: { color: '#94a3b8', font: { size: 10 } }
                        }
                    },
                    plugins: { legend: { display: false } }
                }
            });

            // Calcular crescimento
            if (data.length >= 2) {
                const growth = data[data.length - 1] - data[data.length - 2];
                document.getElementById('monthGrowth').textContent = (growth >= 0 ? '+' : '') + growth.toFixed(0) + '%';
                document.getElementById('monthGrowth').style.color = growth >= 0 ? 'var(--secondary)' : 'var(--danger)';
            }
        }

        function initApp() {
            console.log('Inicializando Habit Science Pro 2026...');
            updateCurrentDate();
            loadData();
            
            // Se n√£o houver h√°bitos, inicializar com os padr√£o
            if (habits.length === 0) {
                habits = initializeDefaultHabits();
                saveData();
            }
            
            updateAllStats();
            renderHabitsList();
            renderAllCharts();
            generateInsights();
            updateGlobalRanking();
            calculateTotalHours2026();
            updateSugarFastDisplay();
            loadBodyMeasurements();
            
            // Atualizar jejum de a√ß√∫car a cada minuto
            setInterval(() => {
                if (appData.sugarFast.active) {
                    updateSugarFastDisplay();
                }
            }, 60000);
            
            console.log('Aplica√ß√£o inicializada com sucesso!');
        }

        // Carregar dados do localStorage
        function loadData() {
            const savedHabits = localStorage.getItem('habitSciencePro2026');
            const savedAppData = localStorage.getItem('habitSciencePro2026Data');

            if (savedHabits) {
                habits = JSON.parse(savedHabits);
            }

            if (savedAppData) {
                appData = JSON.parse(savedAppData);
            }

            // Garantir estrutura correta do appData
            if (!appData.sugarFast) {
                appData.sugarFast = {
                    active: false,
                    startDate: null,
                    currentDays: 0,
                    bestStreak: 0,
                    totalAttempts: 0,
                    breaks: []
                };
            }

            // Garantir todas as propriedades do sugarFast
            appData.sugarFast = {
                active: appData.sugarFast.active || false,
                startDate: appData.sugarFast.startDate || null,
                currentDays: appData.sugarFast.currentDays || 0,
                bestStreak: appData.sugarFast.bestStreak || 0,
                totalAttempts: appData.sugarFast.totalAttempts || 0,
                breaks: appData.sugarFast.breaks || []
            };

            // Garantir estrutura correta dos h√°bitos
            habits = habits.map(habit => ({
                id: habit.id || Date.now() + Math.random(),
                name: habit.name || 'H√°bito sem nome',
                goal: habit.goal || 3,
                duration: habit.duration || 30,
                category: habit.category || 'Sa√∫de',
                counts: habit.counts || {},
                history: habit.history || []
            }));

            console.log('Dados carregados:', { habits, appData });
        }

        // Salvar dados
        function saveData() {
            localStorage.setItem('habitSciencePro2026', JSON.stringify(habits));
            localStorage.setItem('habitSciencePro2026Data', JSON.stringify(appData));
            console.log('Dados salvos com sucesso!');
        }

        // Calcular total de horas em 2026
        function calculateTotalHours2026() {
            let totalMinutes = 0;
            
            // Percorrer todas as semanas de 2026
            for (let week = 1; week <= 52; week++) {
                const weekKey = `2026-W${String(week).padStart(2, '0')}`;
                
                habits.forEach(habit => {
                    const count = habit.counts[weekKey] || 0;
                    totalMinutes += count * habit.duration;
                });
            }
            
            const totalHours = Math.round(totalMinutes / 60);
            appData.totalHours2026 = totalHours;
            
            // Atualizar display
            document.getElementById('totalHours2026').textContent = totalHours + 'h';
            
            const now = new Date();
            const weekNum = getWeekNumber(now);
            
            const hoursBadge = document.getElementById('hoursBadge');
            if (totalHours >= 100) {
                hoursBadge.className = 'comparison-badge positive-badge';
                hoursBadge.innerHTML = '<i class="fas fa-fire"></i> Excelente!';
            } else if (totalHours >= 50) {
                hoursBadge.className = 'comparison-badge positive-badge';
                hoursBadge.innerHTML = '<i class="fas fa-arrow-up"></i> Muito bom!';
            } else {
                hoursBadge.className = 'comparison-badge neutral-badge';
                hoursBadge.innerHTML = '<i class="fas fa-hourglass-half"></i> Continue!';
            }
            
            // Atualizar card de semanas
            document.getElementById('weeks2026Value').textContent = weekNum;
            const weeksBadge = document.getElementById('weeksBadge');
            weeksBadge.className = 'comparison-badge info-badge';
            weeksBadge.innerHTML = `<i class="fas fa-calendar"></i> Semana ${weekNum} de 52`;
        }

        // Adicionar h√°bito
        function addHabit() {
            const nameInput = document.getElementById('habitName');
            const goalInput = document.getElementById('habitGoal');
            const durationInput = document.getElementById('habitDuration');

            const name = nameInput.value.trim();
            const goal = parseInt(goalInput.value) || 3;
            const duration = parseInt(durationInput.value) || 30;

            if (!name) {
                alert('Por favor, digite um nome para o h√°bito!');
                return;
            }

            const habit = {
                id: Date.now(),
                name: name,
                goal: goal,
                duration: duration,
                category: categorizeHabit(name),
                counts: {},
                history: []
            };

            habits.push(habit);
            saveData();

            // Limpar formul√°rio
            nameInput.value = '';
            goalInput.value = '3';
            durationInput.value = '30';

            // Atualizar interface
            renderHabitsList();
            renderAllCharts();
            updateAllStats();
            generateInsights();
            updateGlobalRanking();
            calculateTotalHours2026();
        }

        // Categorizar h√°bito automaticamente
        function categorizeHabit(name) {
            const nameLower = name.toLowerCase();
            
            if (nameLower.includes('correr') || nameLower.includes('academia') || 
                nameLower.includes('exerc') || nameLower.includes('treino') ||
                nameLower.includes('f√≠sico')) {
                return 'Sa√∫de';
            }
            if (nameLower.includes('ler') || nameLower.includes('estudar') || 
                nameLower.includes('curso') || nameLower.includes('livro') ||
                nameLower.includes('ingl√™s') || nameLower.includes('leitura')) {
                return 'Educa√ß√£o';
            }
            if (nameLower.includes('meditar') || nameLower.includes('yoga') || 
                nameLower.includes('respirar') || nameLower.includes('dopamina') ||
                nameLower.includes('bem-estar')) {
                return 'Bem-estar';
            }
            if (nameLower.includes('trabalh') || nameLower.includes('projeto') || 
                nameLower.includes('c√≥digo') || nameLower.includes('ppci') ||
                nameLower.includes('engenharia')) {
                return 'Produtividade';
            }
            
            return 'Outros';
        }

        // Marcar h√°bito como conclu√≠do
        function markHabitDone(habitId) {
            const habit = habits.find(h => h.id === habitId);
            if (!habit) return;

            const weekKey = getCurrentWeekKey();
            
            if (!habit.counts[weekKey]) {
                habit.counts[weekKey] = 0;
            }

            habit.counts[weekKey]++;
            
            // Adicionar ao hist√≥rico
            habit.history.push({
                date: new Date().toISOString(),
                weekKey: weekKey
            });

            // Atualizar streak
            updateStreak();

            saveData();
            renderHabitsList();
            renderAllCharts();
            updateAllStats();
            generateInsights();
            updateGlobalRanking();
            calculateTotalHours2026();
        }

        // Deletar h√°bito
        function deleteHabit(habitId) {
            if (!confirm('Tem certeza que deseja excluir este h√°bito?')) return;

            habits = habits.filter(h => h.id !== habitId);
            saveData();
            renderHabitsList();
            renderAllCharts();
            updateAllStats();
            generateInsights();
            updateGlobalRanking();
            calculateTotalHours2026();
        }

        // Renderizar lista de h√°bitos
        function renderHabitsList() {
            const container = document.getElementById('habitsList');
            const weekKey = getCurrentWeekKey();

            if (habits.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--gray);">
                        <i class="fas fa-inbox" style="font-size: 3rem; margin-bottom: 15px; opacity: 0.5;"></i>
                        <p>Nenhum h√°bito cadastrado ainda.</p>
                        <p style="font-size: 0.9rem;">Adicione seu primeiro h√°bito acima!</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = habits.map(habit => {
                const count = habit.counts[weekKey] || 0;
                const progress = Math.min(100, (count / habit.goal) * 100);
                const isComplete = count >= habit.goal;

                return `
                    <div class="habit-item">
                        <div class="habit-info">
                            <div class="habit-name">
                                ${isComplete ? '<i class="fas fa-check-circle" style="color: var(--secondary); margin-right: 8px;"></i>' : ''}
                                ${habit.name}
                            </div>
                            <div class="habit-details">
                                <i class="fas fa-bullseye"></i> Meta: ${habit.goal}x/semana
                                <i class="fas fa-clock" style="margin-left: 15px;"></i> ${habit.duration} min
                                <i class="fas fa-tag" style="margin-left: 15px;"></i> ${habit.category}
                            </div>
                            <div class="habit-progress">
                                <div class="progress-bar-container">
                                    <div class="progress-bar" style="width: ${progress}%"></div>
                                </div>
                                <div class="progress-text">${count}/${habit.goal}</div>
                            </div>
                        </div>
                        <div class="habit-actions">
                            <button class="btn-icon btn-success" onclick="markHabitDone(${habit.id})" title="Marcar como conclu√≠do">
                                <i class="fas fa-check"></i>
                            </button>
                            <button class="btn-icon btn-danger" onclick="deleteHabit(${habit.id})" title="Excluir h√°bito">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Atualizar todas as estat√≠sticas
        function updateAllStats() {
            updateStreakStat();
            updateWeeklyScoreStat();
        }

        // Atualizar ranking global
        function updateGlobalRanking() {
            const globalRankValue = document.getElementById('globalRankValue');
            const globalRankBadge = document.getElementById('globalRankBadge');
            const yourRanking = document.getElementById('yourRanking');

            const weekKey = getCurrentWeekKey();
            let totalProgress = 0;
            let habitCount = habits.length;

            if (habitCount === 0) {
                globalRankValue.textContent = '-';
                globalRankBadge.className = 'comparison-badge neutral-badge';
                globalRankBadge.innerHTML = '<i class="fas fa-minus"></i> Adicione h√°bitos';
                yourRanking.textContent = 'Top ?%';
                return;
            }

            habits.forEach(habit => {
                const count = habit.counts[weekKey] || 0;
                const progress = Math.min(100, (count / habit.goal) * 100);
                totalProgress += progress;
            });

            const yourScore = Math.round(totalProgress / habitCount);
            
            // Calcular percentil baseado em dados reais
            let percentile;
            if (yourScore >= 90) percentile = 5;   // TOP 5% - Elite absoluta
            else if (yourScore >= 80) percentile = 10;  // TOP 10% - Excelente
            else if (yourScore >= 70) percentile = 20;  // TOP 20% - Muito bom
            else if (yourScore >= 60) percentile = 35;  // TOP 35% - Acima da m√©dia
            else if (yourScore >= 50) percentile = 50;  // TOP 50% - M√©dia
            else percentile = 75;  // Abaixo da m√©dia

            globalRankValue.textContent = `Top ${percentile}%`;
            yourRanking.textContent = `Top ${percentile}%`;

            if (percentile <= 10) {
                globalRankBadge.className = 'comparison-badge positive-badge';
                globalRankBadge.innerHTML = '<i class="fas fa-crown"></i> Elite Global!';
            } else if (percentile <= 25) {
                globalRankBadge.className = 'comparison-badge positive-badge';
                globalRankBadge.innerHTML = '<i class="fas fa-medal"></i> Acima da m√©dia!';
            } else if (percentile <= 50) {
                globalRankBadge.className = 'comparison-badge neutral-badge';
                globalRankBadge.innerHTML = '<i class="fas fa-chart-line"></i> Na m√©dia';
            } else {
                globalRankBadge.className = 'comparison-badge warning-badge';
                globalRankBadge.innerHTML = '<i class="fas fa-arrow-up"></i> Pode melhorar';
            }
        }

        // Atualizar estat√≠stica de sequ√™ncia
        function updateStreakStat() {
            const streakValue = document.getElementById('streakValue');
            const streakBadge = document.getElementById('streakBadge');

            streakValue.textContent = appData.streak;

            if (appData.streak >= 21) {
                streakBadge.className = 'comparison-badge positive-badge';
                streakBadge.innerHTML = '<i class="fas fa-trophy"></i> H√°bito formado!';
            } else if (appData.streak >= 7) {
                streakBadge.className = 'comparison-badge positive-badge';
                streakBadge.innerHTML = '<i class="fas fa-fire"></i> Uma semana!';
            } else if (appData.streak >= 3) {
                streakBadge.className = 'comparison-badge positive-badge';
                streakBadge.innerHTML = '<i class="fas fa-arrow-up"></i> Bom trabalho!';
            } else if (appData.streak > 0) {
                streakBadge.className = 'comparison-badge neutral-badge';
                streakBadge.innerHTML = '<i class="fas fa-minus"></i> Continue assim';
            } else {
                streakBadge.className = 'comparison-badge neutral-badge';
                streakBadge.innerHTML = '<i class="fas fa-minus"></i> Comece hoje!';
            }
        }

        // Atualizar estat√≠stica de score semanal
        function updateWeeklyScoreStat() {
            const weeklyScoreValue = document.getElementById('weeklyScoreValue');
            const scoreBadge = document.getElementById('scoreBadge');
            
            const weekKey = getCurrentWeekKey();
            let totalProgress = 0;
            let habitCount = habits.length;

            if (habitCount === 0) {
                weeklyScoreValue.textContent = '0%';
                scoreBadge.className = 'comparison-badge neutral-badge';
                scoreBadge.innerHTML = '<i class="fas fa-minus"></i> Sem h√°bitos';
                return;
            }

            habits.forEach(habit => {
                const count = habit.counts[weekKey] || 0;
                const progress = Math.min(100, (count / habit.goal) * 100);
                totalProgress += progress;
            });

            const avgScore = Math.round(totalProgress / habitCount);
            weeklyScoreValue.textContent = avgScore + '%';

            // Comparar com m√©dias reais
            const worldAvg = 55;
            const diff = avgScore - worldAvg;

            if (avgScore >= 90) {
                scoreBadge.className = 'comparison-badge positive-badge';
                scoreBadge.innerHTML = `<i class="fas fa-star"></i> TOP 5% Mundial!`;
            } else if (avgScore >= 80) {
                scoreBadge.className = 'comparison-badge positive-badge';
                scoreBadge.innerHTML = `<i class="fas fa-globe"></i> TOP 10% Mundial`;
            } else if (avgScore >= 60) {
                scoreBadge.className = 'comparison-badge positive-badge';
                scoreBadge.innerHTML = `<i class="fas fa-arrow-up"></i> Acima m√©dia`;
            } else if (avgScore >= 50) {
                scoreBadge.className = 'comparison-badge neutral-badge';
                scoreBadge.innerHTML = `<i class="fas fa-minus"></i> M√©dia mundial`;
            } else {
                scoreBadge.className = 'comparison-badge negative-badge';
                scoreBadge.innerHTML = `<i class="fas fa-arrow-down"></i> Abaixo m√©dia`;
            }
        }

        // Atualizar sequ√™ncia
        function updateStreak() {
            const today = new Date().toDateString();
            const yesterday = new Date(Date.now() - 86400000).toDateString();

            if (appData.lastActiveDate === today) {
                return;
            }

            if (appData.lastActiveDate === yesterday) {
                appData.streak++;
            } else if (appData.lastActiveDate === null) {
                appData.streak = 1;
            } else {
                appData.streak = 1;
            }

            appData.lastActiveDate = today;
            saveData();
        }

        // Renderizar todos os gr√°ficos
        function renderAllCharts() {
            renderGlobalComparisonChart();
            renderWeeklyProgressChart();
            renderEvolution2026Chart();
            renderCategoryComparisonChart();
            renderPerformanceRadarChart();
        }

        // Gr√°fico de compara√ß√£o global COM DADOS REAIS
        function renderGlobalComparisonChart() {
            const ctx = document.getElementById('globalComparisonChart');
            if (!ctx) return;

            if (globalComparisonChart) {
                globalComparisonChart.destroy();
            }

            const weekKey = getCurrentWeekKey();

            // Calcular dados reais do usu√°rio
            const yourData = {
                reading: 0,
                english: 0,
                exercise: 0,
                career: 0,
                wellness: 0
            };

            habits.forEach(habit => {
                const count = habit.counts[weekKey] || 0;
                const nameLower = habit.name.toLowerCase();
                
                if (nameLower.includes('leitura') || nameLower.includes('ler')) {
                    yourData.reading = count;
                } else if (nameLower.includes('ingl√™s') || nameLower.includes('english')) {
                    yourData.english = count;
                } else if (nameLower.includes('exerc') || nameLower.includes('f√≠sico')) {
                    yourData.exercise = count;
                } else if (nameLower.includes('ppci') || nameLower.includes('engenharia') || nameLower.includes('carreira')) {
                    yourData.career = count;
                } else if (nameLower.includes('dopamina') || nameLower.includes('bem-estar')) {
                    yourData.wellness = count;
                }
            });

            globalComparisonChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: [
                        'Leitura\n(10 p√°g/dia)', 
                        'Ingl√™s\n(Flu√™ncia)', 
                        'Exerc√≠cios\n(OMS)', 
                        'Carreira\n(Desenvolvimento)', 
                        'Bem-estar\n(Mental)'
                    ],
                    datasets: [
                        {
                            label: 'VOC√ä',
                            data: [
                                yourData.reading,
                                yourData.english,
                                yourData.exercise,
                                yourData.career,
                                yourData.wellness
                            ],
                            backgroundColor: 'rgba(99, 102, 241, 0.8)',
                            borderColor: 'rgba(99, 102, 241, 1)',
                            borderWidth: 2,
                            borderRadius: 8
                        },
                        {
                            label: 'üáßüá∑ M√âDIA BRASIL (Pesquisas 2024)',
                            data: [
                                scientificData.reading.brazil.weekly,
                                scientificData.english.brazil.weekly,
                                scientificData.exercise.brazil.weekly,
                                scientificData.career.brazil.weekly,
                                scientificData.wellness.brazil.weekly
                            ],
                            backgroundColor: 'rgba(16, 185, 129, 0.6)',
                            borderColor: 'rgba(16, 185, 129, 1)',
                            borderWidth: 2,
                            borderRadius: 8
                        },
                        {
                            label: 'üåç M√âDIA MUNDIAL (OMS/Estudos)',
                            data: [
                                scientificData.reading.world.weekly,
                                scientificData.english.world.weekly,
                                scientificData.exercise.world.weekly,
                                scientificData.career.world.weekly,
                                scientificData.wellness.world.weekly
                            ],
                            backgroundColor: 'rgba(245, 158, 11, 0.6)',
                            borderColor: 'rgba(245, 158, 11, 1)',
                            borderWidth: 2,
                            borderRadius: 8
                        },
                        {
                            label: '‚≠ê ELITE (Top 5%)',
                            data: [
                                scientificData.reading.elite.weekly,
                                scientificData.english.elite.weekly,
                                scientificData.exercise.elite.weekly,
                                scientificData.career.elite.weekly,
                                scientificData.wellness.elite.weekly
                            ],
                            backgroundColor: 'rgba(139, 92, 246, 0.4)',
                            borderColor: 'rgba(139, 92, 246, 1)',
                            borderWidth: 2,
                            borderRadius: 8,
                            borderDash: [5, 5]
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 7,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#94a3b8',
                                callback: function(value) {
                                    return value + 'x';
                                }
                            },
                            title: {
                                display: true,
                                text: 'Vezes por Semana',
                                color: '#94a3b8',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: '#94a3b8',
                                font: {
                                    size: 11
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                color: '#94a3b8',
                                padding: 20,
                                font: {
                                    size: 12,
                                    weight: 'bold'
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.parsed.y + 'x por semana';
                                }
                            }
                        }
                    }
                }
            });
        }

        // Gr√°fico de progresso semanal
        function renderWeeklyProgressChart() {
            const ctx = document.getElementById('weeklyProgressChart');
            if (!ctx) return;

            if (weeklyProgressChart) {
                weeklyProgressChart.destroy();
            }

            const weekKey = getCurrentWeekKey();
            const labels = habits.map(h => h.name);
            const data = habits.map(h => {
                const count = h.counts[weekKey] || 0;
                return Math.min(100, (count / h.goal) * 100);
            });
            const goals = habits.map(() => 100);

            weeklyProgressChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Seu Progresso',
                            data: data,
                            backgroundColor: 'rgba(99, 102, 241, 0.8)',
                            borderColor: 'rgba(99, 102, 241, 1)',
                            borderWidth: 2,
                            borderRadius: 8
                        },
                        {
                            label: 'Meta (100%)',
                            data: goals,
                            backgroundColor: 'rgba(148, 163, 184, 0.2)',
                            borderColor: 'rgba(148, 163, 184, 0.5)',
                            borderWidth: 2,
                            borderRadius: 8,
                            borderDash: [5, 5]
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#94a3b8',
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: '#94a3b8',
                                font: {
                                    size: 10
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                color: '#94a3b8',
                                padding: 15
                            }
                        }
                    }
                }
            });
        }

        // Gr√°fico de evolu√ß√£o 2026 (semana a semana)
        function renderEvolution2026Chart() {
            const ctx = document.getElementById('evolution2026Chart');
            if (!ctx) return;

            if (evolution2026Chart) {
                evolution2026Chart.destroy();
            }

            const now = new Date();
            const currentWeek = getWeekNumber(now);

            const labels = [];
            const data = [];

            // Mostrar √∫ltimas 12 semanas ou at√© a semana atual
            const weeksToShow = Math.min(12, currentWeek);
            
            for (let i = weeksToShow - 1; i >= 0; i--) {
                const week = currentWeek - i;
                const weekKey = `2026-W${String(week).padStart(2, '0')}`;
                labels.push(`Sem ${week}`);

                let totalProgress = 0;
                habits.forEach(habit => {
                    const count = habit.counts[weekKey] || 0;
                    const progress = Math.min(100, (count / habit.goal) * 100);
                    totalProgress += progress;
                });

                const avgProgress = habits.length > 0 ? totalProgress / habits.length : 0;
                data.push(avgProgress);
            }

            evolution2026Chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Score M√©dio Semanal (%)',
                        data: data,
                        borderColor: 'rgba(16, 185, 129, 1)',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: 'rgba(16, 185, 129, 1)',
                        pointRadius: 5,
                        pointHoverRadius: 7
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#94a3b8',
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#94a3b8'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        // Gr√°fico de compara√ß√£o por categoria
        function renderCategoryComparisonChart() {
            const ctx = document.getElementById('categoryComparisonChart');
            if (!ctx) return;

            if (categoryComparisonChart) {
                categoryComparisonChart.destroy();
            }

            const weekKey = getCurrentWeekKey();
            
            const categories = {
                'Educa√ß√£o': [],
                'Sa√∫de': [],
                'Bem-estar': [],
                'Produtividade': []
            };

            habits.forEach(habit => {
                const cat = habit.category;
                if (categories[cat]) {
                    const count = habit.counts[weekKey] || 0;
                    const progress = (count / habit.goal) * 100;
                    categories[cat].push(progress);
                }
            });

            const labels = Object.keys(categories).filter(cat => categories[cat].length > 0);
            const yourData = labels.map(cat => {
                const avg = categories[cat].reduce((a, b) => a + b, 0) / categories[cat].length;
                return Math.round(avg);
            });

            const brazilData = labels.map(cat => {
                if (cat === 'Educa√ß√£o') return 40;
                if (cat === 'Sa√∫de') return 35;
                if (cat === 'Bem-estar') return 25;
                if (cat === 'Produtividade') return 45;
                return 40;
            });

            const worldData = labels.map(cat => {
                if (cat === 'Educa√ß√£o') return 55;
                if (cat === 'Sa√∫de') return 50;
                if (cat === 'Bem-estar') return 45;
                if (cat === 'Produtividade') return 60;
                return 50;
            });

            categoryComparisonChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Voc√™',
                            data: yourData,
                            backgroundColor: 'rgba(99, 102, 241, 0.2)',
                            borderColor: 'rgba(99, 102, 241, 1)',
                            borderWidth: 3,
                            pointBackgroundColor: 'rgba(99, 102, 241, 1)',
                            pointRadius: 5
                        },
                        {
                            label: 'üáßüá∑ Brasil',
                            data: brazilData,
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            borderColor: 'rgba(16, 185, 129, 1)',
                            borderWidth: 2,
                            borderDash: [5, 5],
                            pointBackgroundColor: 'rgba(16, 185, 129, 1)',
                            pointRadius: 4
                        },
                        {
                            label: 'üåç Mundial',
                            data: worldData,
                            backgroundColor: 'rgba(245, 158, 11, 0.1)',
                            borderColor: 'rgba(245, 158, 11, 1)',
                            borderWidth: 2,
                            borderDash: [5, 5],
                            pointBackgroundColor: 'rgba(245, 158, 11, 1)',
                            pointRadius: 4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                color: '#94a3b8',
                                backdropColor: 'transparent',
                                callback: function(value) {
                                    return value + '%';
                                }
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            pointLabels: {
                                color: '#94a3b8',
                                font: {
                                    size: 12,
                                    weight: 'bold'
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                color: '#94a3b8',
                                padding: 15,
                                font: {
                                    size: 11
                                }
                            }
                        }
                    }
                }
            });
        }

        // Gr√°fico radar de performance
        function renderPerformanceRadarChart() {
            const ctx = document.getElementById('performanceRadarChart');
            if (!ctx) return;

            if (performanceRadarChart) {
                performanceRadarChart.destroy();
            }

            const weekKey = getCurrentWeekKey();
            
            let totalProgress = 0;
            let totalIntensity = 0;
            
            habits.forEach(habit => {
                const count = habit.counts[weekKey] || 0;
                const progress = Math.min(100, (count / habit.goal) * 100);
                totalProgress += progress;
                totalIntensity += Math.min(100, (habit.duration / 60) * 100);
            });

            const avgProgress = habits.length > 0 ? totalProgress / habits.length : 0;
            const avgIntensity = habits.length > 0 ? totalIntensity / habits.length : 0;
            
            performanceRadarChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['Progresso', 'Consist√™ncia', 'Intensidade', 'Sequ√™ncia', 'Dedica√ß√£o'],
                    datasets: [{
                        label: 'Performance Atual',
                        data: [
                            avgProgress,
                            Math.min(100, (appData.streak / 21) * 100), // 21 dias para formar h√°bito
                            avgIntensity,
                            Math.min(100, (appData.streak / 7) * 100),
                            avgProgress * 0.7 + avgIntensity * 0.3
                        ],
                        backgroundColor: 'rgba(99, 102, 241, 0.2)',
                        borderColor: 'rgba(99, 102, 241, 1)',
                        borderWidth: 2,
                        pointBackgroundColor: 'rgba(99, 102, 241, 1)',
                        pointRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                color: '#94a3b8',
                                backdropColor: 'transparent',
                                callback: function(value) {
                                    return value + '%';
                                }
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            pointLabels: {
                                color: '#94a3b8',
                                font: {
                                    size: 11
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        // Gerar insights cient√≠ficos
        function generateInsights() {
            const container = document.getElementById('insightsGrid');
            const insights = [];

            if (habits.length === 0) {
                container.innerHTML = `
                    <div class="insight-item info">
                        <div class="insight-icon">
                            <i class="fas fa-info-circle"></i>
                        </div>
                        <div class="insight-content">
                            <div class="insight-title">Comece sua jornada cient√≠fica!</div>
                            <div class="insight-text">Seus h√°bitos j√° est√£o pr√©-configurados baseados em pesquisas cient√≠ficas. Clique em "Marcar como conclu√≠do" quando completar cada um.</div>
                        </div>
                    </div>
                `;
                return;
            }

            const weekKey = getCurrentWeekKey();

            // Insight 1: Compara√ß√£o com dados cient√≠ficos
            let totalProgress = 0;
            habits.forEach(habit => {
                const count = habit.counts[weekKey] || 0;
                const progress = (count / habit.goal) * 100;
                totalProgress += progress;
            });
            const yourScore = totalProgress / habits.length;

            if (yourScore >= 80) {
                insights.push({
                    type: 'success',
                    icon: 'fa-trophy',
                    title: 'üèÜ TOP 10% GLOBAL - Desempenho Excepcional!',
                    text: `Com ${Math.round(yourScore)}% de progresso, voc√™ est√° no TOP 10% mundial segundo dados cient√≠ficos! Apenas 10% das pessoas mant√™m este n√≠vel de consist√™ncia. Continue assim! üåü`
                });
            } else if (yourScore >= 60) {
                insights.push({
                    type: 'success',
                    icon: 'fa-chart-line',
                    title: 'Acima da M√©dia Global!',
                    text: `Voc√™ est√° com ${Math.round(yourScore)}%, ACIMA das m√©dias brasileira (40%) e mundial (55%) baseadas em pesquisas do Instituto Pr√≥-Livro 2024 e OMS! üöÄ`
                });
            } else if (yourScore >= 50) {
                insights.push({
                    type: 'info',
                    icon: 'fa-bullseye',
                    title: 'Na M√©dia Mundial',
                    text: `Com ${Math.round(yourScore)}%, voc√™ est√° na m√©dia mundial (55%). Um pequeno esfor√ßo te coloca acima! A diferen√ßa entre m√©dio e excelente √© s√≥ 25% de dedica√ß√£o extra. üí™`
                });
            } else {
                insights.push({
                    type: 'warning',
                    icon: 'fa-chart-bar',
                    title: 'Oportunidade de Crescimento',
                    text: `Voc√™ est√° com ${Math.round(yourScore)}%. M√©dia brasileira: 40%, mundial: 55%. Pequenos ajustes podem te levar ao TOP 10%! Vamos come√ßar? üìà`
                });
            }

            // Insight 2: Leitura espec√≠fica
            const readingHabit = habits.find(h => h.name.toLowerCase().includes('leitura'));
            if (readingHabit) {
                const count = readingHabit.counts[weekKey] || 0;
                if (count >= 5) {
                    const pagesPerWeek = count * 10; // 10 p√°ginas por dia
                    const booksPerYear = Math.round((pagesPerWeek * 52) / 300); // Livros de 300 p√°ginas
                    insights.push({
                        type: 'success',
                        icon: 'fa-book-open',
                        title: 'üìö Leitor Excepcional - Dados Cient√≠ficos',
                        text: `${count}x/semana = ${pagesPerWeek} p√°ginas/semana = ~${booksPerYear} livros/ano! üáßüá∑ M√©dia Brasil: 2,4 livros/ano (Pr√≥-Livro 2024). Voc√™ est√° ${Math.round(booksPerYear / 2.4)}x ACIMA! 53% dos brasileiros N√ÉO leem. Voc√™ √© da elite! üåü`
                    });
                }
            }

            // Insight 3: Ingl√™s - Caminho para flu√™ncia
            const englishHabit = habits.find(h => h.name.toLowerCase().includes('ingl√™s'));
            if (englishHabit) {
                const count = englishHabit.counts[weekKey] || 0;
                const minutesPerWeek = count * englishHabit.duration;
                const hoursPerYear = (minutesPerWeek * 52) / 60;
                const yearsToFluency = Math.round((1200 / hoursPerYear) * 10) / 10;
                
                if (count >= 5) {
                    insights.push({
                        type: 'success',
                        icon: 'fa-language',
                        title: 'üó£Ô∏è Caminho para Flu√™ncia - Dados Cambridge',
                        text: `${minutesPerWeek}min/semana = ${Math.round(hoursPerYear)}h/ano. Para flu√™ncia: 1200h (CEFR). No seu ritmo: ${yearsToFluency} anos! üáßüá∑ Brasil: m√©dia 3h/semana. Voc√™ est√° ${Math.round(minutesPerWeek / 180)}x mais dedicado! üöÄ`
                    });
                } else if (count > 0) {
                    insights.push({
                        type: 'info',
                        icon: 'fa-graduation-cap',
                        title: 'Ingl√™s - Aumente sua Frequ√™ncia',
                        text: `Atual: ${count}x/semana. Estudos mostram: 5x/semana (1h/dia) = flu√™ncia em 3 anos. üåç Padr√£o global: 3x/semana. Meta elite: 5-7x/semana! Voc√™ est√° no caminho certo! üí°`
                    });
                }
            }

            // Insight 4: Exerc√≠cios - Compara√ß√£o OMS
            const exerciseHabit = habits.find(h => h.name.toLowerCase().includes('exerc'));
            if (exerciseHabit) {
                const count = exerciseHabit.counts[weekKey] || 0;
                const minutesPerWeek = count * exerciseHabit.duration;
                
                if (minutesPerWeek >= 250) {
                    insights.push({
                        type: 'success',
                        icon: 'fa-heartbeat',
                        title: 'üí™ Sa√∫de Excepcional - Recomenda√ß√µes OMS',
                        text: `${minutesPerWeek}min/semana! OMS: 150-300min = sa√∫de. Voc√™ SUPEROU! üáßüá∑ Brasil: 50% n√£o atingem 150min (Vigitel 2021). Voc√™ est√° protegido contra doen√ßas card√≠acas, diabetes e mais! üèÉ‚Äç‚ôÇÔ∏è`
                    });
                } else if (minutesPerWeek >= 150) {
                    insights.push({
                        type: 'success',
                        icon: 'fa-check-circle',
                        title: 'Dentro das Recomenda√ß√µes OMS',
                        text: `${minutesPerWeek}min/semana atende OMS (150min m√≠nimo). Para benef√≠cios M√ÅXIMOS: 300min/semana. Voc√™ est√° no caminho! Continue! üí™`
                    });
                } else {
                    insights.push({
                        type: 'warning',
                        icon: 'fa-running',
                        title: 'Aumente sua Atividade F√≠sica',
                        text: `Atual: ${minutesPerWeek}min/semana. OMS recomenda: m√≠nimo 150min. Apenas +${150 - minutesPerWeek}min protegem contra doen√ßas! üåç Mundo: 23% n√£o atingem meta. N√£o fique nessa estat√≠stica! üèÉ`
                    });
                }
            }

            // Insight 5: Total de horas em 2026
            if (appData.totalHours2026 >= 100) {
                insights.push({
                    type: 'success',
                    icon: 'fa-clock',
                    title: '‚è∞ Impressionante! +100 Horas em 2026',
                    text: `Voc√™ j√° acumulou ${appData.totalHours2026} horas de desenvolvimento em 2026! Com este ritmo, terminar√° o ano com ${Math.round((appData.totalHours2026 / getWeekNumber(new Date())) * 52)} horas totais. Isso √© transformador! üéØ`
                });
            }

            // Insight 6: Sequ√™ncia de 21 dias
            if (appData.streak >= 21) {
                insights.push({
                    type: 'success',
                    icon: 'fa-fire',
                    title: 'üî• H√°bito Cient√≠ficamente Formado!',
                    text: `${appData.streak} dias! Estudos mostram: 21 dias formam um h√°bito, 66 dias o solidificam. Voc√™ J√Å formou o h√°bito! Agora √© neurol√≥gico - seu c√©rebro mudou! üß†`
                });
            }

            // Insight 7: Jejum de A√ß√∫car
            if (appData.sugarFast && appData.sugarFast.active && appData.sugarFast.currentDays > 0) {
                const days = appData.sugarFast.currentDays;
                
                if (days >= 40) {
                    insights.push({
                        type: 'success',
                        icon: 'fa-crown',
                        title: 'üëë 40 DIAS SEM A√á√öCAR - VOC√ä √â ELITE!',
                        text: `Parab√©ns! ${days} dias sem a√ß√∫car! Voc√™ est√° no TOP 5% da popula√ß√£o mundial. Estudos mostram: revers√£o resist√™ncia insulina, -50% uso glicose em c√©lulas cancer√≠genas, menor risco Alzheimer. Brasileiro consome 51kg/ano (Embrapa) - voc√™ ZEROU! üèÜ`
                    });
                } else if (days >= 30) {
                    insights.push({
                        type: 'success',
                        icon: 'fa-trophy',
                        title: 'üèÜ 1 M√äS SEM A√á√öCAR - Transforma√ß√£o Completa!',
                        text: `${days} dias! BMC Medicine 2023: -6% risco doen√ßas card√≠acas, -10% AVC. Triglicer√≠deos e colesterol reduzidos, pele renovada, energia est√°vel. Apenas 10% conseguem chegar aqui! Faltam ${40 - days} dias para a meta! üí™`
                    });
                } else if (days >= 21) {
                    insights.push({
                        type: 'success',
                        icon: 'fa-brain',
                        title: 'üß† 21 DIAS - H√°bito Neurologicamente Formado!',
                        text: `${days} dias sem a√ß√∫car! Cientificamente, seu c√©rebro J√Å mudou. Harvard: melhor fun√ß√£o cognitiva, concentra√ß√£o aumentada. Desejo por doces 70% reduzido. Continue at√© 40 dias (faltam ${40 - days}) para benef√≠cios m√°ximos! üåü`
                    });
                } else if (days >= 14) {
                    insights.push({
                        type: 'success',
                        icon: 'fa-heartbeat',
                        title: 'üí™ 2 SEMANAS - Mudan√ßas Vis√≠veis!',
                        text: `${days} dias! Estudos: perda 2-5kg, sono melhor, ansiedade ‚Üì, imunidade ‚Üë. Pele mais clara (menos oleosidade). Brasileiro consome 51kg a√ß√∫car/ano - voc√™ est√° REVERTENDO! Faltam ${40 - days} dias para a meta completa! üî•`
                    });
                } else if (days >= 7) {
                    insights.push({
                        type: 'success',
                        icon: 'fa-star',
                        title: '‚≠ê 1 SEMANA COMPLETA SEM A√á√öCAR!',
                        text: `${days} dias! National Geographic 2025: redu√ß√£o incha√ßo, perfil glic√™mico melhor, humor normalizado. OMS recomenda m√°x 25g/dia - brasileiro consome 140g/dia! Voc√™ est√° no caminho certo! Continue firme! üíö`
                    });
                } else if (days >= 3) {
                    insights.push({
                        type: 'info',
                        icon: 'fa-check-circle',
                        title: '‚úÖ 3 Dias - Pior Passou!',
                        text: `${days} dias! Os sintomas de abstin√™ncia diminu√≠ram. Cortisol normalizando. A partir de agora fica mais f√°cil! Continue at√© 40 dias para transforma√ß√£o completa. Voc√™ j√° superou a parte mais dif√≠cil! üéØ`
                    });
                } else {
                    insights.push({
                        type: 'warning',
                        icon: 'fa-exclamation-triangle',
                        title: `üç≠ Dia ${days} - Fase Cr√≠tica`,
                        text: `Primeiros 3 dias s√£o os mais dif√≠ceis. Irritabilidade e dor de cabe√ßa s√£o normais (cortisol alto). RESISTA! Brasileiro consome 51kg/ano vs 25kg mundial. Ap√≥s dia 3, sintomas melhoram 80%. Voc√™ consegue! üí™`
                    });
                }
            } else if (appData.sugarFast && appData.sugarFast.bestStreak > 0) {
                insights.push({
                    type: 'info',
                    icon: 'fa-redo',
                    title: 'Jejum de A√ß√∫car - Tente Novamente!',
                    text: `Seu melhor: ${appData.sugarFast.bestStreak} dias. Tentativas: ${appData.sugarFast.totalAttempts}. Estudos: 40 dias transforma metabolismo, -6% risco card√≠aco, -10% AVC. Vale tentar de novo! üéØ`
                });
            }

            // Renderizar insights
            if (insights.length === 0) {
                insights.push({
                    type: 'info',
                    icon: 'fa-info-circle',
                    title: 'Continue Firme',
                    text: 'Mantenha o foco e a consist√™ncia para alcan√ßar seus objetivos e superar as m√©dias globais baseadas em ci√™ncia!'
                });
            }

            container.innerHTML = insights.map(insight => `
                <div class="insight-item ${insight.type}">
                    <div class="insight-icon">
                        <i class="fas ${insight.icon}"></i>
                    </div>
                    <div class="insight-content">
                        <div class="insight-title">${insight.title}</div>
                        <div class="insight-text">${insight.text}</div>
                    </div>
                </div>
            `).join('');
        }

        // Inicializar quando a p√°gina carregar
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>